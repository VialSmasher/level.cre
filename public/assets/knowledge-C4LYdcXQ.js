import{j as e}from"./maps-BkP_85Bm.js";import{r as g}from"./react-BUvn9Qyq.js";import{C as m,a as x,b as f,c as p}from"./card-CVaT3zxn.js";import{S as M,a as F,b as E,c as K,d as P}from"./select-DtWl5TGT.js";import{B as q}from"./badge-BzWFgtZE.js";import{u as v}from"./query-BAwt2wOP.js";import{f as U}from"./index-DIhazG7A.js";import{u as W}from"./useProfile-DmUgQoUG.js";import{u as L}from"./submarkets-DYRPNR7X.js";import{U as O}from"./users-fUGmfG67.js";import{P as S}from"./phone-Dz66gF6o.js";import{C as B,a as R}from"./clock-CbhiVOhl.js";import"./index-NSkCLJ8O.js";import"./supabase-LVwxr6rx.js";import"./charts-Ciu5p52_.js";function ne(){const{user:D}=U(),{profile:I}=W(),N=D,{data:b=[]}=v({queryKey:["/api/prospects"],refetchOnWindowFocus:!0,staleTime:0,enabled:!!N}),{data:V=[]}=v({queryKey:["/api/submarkets"],refetchOnWindowFocus:!0,enabled:!!N}),A=L(I?.submarkets||[]),{data:u=[]}=v({queryKey:["/api/interactions"],enabled:!!N});g.useEffect(()=>{const s=()=>{C("all")};return window.addEventListener("userChanged",s),()=>window.removeEventListener("userChanged",s)},[]);const[o,C]=g.useState("all"),i=g.useMemo(()=>o==="all"?b:b.filter(s=>s.submarketId===o),[b,o]),r=g.useMemo(()=>{const s=i.length,t=i.filter(l=>l.status!=="prospect").length,c=s>0?t/s*100:0,n=new Date;n.setDate(n.getDate()-60);const a=i.filter(l=>u.filter(d=>d.prospectId===l.id).some(d=>new Date(d.date||d.createdAt)>n)).length,y=s>0?a/s*100:0,w=i.filter(l=>!u.some(h=>h.prospectId===l.id)),T=i.filter(l=>{const h=u.filter(j=>j.prospectId===l.id);if(h.length===0)return!0;const d=Math.max(...h.map(j=>new Date(j.date||j.createdAt).getTime()));return new Date(d)<=n});return{total:s,contacted:t,recentActivity:a,contactPercent:c,freshnessPercent:y,noTouches:w,staleProspects:T}},[i,u]),k=({progress:s,size:t=60})=>{const c=s||0,n=(t-8)/2,a=2*Math.PI*n,y=a,w=a-c/100*a;return e.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[e.jsxs("svg",{width:t,height:t,className:"transform -rotate-90",children:[e.jsx("circle",{cx:t/2,cy:t/2,r:n,stroke:"currentColor",strokeWidth:"4",fill:"none",className:"text-gray-300"}),e.jsx("circle",{cx:t/2,cy:t/2,r:n,stroke:"currentColor",strokeWidth:"4",fill:"none",strokeLinecap:"round",strokeDasharray:y,strokeDashoffset:w,className:"text-blue-600 transition-all duration-300 ease-in-out"})]}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-sm font-semibold",children:[Math.round(c),"%"]})]})};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Knowledge Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Track your prospect pipeline performance and identify opportunities"})]}),e.jsx(m,{className:"mb-6",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Submarket:"}),e.jsxs(M,{value:o,onValueChange:C,children:[e.jsx(F,{className:"w-48",children:e.jsx(E,{placeholder:"All Submarkets"})}),e.jsxs(K,{children:[e.jsx(P,{value:"all",children:"All Submarkets"}),A.map(s=>e.jsx(P,{value:s,children:s},s))]})]})]})})}),o!=="all"&&e.jsx("div",{className:"mb-4",children:e.jsxs(q,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:["Filtered by: ",o]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Assets"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.total})})]}),e.jsxs(m,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Contact Coverage"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.contacted}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["of ",r.total]})]}),e.jsx(k,{progress:r.contactPercent})]})]}),e.jsxs(m,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Freshness"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.recentActivity}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"last 60 days"})]}),e.jsx(k,{progress:r.freshnessPercent})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(p,{className:"flex items-center",children:[e.jsx(S,{className:"mr-2 h-4 w-4 text-green-500"}),"New Prospects (",r.noTouches.filter(s=>s.status==="prospect").length,")"]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.noTouches.filter(s=>s.status==="prospect").length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"All prospects contacted!"}):r.noTouches.filter(s=>s.status==="prospect").slice(0,8).map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 border rounded hover:bg-green-50 hover:border-green-200 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Call now"})]},s.id))})})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(p,{className:"flex items-center",children:[e.jsx(R,{className:"mr-2 h-4 w-4 text-orange-500"}),"Follow-ups (",r.staleProspects.filter(s=>["contacted","followup"].includes(s.status)).length,")"]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.staleProspects.filter(s=>["contacted","followup"].includes(s.status)).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"All caught up!"}):r.staleProspects.filter(s=>["contacted","followup"].includes(s.status)).slice(0,8).map(s=>{const t=u.filter(a=>a.prospectId===s.id),c=t.length>0?new Date(Math.max(...t.map(a=>new Date(a.date||a.createdAt).getTime()))):null,n=c?Math.floor((Date.now()-c.getTime())/(1e3*60*60*24)):999;return e.jsxs("div",{className:"flex justify-between items-center p-3 border rounded hover:bg-orange-50 hover:border-orange-200 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-orange-600 font-medium",children:[n,"d ago"]})]},s.id)})})})]})]})]})})}export{ne as default};
