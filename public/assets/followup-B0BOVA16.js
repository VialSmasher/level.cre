import{j as e}from"./maps-BkP_85Bm.js";import{r as u}from"./react-BUvn9Qyq.js";import{u as P,b as q,c as _}from"./query-BAwt2wOP.js";import{c as v,B as f,e as I}from"./index-DIhazG7A.js";import{C as E,b as D,c as L,a as Q}from"./card-CVaT3zxn.js";import{B as K}from"./badge-BzWFgtZE.js";import{L as b,I as O}from"./label-1jjjNnWq.js";import{T as B}from"./textarea-D0vZhPYN.js";import{S as w,a as C,b as S,c as k,d as a}from"./select-DtWl5TGT.js";import{D as A,b as z,c as $,d as V}from"./dialog-BERENffF.js";import{C as H,a as M}from"./clock-CbhiVOhl.js";import{M as R}from"./map-pin-C6sM-pao.js";import{B as Z}from"./building-2-DZp2DpZm.js";import{P as W}from"./phone-Dz66gF6o.js";import{Z as F}from"./zap-DP8WwCqM.js";import"./supabase-LVwxr6rx.js";import"./charts-Ciu5p52_.js";import"./index-NSkCLJ8O.js";const Y=v("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const T=v("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const U=v("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const G=v("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);const J=v("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),X={"1_month":"1 Month","3_month":"3 Months","6_month":"6 Months","1_year":"1 Year"},ee={prospect:"#FBBF24",contacted:"#3B82F6",listing:"#10B981",client:"#8B5CF6",no_go:"#EF4444"};function te({prospect:n,onClose:g}){const[o,d]=u.useState("call"),[s,m]=u.useState("contacted"),[x,j]=u.useState(""),[h,r]=u.useState(""),i=q(),y=_({mutationFn:async l=>(await I("POST","/api/interactions",{prospectId:n.id,date:new Date().toISOString(),type:l.type,outcome:l.outcome,notes:l.notes,nextFollowUp:l.nextFollowUp||void 0})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/prospects"]}),i.invalidateQueries({queryKey:["/api/interactions"]}),i.invalidateQueries({queryKey:["/api/skills"]}),i.invalidateQueries({queryKey:["/api/skill-activities"]}),g()}}),p=l=>{l.preventDefault(),y.mutate({type:o,outcome:s,notes:x,nextFollowUp:h})};return e.jsx(A,{open:!0,onOpenChange:g,children:e.jsxs(z,{className:"max-w-lg",children:[e.jsxs($,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Log Contact Interaction"]}),e.jsx("p",{className:"text-sm text-gray-600",children:n.name})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"type",children:"Contact Type"}),e.jsxs(w,{value:o,onValueChange:d,children:[e.jsx(C,{children:e.jsx(S,{})}),e.jsxs(k,{children:[e.jsx(a,{value:"call",children:"Phone Call"}),e.jsx(a,{value:"email",children:"Email"}),e.jsx(a,{value:"meeting",children:"Meeting"}),e.jsx(a,{value:"note",children:"Note"})]})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"outcome",children:"Outcome"}),e.jsxs(w,{value:s,onValueChange:m,children:[e.jsx(C,{children:e.jsx(S,{})}),e.jsxs(k,{children:[e.jsx(a,{value:"contacted",children:"Contacted"}),e.jsx(a,{value:"no_answer",children:"No Answer"}),e.jsx(a,{value:"left_message",children:"Left Message"}),e.jsx(a,{value:"scheduled_meeting",children:"Scheduled Meeting"}),e.jsx(a,{value:"not_interested",children:"Not Interested"}),e.jsx(a,{value:"follow_up_later",children:"Follow Up Later"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"notes",children:"Notes"}),e.jsx(B,{id:"notes",value:x,onChange:l=>j(l.target.value),placeholder:"Describe the interaction, key points discussed, etc.",rows:3})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"nextFollowUp",children:"Next Follow-Up Date (Optional)"}),e.jsx(O,{id:"nextFollowUp",type:"date",value:h,onChange:l=>r(l.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:g,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:y.isPending,children:y.isPending?"Saving...":"Save Interaction"})]})]})]})})}function se({prospect:n,allInteractions:g}){const[o,d]=u.useState(null),s=q(),m=g.filter(t=>t.prospectId===n.id),x=m.filter(t=>t.type==="call").length,j=m.filter(t=>t.type==="email").length,h=m.sort((t,c)=>new Date(c.date).getTime()-new Date(t.date).getTime())[0],r=_({mutationFn:async t=>(await I("POST","/api/interactions",{prospectId:n.id,date:new Date().toISOString(),type:t,outcome:"contacted",notes:`Quick ${t} engagement`})).json(),onSuccess:()=>{s.invalidateQueries({queryKey:["/api/prospects"]}),s.invalidateQueries({queryKey:["/api/interactions"]}),s.invalidateQueries({queryKey:["/api/skills"]}),s.invalidateQueries({queryKey:["/api/skill-activities"]}),d(null)}}),i=_({mutationFn:async()=>{if(h)return I("DELETE",`/api/interactions/${h.id}`)},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/prospects"]}),s.invalidateQueries({queryKey:["/api/interactions"]}),s.invalidateQueries({queryKey:["/api/skills"]}),s.invalidateQueries({queryKey:["/api/skill-activities"]})}}),y=t=>{t.stopPropagation(),d("call"),r.mutate("call")},p=t=>{t.stopPropagation(),d("email"),r.mutate("email")},l=t=>{t.stopPropagation(),i.mutate()};return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(f,{size:"sm",variant:"outline",onClick:y,disabled:r.isPending,className:`flex items-center gap-1 transition-all px-2 ${o==="call"?"bg-green-100 border-green-300":"hover:bg-blue-50 hover:border-blue-300"}`,children:[r.isPending&&o==="call"?e.jsx(F,{className:"h-3 w-3 animate-spin"}):e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{className:`text-xs font-semibold px-1 py-0.5 rounded-full min-w-[16px] text-center ${x>0?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"}`,children:x})]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:p,disabled:r.isPending,className:`flex items-center gap-1 transition-all px-2 ${o==="email"?"bg-green-100 border-green-300":"hover:bg-orange-50 hover:border-orange-300"}`,children:[r.isPending&&o==="email"?e.jsx(F,{className:"h-3 w-3 animate-spin"}):e.jsx(T,{className:"h-3 w-3"}),e.jsx("span",{className:`text-xs font-semibold px-1 py-0.5 rounded-full min-w-[16px] text-center ${j>0?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-600"}`,children:j})]}),m.length>0&&e.jsx(f,{size:"sm",variant:"outline",onClick:l,disabled:i.isPending,className:"flex items-center gap-1 transition-all px-2 hover:bg-red-50 hover:border-red-300",title:"Undo last interaction",children:i.isPending?e.jsx(F,{className:"h-3 w-3 animate-spin"}):e.jsx(J,{className:"h-3 w-3 text-red-600"})})]})}function Ne(){const[n,g]=u.useState("all"),[o,d]=u.useState(null),[s,m]=u.useState("all"),{data:x=[],isLoading:j}=P({queryKey:["/api/prospects"]}),{data:h=[]}=P({queryKey:["/api/submarkets"]}),{data:r=[]}=P({queryKey:["/api/interactions"]}),i=s==="no_engagement"?x:x.filter(t=>t.followUpTimeframe),p=i.filter(t=>{const c=r.filter(N=>N.prospectId===t.id);return s==="no_engagement"?c.length===0:s==="has_engagement"?c.length>0:!0}).filter(t=>n==="all"?!0:n==="none"?!t.submarketId:t.submarketId===n),l=[...p].sort((t,c)=>{const N={"1_month":1,"3_month":2,"6_month":3,"1_year":4};return N[t.followUpTimeframe]-N[c.followUpTimeframe]});return j?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Loading follow-ups..."})}):e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Follow-Up Schedule"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[p.length," prospects",s==="no_engagement"&&" with no engagement",s==="has_engagement"&&" with logged activity",s==="all"&&" scheduled for follow-up",n!=="all"&&e.jsxs("span",{className:"ml-2",children:["in ",n==="none"?"no submarket":h.find(t=>t.id===n)?.name||n]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-gray-500"}),e.jsxs(w,{value:s,onValueChange:m,children:[e.jsx(C,{className:"w-48",children:e.jsx(S,{placeholder:"Filter by engagement"})}),e.jsxs(k,{children:[e.jsx(a,{value:"all",children:"All Prospects"}),e.jsx(a,{value:"no_engagement",children:"No Engagement"}),e.jsx(a,{value:"has_engagement",children:"Has Engagement"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-500"}),e.jsxs(w,{value:n,onValueChange:g,children:[e.jsx(C,{className:"w-40",children:e.jsx(S,{placeholder:"Filter by submarket"})}),e.jsxs(k,{children:[e.jsx(a,{value:"all",children:"All Submarkets"}),e.jsx(a,{value:"none",children:"No Submarket"}),h.map(t=>e.jsx(a,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.color&&e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:t.color}}),t.name]})},t.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i.length===0?"No Prospects Found":"No Results for Current Filters"}),e.jsx("p",{className:"text-gray-600",children:s==="no_engagement"?"All prospects have some form of engagement recorded.":i.length===0?"Add follow-up timeframes to your prospects to see them here.":"Try adjusting your filters to view other prospects."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.map(t=>e.jsxs(E,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>d(t),children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{className:"text-lg font-semibold text-gray-900 mb-2",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:ee[t.status]}}),e.jsx("span",{className:"text-sm capitalize text-gray-600",children:t.status.replace("_"," ")})]}),e.jsxs(K,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),X[t.followUpTimeframe]]})]}),e.jsx("div",{className:"flex justify-end",onClick:c=>c.stopPropagation(),children:e.jsx(se,{prospect:t,allInteractions:r})})]})}),e.jsx(Q,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[t.submarketId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"capitalize",children:t.submarketId})]}),(t.contactName||t.contactEmail||t.contactPhone||t.contactCompany)&&e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[t.contactName&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contact:"}),e.jsx("span",{children:t.contactName})]}),t.contactCompany&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:t.contactCompany})]}),e.jsxs("div",{className:"flex gap-4",children:[t.contactEmail&&e.jsxs("a",{href:`mailto:${t.contactEmail}`,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:"Email"})]}),t.contactPhone&&e.jsxs("a",{href:`tel:${t.contactPhone}`,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Call"})]})]})]}),t.notes&&e.jsx("div",{className:"border-t pt-3",children:e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:t.notes})}),e.jsxs("div",{className:"text-xs text-gray-500 border-t pt-2",children:["Added: ",new Date(t.createdDate).toLocaleDateString()]})]})})]},t.id))})}),o&&e.jsx(te,{prospect:o,onClose:()=>d(null)})]})}export{Ne as default};
