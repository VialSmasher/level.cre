import{j as e}from"./maps-BkP_85Bm.js";import{r as p,b as f}from"./react-BUvn9Qyq.js";import{b as Ce,u as X,c as B}from"./query-BAwt2wOP.js";import{c as Se,j as E,P as _,k as ke,g as Pe,l as re,I as we,m as Me,R as De,n as Ge,h as V,u as ze,a as Ae,b as Le,B as P,d as Fe,e as R}from"./index-DIhazG7A.js";import{L as x,I as v}from"./label-1jjjNnWq.js";import{T as Y}from"./textarea-D0vZhPYN.js";import{C as Ie,b as Be,c as Re,a as _e}from"./card-CVaT3zxn.js";import{D as Ee,a as Ve,b as $e,c as qe,d as Oe,e as Qe}from"./dialog-BERENffF.js";import{S as Z,a as ee,b as se,c as ae,d as D}from"./select-DtWl5TGT.js";import{B as G}from"./badge-BzWFgtZE.js";import{u as He}from"./useProfile-DmUgQoUG.js";import{P as Ke}from"./plus-BEBk_LKq.js";import{S as Ue}from"./square-pen-CpKRbF5C.js";import{T as Je}from"./trash-2-Cz6C_y_-.js";import{B as We}from"./building-2-DZp2DpZm.js";import"./supabase-LVwxr6rx.js";import"./charts-Ciu5p52_.js";import"./index-NSkCLJ8O.js";const Xe=Se("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);var le="Toggle",$=p.forwardRef((t,n)=>{const{pressed:c,defaultPressed:l,onPressedChange:i,...d}=t,[o,u]=E({prop:c,onChange:i,defaultProp:l??!1,caller:le});return e.jsx(_.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":t.disabled?"":void 0,...d,ref:n,onClick:ke(t.onClick,()=>{t.disabled||u(!o)})})});$.displayName=le;var ie=$,T="ToggleGroup",[ne]=Pe(T,[re]),oe=re(),q=f.forwardRef((t,n)=>{const{type:c,...l}=t;if(c==="single"){const i=l;return e.jsx(Ye,{...i,ref:n})}if(c==="multiple"){const i=l;return e.jsx(Ze,{...i,ref:n})}throw new Error(`Missing prop \`type\` expected on \`${T}\``)});q.displayName=T;var[ce,de]=ne(T),Ye=f.forwardRef((t,n)=>{const{value:c,defaultValue:l,onValueChange:i=()=>{},...d}=t,[o,u]=E({prop:c,defaultProp:l??"",onChange:i,caller:T});return e.jsx(ce,{scope:t.__scopeToggleGroup,type:"single",value:f.useMemo(()=>o?[o]:[],[o]),onItemActivate:u,onItemDeactivate:f.useCallback(()=>u(""),[u]),children:e.jsx(ue,{...d,ref:n})})}),Ze=f.forwardRef((t,n)=>{const{value:c,defaultValue:l,onValueChange:i=()=>{},...d}=t,[o,u]=E({prop:c,defaultProp:l??[],onChange:i,caller:T}),j=f.useCallback(y=>u((N=[])=>[...N,y]),[u]),w=f.useCallback(y=>u((N=[])=>N.filter(k=>k!==y)),[u]);return e.jsx(ce,{scope:t.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:j,onItemDeactivate:w,children:e.jsx(ue,{...d,ref:n})})});q.displayName=T;var[es,ss]=ne(T),ue=f.forwardRef((t,n)=>{const{__scopeToggleGroup:c,disabled:l=!1,rovingFocus:i=!0,orientation:d,dir:o,loop:u=!0,...j}=t,w=oe(c),y=Me(o),N={role:"group",dir:y,...j};return e.jsx(es,{scope:c,rovingFocus:i,disabled:l,children:i?e.jsx(De,{asChild:!0,...w,orientation:d,dir:y,loop:u,children:e.jsx(_.div,{...N,ref:n})}):e.jsx(_.div,{...N,ref:n})})}),L="ToggleGroupItem",me=f.forwardRef((t,n)=>{const c=de(L,t.__scopeToggleGroup),l=ss(L,t.__scopeToggleGroup),i=oe(t.__scopeToggleGroup),d=c.value.includes(t.value),o=l.disabled||t.disabled,u={...t,pressed:d,disabled:o},j=f.useRef(null);return l.rovingFocus?e.jsx(we,{asChild:!0,...i,focusable:!o,active:d,ref:j,children:e.jsx(te,{...u,ref:n})}):e.jsx(te,{...u,ref:n})});me.displayName=L;var te=f.forwardRef((t,n)=>{const{__scopeToggleGroup:c,value:l,...i}=t,d=de(L,c),o={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},u=d.type==="single"?o:void 0;return e.jsx($,{...u,...i,ref:n,onPressedChange:j=>{j?d.onItemActivate(l):d.onItemDeactivate(l)}})}),xe=q,pe=me;const ge=Ge("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),as=p.forwardRef(({className:t,variant:n,size:c,...l},i)=>e.jsx(ie,{ref:i,className:V(ge({variant:n,size:c,className:t})),...l}));as.displayName=ie.displayName;const he=p.createContext({size:"default",variant:"default"}),A=p.forwardRef(({className:t,variant:n,size:c,children:l,...i},d)=>e.jsx(xe,{ref:d,className:V("flex items-center justify-center gap-1",t),...i,children:e.jsx(he.Provider,{value:{variant:n,size:c},children:l})}));A.displayName=xe.displayName;const S=p.forwardRef(({className:t,children:n,variant:c,size:l,...i},d)=>{const o=p.useContext(he);return e.jsx(pe,{ref:d,className:V(ge({variant:o.variant||c,size:o.size||l}),t),...i,children:n})});S.displayName=pe.displayName;function ys(){const{toast:t}=ze(),n=Ce(),[c,l]=p.useState(!1),[i,d]=p.useState(null),[o,u]=p.useState("all"),[j,w]=p.useState(""),[y,N]=p.useState("months"),[k,z]=p.useState(""),[O,F]=p.useState(!1),[r,m]=p.useState({address:"",submarket:void 0,assetType:"Building",buildingSize:void 0,landSize:void 0,sourceLink:void 0,notes:void 0,dealType:"sale",tenant:void 0,termMonths:void 0,rate:"10.00",rateType:void 0,commencement:void 0,concessions:void 0,saleDate:void 0,buyer:void 0,seller:void 0,price:void 0,pricePerSf:void 0,pricePerAcre:void 0}),{data:Q=[],isLoading:ve}=X({queryKey:["/api/market-comps"]}),{data:H=[]}=X({queryKey:["/api/submarkets"]}),{profile:K}=He(),je=p.useMemo(()=>{const s=(K?.submarkets||[]).map(g=>(g||"").trim()).filter(Boolean);if(s.length>0){const g=new Set,h=[];for(const M of s){const C=M.toLowerCase();g.has(C)||(g.add(C),h.push(M))}return h.sort((M,C)=>M.localeCompare(C))}const a=new Set,b=[];for(const g of H||[]){const h=(g?.name||"").trim();if(!h||!(g.isActive!==!1))continue;const C=h.toLowerCase();a.has(C)||(a.add(C),b.push(h))}return b.sort((g,h)=>g.localeCompare(h))},[H,K]);p.useEffect(()=>{if(r.dealType!=="sale")return;const s=r.price?Number(r.price):NaN,a=r.buildingSize?Number(r.buildingSize):NaN,b=r.landSize?Number(r.landSize):NaN;if(!Number.isNaN(s)&&!Number.isNaN(a)&&a>0){const g=Math.round(s/a);m(h=>({...h,pricePerSf:String(g)}))}if(!Number.isNaN(s)&&!Number.isNaN(b)&&b>0){const g=Math.round(s/b);m(h=>({...h,pricePerAcre:String(g)}))}},[r.price,r.buildingSize,r.landSize,r.dealType]);const I=()=>{m({address:"",submarket:void 0,assetType:"Building",buildingSize:void 0,landSize:void 0,sourceLink:void 0,notes:void 0,dealType:"sale",tenant:void 0,termMonths:void 0,rate:"10.00",rateType:void 0,commencement:void 0,concessions:void 0,saleDate:void 0,buyer:void 0,seller:void 0,price:void 0,pricePerSf:void 0,pricePerAcre:void 0}),d(null),l(!1),N("months"),z(""),F(!1)},U=B({mutationFn:async s=>(await R("POST","/api/market-comps",s)).json(),onSuccess:()=>{n.invalidateQueries({queryKey:["/api/market-comps"]}),t({title:"Market comp added"}),I()},onError:s=>t({title:"Failed to add comp",description:s.message,variant:"destructive"})}),J=B({mutationFn:async({id:s,patch:a})=>(await R("PATCH",`/api/market-comps/${s}`,a)).json(),onSuccess:()=>{n.invalidateQueries({queryKey:["/api/market-comps"]}),t({title:"Market comp updated"}),I()},onError:s=>t({title:"Failed to update comp",description:s.message,variant:"destructive"})}),fe=B({mutationFn:async s=>R("DELETE",`/api/market-comps/${s}`),onSuccess:()=>{n.invalidateQueries({queryKey:["/api/market-comps"]}),t({title:"Market comp deleted"})},onError:s=>t({title:"Failed to delete comp",description:s.message,variant:"destructive"})}),Ne=s=>{d(s),l(!0),m({address:s.address,submarket:s.submarket,assetType:s.assetType,buildingSize:s.buildingSize,landSize:s.landSize,sourceLink:s.sourceLink,notes:s.notes,dealType:s.dealType,tenant:s.tenant,termMonths:s.termMonths,rate:s.rate,rateType:s.rateType,commencement:s.commencement,concessions:s.concessions,saleDate:s.saleDate,buyer:s.buyer,seller:s.seller,price:s.price,pricePerSf:s.pricePerSf,pricePerAcre:s.pricePerAcre}),s.termMonths?(N("months"),z(s.termMonths)):z(""),F(!1)},ye=s=>{confirm("Delete this comp?")&&fe.mutate(s)},be=s=>{if(s.preventDefault(),!r.address.trim()){t({title:"Validation error",description:"Address is required",variant:"destructive"});return}const a={...r,termMonths:k===""?void 0:y==="years"?Number(k)*12:Number(k)};i?.id?J.mutate({id:i.id,patch:a}):U.mutate(a)},W=p.useMemo(()=>Q.filter(s=>{const a=o==="all"||s.dealType===o,b=j.toLowerCase(),g=[s.address,s.tenant,s.buyer,s.seller,s.submarket].filter(Boolean).some(h=>h.toLowerCase().includes(b));return a&&g}),[Q,o,j]),Te=s=>({Building:"bg-blue-100 text-blue-800",Land:"bg-green-100 text-green-800",Other:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800";return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Market Comps"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Track comparable leases and sales to build market knowledge"})]}),e.jsxs(Ee,{open:c,onOpenChange:l,children:[e.jsxs(Ae,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(Ve,{asChild:!0,children:e.jsx(P,{size:"icon","aria-label":"Create Market Comp",onClick:()=>{I(),l(!0)},children:e.jsx(Ke,{className:"h-4 w-4"})})})}),e.jsx(Fe,{children:e.jsx("p",{children:"Create Market Comp"})})]}),e.jsxs($e,{className:"max-w-[420px]",children:[e.jsxs(qe,{children:[e.jsx(Oe,{children:i?"Edit Comp":"Add Market Comp"}),e.jsx(Qe,{className:"text-xs",children:"Quickly log a lease or sale comp"})]}),e.jsxs("form",{onSubmit:be,className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{className:"text-xs",children:"Deal Type"}),e.jsxs(A,{type:"single",value:r.dealType,onValueChange:s=>s&&m(a=>({...a,dealType:s})),className:"mt-1",children:[e.jsx(S,{value:"sale",className:"h-8 px-3 text-xs",children:"Sale"}),e.jsx(S,{value:"lease",className:"h-8 px-3 text-xs",children:"Lease"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{className:"text-xs",children:"Asset Type"}),e.jsxs(A,{type:"single",value:r.assetType,onValueChange:s=>s&&m(a=>({...a,assetType:s})),className:"mt-1",children:[e.jsx(S,{value:"Building",className:"h-8 px-3 text-xs",children:"Building"}),e.jsx(S,{value:"Land",className:"h-8 px-3 text-xs",children:"Land"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{htmlFor:"address",className:"text-xs",children:"Address *"}),e.jsx(v,{id:"address",className:"h-10",value:r.address,onChange:s=>m(a=>({...a,address:s.target.value})),placeholder:"123 Main St",required:!0})]}),r.dealType==="sale"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx(v,{type:"number",className:"h-10 pl-6",min:"0",value:r.price||"",onChange:s=>m(a=>({...a,price:s.target.value||void 0})),placeholder:"e.g. 2500000"})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Date"}),e.jsx(v,{type:"date",className:"h-10",value:r.saleDate||"",onChange:s=>m(a=>({...a,saleDate:s.target.value||void 0}))})]}),r.assetType==="Building"?e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Size (SF)"}),e.jsx(v,{type:"number",className:"h-10",min:"0",value:r.buildingSize||"",onChange:s=>m(a=>({...a,buildingSize:s.target.value||void 0})),placeholder:"e.g. 15000"})]}):e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Acres"}),e.jsx(v,{type:"number",className:"h-10",min:"0",step:"0.01",value:r.landSize||"",onChange:s=>m(a=>({...a,landSize:s.target.value||void 0})),placeholder:"e.g. 2.5"})]}),e.jsxs("div",{className:"md:col-span-2 flex flex-wrap gap-2 pt-1",children:[r.assetType==="Building"&&r.pricePerSf&&e.jsxs(G,{variant:"secondary",className:"text-[11px]",children:["Price/SF: $",Number(r.pricePerSf).toLocaleString()]}),r.assetType==="Land"&&r.pricePerAcre&&e.jsxs(G,{variant:"secondary",className:"text-[11px]",children:["Price/Acre: $",Number(r.pricePerAcre).toLocaleString()]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Tenant"}),e.jsx(v,{className:"h-10",value:r.tenant||"",onChange:s=>m(a=>({...a,tenant:s.target.value||void 0})),placeholder:"Tenant name"})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Rate"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx(v,{type:"number",className:"h-10 pl-6",min:"0",step:"0.5",value:r.rate||"",onChange:s=>m(a=>({...a,rate:s.target.value||void 0})),placeholder:"10.00"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{className:"text-xs",children:"Term"}),e.jsx(v,{type:"number",className:"h-10",min:"0",value:k,onChange:s=>z(s.target.value===""?"":Number(s.target.value)),placeholder:"e.g. 5"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{className:"text-xs",children:"Unit"}),e.jsxs(A,{type:"single",value:y,onValueChange:s=>s&&N(s),className:"mt-1",children:[e.jsx(S,{value:"months",className:"h-8 px-3 text-xs",children:"mo"}),e.jsx(S,{value:"years",className:"h-8 px-3 text-xs",children:"yr"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Commencement"}),e.jsx(v,{type:"date",className:"h-10",value:r.commencement||"",onChange:s=>m(a=>({...a,commencement:s.target.value||void 0}))})]})]})]}),e.jsx("div",{children:e.jsx(P,{type:"button",variant:"outline",size:"sm",className:"h-8 text-xs",onClick:()=>F(s=>!s),children:O?"Hide details":"More details"})}),O&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.dealType==="sale"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Buyer"}),e.jsx(v,{className:"h-10",value:r.buyer||"",onChange:s=>m(a=>({...a,buyer:s.target.value||void 0}))})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs",children:"Seller"}),e.jsx(v,{className:"h-10",value:r.seller||"",onChange:s=>m(a=>({...a,seller:s.target.value||void 0}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{className:"text-xs",children:"Notes"}),e.jsx(Y,{rows:3,className:"text-sm",value:r.notes||"",onChange:s=>m(a=>({...a,notes:s.target.value||void 0}))})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{className:"text-xs",children:"Notes (TI/Free rent)"}),e.jsx(Y,{rows:3,className:"text-sm",value:r.concessions||"",onChange:s=>m(a=>({...a,concessions:s.target.value||void 0}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{className:"text-xs",children:"Submarket"}),e.jsxs(Z,{value:r.submarket||"",onValueChange:s=>m(a=>({...a,submarket:s})),children:[e.jsx(ee,{className:"h-10",children:e.jsx(se,{placeholder:"Select submarket"})}),e.jsxs(ae,{children:[je.map(s=>e.jsx(D,{value:s,children:s},s)),e.jsx(D,{value:"Other",children:"Other"})]})]})]})]})}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(P,{type:"submit",className:"h-9 text-sm",disabled:U.isPending||J.isPending,children:[i?"Update":"Create"," Comp"]}),e.jsx(P,{type:"button",className:"h-9 text-sm",variant:"outline",onClick:()=>l(!1),children:"Cancel"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(v,{placeholder:"Search (address, tenant, buyer, seller)",value:j,onChange:s=>w(s.target.value)}),e.jsxs(Z,{value:o,onValueChange:s=>u(s),children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"All Types"})}),e.jsxs(ae,{children:[e.jsx(D,{value:"all",children:"All Types"}),e.jsx(D,{value:"lease",children:"Lease"}),e.jsx(D,{value:"sale",children:"Sale"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:ve?e.jsx("div",{className:"col-span-full text-center py-8",children:"Loading comps..."}):W.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500 dark:text-gray-400",children:"No comps yet. Add your first one."}):W.map(s=>e.jsxs(Ie,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(Be,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(Re,{className:"text-lg",children:s.address}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>Ne(s),children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsx(P,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>ye(s.id),children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(G,{variant:"outline",children:s.submarket||"–"}),e.jsx(G,{className:Te(s.assetType),children:s.assetType}),e.jsx(G,{variant:s.dealType==="sale"?"secondary":"outline",className:s.dealType==="sale"?"bg-amber-100 text-amber-800":"",children:s.dealType==="sale"?"Sale":"Lease"})]})]}),e.jsxs(_e,{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[s.dealType==="lease"?e.jsxs("div",{className:"space-y-1",children:[s.tenant&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Tenant: ",s.tenant]}),s.termMonths&&e.jsxs("div",{children:["Term: ",s.termMonths," mo"]}),s.rate&&e.jsxs("div",{children:["Rate: $",s.rate]}),s.commencement&&e.jsxs("div",{children:["Commencement: ",s.commencement]}),s.concessions&&e.jsxs("div",{children:["TI/Free: ",s.concessions]})]}):e.jsxs("div",{className:"space-y-1",children:[s.saleDate&&e.jsxs("div",{children:["Date: ",s.saleDate]}),s.price&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Price: $",Number(s.price).toLocaleString()]}),s.pricePerSf&&e.jsxs("div",{children:["$/SF: $",Number(s.pricePerSf).toLocaleString()]}),s.pricePerAcre&&e.jsxs("div",{children:["$/Acre: $",Number(s.pricePerAcre).toLocaleString()]}),(s.buyer||s.seller)&&e.jsxs("div",{children:["Buyer/Seller: ",[s.buyer,s.seller].filter(Boolean).join(" / ")]})]}),s.notes&&e.jsxs("div",{className:"pt-1",children:["Notes: ",s.notes]})]})]},s.id))})]})})}export{ys as default};
