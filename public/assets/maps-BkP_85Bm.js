import{r as l,a as Te}from"./react-BUvn9Qyq.js";var Hn={exports:{}},It={};var Ms=l,xs=Symbol.for("react.element"),ws=Symbol.for("react.fragment"),Ss=Object.prototype.hasOwnProperty,Is=Ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Os={key:!0,ref:!0,__self:!0,__source:!0};function Kn(n,e,t){var i,s={},o=null,r=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(r=e.ref);for(i in e)Ss.call(e,i)&&!Os.hasOwnProperty(i)&&(s[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:xs,type:n,key:o,ref:r,props:s,_owner:Is.current}}It.Fragment=ws;It.jsx=Kn;It.jsxs=Kn;Hn.exports=It;var he=Hn.exports;function Ze(n){"@babel/helpers - typeof";return Ze=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(n)}function ks(n,e){if(Ze(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(Ze(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Ds(n){var e=ks(n,"string");return Ze(e)=="symbol"?e:e+""}function L(n,e,t){return(e=Ds(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Yn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var kt,mi;function _s(){if(mi)return kt;mi=1;var n=function(t,i,s,o,r,a,d,h){if(!t){var c;if(i===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[s,o,r,a,d,h],p=0;c=new Error(i.replace(/%s/g,function(){return u[p++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}};return kt=n,kt}var js=_s(),ae=Yn(js),N=l.createContext(null);function Fs(){ae(!!l.useContext,"useGoogleMap is React hook and requires React version 16.8+");var n=l.useContext(N);return ae(!!n,"useGoogleMap needs a GoogleMap available up in the tree"),n}function Ts(n,e,t){return Object.keys(n).reduce(function(s,o){return e(s,n[o],o)},t)}function Bs(n,e){Object.keys(n).forEach(t=>e(n[t],t))}function Rs(n,e,t,i){var s={},o=(r,a)=>{var d=t[a];d!==e[a]&&(s[a]=d,r(i,d))};return Bs(n,o),s}function Ns(n,e,t){var i=Ts(t,function(o,r,a){return typeof n[a]=="function"&&o.push(google.maps.event.addListener(e,r,n[a])),o},[]);return i}function As(n){google.maps.event.removeListener(n)}function V(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(As)}function W(n){var{updaterMap:e,eventMap:t,prevProps:i,nextProps:s,instance:o}=n,r=Ns(s,o,t);return Rs(e,i,s,o),r}var vi={onDblClick:"dblclick",onDragEnd:"dragend",onDragStart:"dragstart",onMapTypeIdChanged:"maptypeid_changed",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseDown:"mousedown",onMouseUp:"mouseup",onRightClick:"rightclick",onTilesLoaded:"tilesloaded",onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onDrag:"drag",onHeadingChanged:"heading_changed",onIdle:"idle",onProjectionChanged:"projection_changed",onResize:"resize",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed"},yi={extraMapTypes(n,e){e.forEach(function(i,s){n.mapTypes.set(String(s),i)})},center(n,e){n.setCenter(e)},clickableIcons(n,e){n.setClickableIcons(e)},heading(n,e){n.setHeading(e)},mapTypeId(n,e){n.setMapTypeId(e)},options(n,e){n.setOptions(e)},streetView(n,e){n.setStreetView(e)},tilt(n,e){n.setTilt(e)},zoom(n,e){n.setZoom(e)}};function Us(n){var{children:e,options:t,id:i,mapContainerStyle:s,mapContainerClassName:o,center:r,onClick:a,onDblClick:d,onDrag:h,onDragEnd:c,onDragStart:u,onMouseMove:p,onMouseOut:f,onMouseOver:g,onMouseDown:m,onMouseUp:C,onRightClick:E,onCenterChanged:P,onLoad:S,onUnmount:y}=n,[v,b]=l.useState(null),w=l.useRef(null),[k,M]=l.useState(null),[I,O]=l.useState(null),[_,U]=l.useState(null),[T,B]=l.useState(null),[G,K]=l.useState(null),[z,Y]=l.useState(null),[$,X]=l.useState(null),[Q,F]=l.useState(null),[ee,x]=l.useState(null),[oe,ne]=l.useState(null),[A,re]=l.useState(null),[j,Z]=l.useState(null);return l.useEffect(()=>{t&&v!==null&&v.setOptions(t)},[v,t]),l.useEffect(()=>{v!==null&&typeof r<"u"&&v.setCenter(r)},[v,r]),l.useEffect(()=>{v&&d&&(I!==null&&google.maps.event.removeListener(I),O(google.maps.event.addListener(v,"dblclick",d)))},[d]),l.useEffect(()=>{v&&c&&(_!==null&&google.maps.event.removeListener(_),U(google.maps.event.addListener(v,"dragend",c)))},[c]),l.useEffect(()=>{v&&u&&(T!==null&&google.maps.event.removeListener(T),B(google.maps.event.addListener(v,"dragstart",u)))},[u]),l.useEffect(()=>{v&&m&&(G!==null&&google.maps.event.removeListener(G),K(google.maps.event.addListener(v,"mousedown",m)))},[m]),l.useEffect(()=>{v&&p&&(z!==null&&google.maps.event.removeListener(z),Y(google.maps.event.addListener(v,"mousemove",p)))},[p]),l.useEffect(()=>{v&&f&&($!==null&&google.maps.event.removeListener($),X(google.maps.event.addListener(v,"mouseout",f)))},[f]),l.useEffect(()=>{v&&g&&(Q!==null&&google.maps.event.removeListener(Q),F(google.maps.event.addListener(v,"mouseover",g)))},[g]),l.useEffect(()=>{v&&C&&(ee!==null&&google.maps.event.removeListener(ee),x(google.maps.event.addListener(v,"mouseup",C)))},[C]),l.useEffect(()=>{v&&E&&(oe!==null&&google.maps.event.removeListener(oe),ne(google.maps.event.addListener(v,"rightclick",E)))},[E]),l.useEffect(()=>{v&&a&&(A!==null&&google.maps.event.removeListener(A),re(google.maps.event.addListener(v,"click",a)))},[a]),l.useEffect(()=>{v&&h&&(j!==null&&google.maps.event.removeListener(j),Z(google.maps.event.addListener(v,"drag",h)))},[h]),l.useEffect(()=>{v&&P&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(v,"center_changed",P)))},[a]),l.useEffect(()=>{var fe=w.current===null?null:new google.maps.Map(w.current,t);return b(fe),fe!==null&&S&&S(fe),()=>{fe!==null&&y&&y(fe)}},[]),he.jsx("div",{id:i,ref:w,style:s,className:o,children:he.jsx(N.Provider,{value:v,children:v!==null?e:null})})}l.memo(Us);class Pa extends l.PureComponent{constructor(){super(...arguments),L(this,"state",{map:null}),L(this,"registeredEvents",[]),L(this,"mapRef",null),L(this,"getInstance",()=>this.mapRef===null?null:new google.maps.Map(this.mapRef,this.props.options)),L(this,"panTo",e=>{var t=this.getInstance();t&&t.panTo(e)}),L(this,"setMapCallback",()=>{this.state.map!==null&&this.props.onLoad&&this.props.onLoad(this.state.map)}),L(this,"getRef",e=>{this.mapRef=e})}componentDidMount(){var e=this.getInstance();this.registeredEvents=W({updaterMap:yi,eventMap:vi,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{map:e}},this.setMapCallback)}componentDidUpdate(e){this.state.map!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:yi,eventMap:vi,prevProps:e,nextProps:this.props,instance:this.state.map}))}componentWillUnmount(){this.state.map!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.map),V(this.registeredEvents))}render(){return he.jsx("div",{id:this.props.id,ref:this.getRef,style:this.props.mapContainerStyle,className:this.props.mapContainerClassName,children:he.jsx(N.Provider,{value:this.state.map,children:this.state.map!==null?this.props.children:null})})}}function Ci(n,e,t,i,s,o,r){try{var a=n[o](r),d=a.value}catch(h){return void t(h)}a.done?e(d):Promise.resolve(d).then(i,s)}function Xn(n){return function(){var e=this,t=arguments;return new Promise(function(i,s){var o=n.apply(e,t);function r(d){Ci(o,i,s,r,a,"next",d)}function a(d){Ci(o,i,s,r,a,"throw",d)}r(void 0)})}}function qn(n){var{googleMapsApiKey:e,googleMapsClientId:t,version:i="weekly",language:s,region:o,libraries:r,channel:a,mapIds:d,authReferrerPolicy:h,apiUrl:c="https://maps.googleapis.com"}=n,u=[];return ae(e&&t||!(e&&t),"You need to specify either googleMapsApiKey or googleMapsClientId for @react-google-maps/api load script to work. You cannot use both at the same time."),e?u.push("key=".concat(e)):t&&u.push("client=".concat(t)),i&&u.push("v=".concat(i)),s&&u.push("language=".concat(s)),o&&u.push("region=".concat(o)),r&&r.length&&u.push("libraries=".concat(r.sort().join(","))),a&&u.push("channel=".concat(a)),d&&d.length&&u.push("map_ids=".concat(d.join(","))),h&&u.push("auth_referrer_policy=".concat(h)),u.push("loading=async"),u.push("callback=initMap"),"".concat(c,"/maps/api/js?").concat(u.join("&"))}var Pe=typeof document<"u";function Jn(n){var{url:e,id:t,nonce:i}=n;return Pe?new Promise(function(o,r){var a=document.getElementById(t),d=window;if(a){var h=a.getAttribute("data-state");if(a.src===e&&h!=="error"){if(h==="ready")return o(t);var c=d.initMap,u=a.onerror;d.initMap=function(){c&&c(),o(t)},a.onerror=function(f){u&&u(f),r(f)};return}else a.remove()}var p=document.createElement("script");p.type="text/javascript",p.src=e,p.id=t,p.async=!0,p.nonce=i||"",p.onerror=function(g){p.setAttribute("data-state","error"),r(g)},d.initMap=function(){p.setAttribute("data-state","ready"),o(t)},document.head.appendChild(p)}).catch(s=>{throw s}):Promise.reject(new Error("document is undefined"))}function Pi(n){var e=n.href;return e&&(e.indexOf("https://fonts.googleapis.com/css?family=Roboto")===0||e.indexOf("https://fonts.googleapis.com/css?family=Google+Sans+Text")===0)?!0:n.tagName.toLowerCase()==="style"&&n.styleSheet&&n.styleSheet.cssText&&n.styleSheet.cssText.replace(`\r
`,"").indexOf(".gm-style")===0?(n.styleSheet.cssText="",!0):n.tagName.toLowerCase()==="style"&&n.innerHTML&&n.innerHTML.replace(`\r
`,"").indexOf(".gm-style")===0?(n.innerHTML="",!0):n.tagName.toLowerCase()==="style"&&!n.styleSheet&&!n.innerHTML}function $t(){var n=document.getElementsByTagName("head")[0];if(n){var e=n.insertBefore.bind(n);n.insertBefore=function(s,o){return Pi(s)||Reflect.apply(e,n,[s,o]),s};var t=n.appendChild.bind(n);n.appendChild=function(s){return Pi(s)||Reflect.apply(t,n,[s]),s}}}var Ae=!1;function Qn(){return he.jsx("div",{children:"Loading..."})}var He={id:"script-loader",version:"weekly"};class Ws extends l.PureComponent{constructor(){super(...arguments),L(this,"check",null),L(this,"state",{loaded:!1}),L(this,"cleanupCallback",()=>{delete window.google.maps,this.injectScript()}),L(this,"isCleaningUp",Xn(function*(){function e(t){if(!Ae)t();else if(Pe)var i=window.setInterval(function(){Ae||(window.clearInterval(i),t())},1)}return new Promise(e)})),L(this,"cleanup",()=>{Ae=!0;var e=document.getElementById(this.props.id);e&&e.parentNode&&e.parentNode.removeChild(e),Array.prototype.slice.call(document.getElementsByTagName("script")).filter(function(i){return typeof i.src=="string"&&i.src.includes("maps.googleapis")}).forEach(function(i){i.parentNode&&i.parentNode.removeChild(i)}),Array.prototype.slice.call(document.getElementsByTagName("link")).filter(function(i){return i.href==="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans"}).forEach(function(i){i.parentNode&&i.parentNode.removeChild(i)}),Array.prototype.slice.call(document.getElementsByTagName("style")).filter(function(i){return i.innerText!==void 0&&i.innerText.length>0&&i.innerText.includes(".gm-")}).forEach(function(i){i.parentNode&&i.parentNode.removeChild(i)})}),L(this,"injectScript",()=>{this.props.preventGoogleFontsLoading&&$t(),ae(!!this.props.id,'LoadScript requires "id" prop to be a string: %s',this.props.id);var e={id:this.props.id,nonce:this.props.nonce,url:qn(this.props)};Jn(e).then(()=>{this.props.onLoad&&this.props.onLoad(),this.setState(function(){return{loaded:!0}})}).catch(t=>{this.props.onError&&this.props.onError(t)})}),L(this,"getRef",e=>{this.check=e})}componentDidMount(){if(Pe){if(window.google&&window.google.maps&&!Ae)return;this.isCleaningUp().then(this.injectScript).catch(function(t){})}}componentDidUpdate(e){this.props.libraries,e.libraries,Pe&&e.language!==this.props.language&&(this.cleanup(),this.setState(function(){return{loaded:!1}},this.cleanupCallback))}componentWillUnmount(){if(Pe){this.cleanup();var e=()=>{this.check||(delete window.google,Ae=!1)};window.setTimeout(e,1),this.props.onUnmount&&this.props.onUnmount()}}render(){return he.jsxs(he.Fragment,{children:[he.jsx("div",{ref:this.getRef}),this.state.loaded?this.props.children:this.props.loadingElement||he.jsx(Qn,{})]})}}L(Ws,"defaultProps",He);function Gs(n,e){if(n==null)return{};var t={};for(var i in n)if({}.hasOwnProperty.call(n,i)){if(e.includes(i))continue;t[i]=n[i]}return t}function Zt(n,e){if(n==null)return{};var t,i,s=Gs(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)t=o[i],e.includes(t)||{}.propertyIsEnumerable.call(n,t)&&(s[t]=n[t])}return s}var Li;function zs(n){var{id:e=He.id,version:t=He.version,nonce:i,googleMapsApiKey:s,googleMapsClientId:o,language:r,region:a,libraries:d,preventGoogleFontsLoading:h,channel:c,mapIds:u,authReferrerPolicy:p,apiUrl:f="https://maps.googleapis.com"}=n,g=l.useRef(!1),[m,C]=l.useState(!1),[E,P]=l.useState(void 0);l.useEffect(function(){return g.current=!0,()=>{g.current=!1}},[]),l.useEffect(function(){Pe&&h&&$t()},[h]),l.useEffect(function(){m&&ae(!!window.google,"useLoadScript was marked as loaded, but window.google is not present. Something went wrong.")},[m]);var S=qn({version:t,googleMapsApiKey:s,googleMapsClientId:o,language:r,region:a,libraries:d,channel:c,mapIds:u,authReferrerPolicy:p,apiUrl:f});l.useEffect(function(){if(!Pe)return;function b(){g.current&&(C(!0),Li=S)}if(window.google&&window.google.maps&&Li===S){b();return}Jn({id:e,url:S,nonce:i}).then(b).catch(function(k){g.current&&P(k)})},[e,S,i]);var y=l.useRef(void 0);return l.useEffect(function(){y.current&&y.current,y.current=d},[d]),{isLoaded:m,loadError:E,url:S}}var Vs=["loadingElement","onLoad","onError","onUnmount","children"],$s=he.jsx(Qn,{});function Zs(n){var{loadingElement:e,onLoad:t,onError:i,onUnmount:s,children:o}=n,r=Zt(n,Vs),{isLoaded:a,loadError:d}=zs(r);return l.useEffect(function(){a&&typeof t=="function"&&t()},[a,t]),l.useEffect(function(){d&&typeof i=="function"&&i(d)},[d,i]),l.useEffect(function(){return()=>{s&&s()}},[s]),a?o:e||$s}l.memo(Zs);function Hs(n,e,t,i){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(c){try{h(i.next(c))}catch(u){r(u)}}function d(c){try{h(i.throw(c))}catch(u){r(u)}}function h(c){c.done?o(c.value):s(c.value).then(a,d)}h((i=i.apply(n,[])).next())})}function Ks(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ys=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,s,o;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!n(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[s]))return!1;for(s=i;s--!==0;){var r=o[s];if(!n(e[r],t[r]))return!1}return!0}return e!==e&&t!==t},Xs=Ks(Ys),bi="__googleMapsScriptId",_e;(function(n){n[n.INITIALIZED=0]="INITIALIZED",n[n.LOADING=1]="LOADING",n[n.SUCCESS=2]="SUCCESS",n[n.FAILURE=3]="FAILURE"})(_e||(_e={}));class Se{constructor(e){var{apiKey:t,authReferrerPolicy:i,channel:s,client:o,id:r=bi,language:a,libraries:d=[],mapIds:h,nonce:c,region:u,retries:p=3,url:f="https://maps.googleapis.com/maps/api/js",version:g}=e;if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=i,this.channel=s,this.client=o,this.id=r||bi,this.language=a,this.libraries=d,this.mapIds=h,this.nonce=c,this.region=u,this.retries=p,this.url=f,this.version=g,Se.instance){if(!Xs(this.options,Se.instance.options))throw new Error("Loader must not be called again with different options. ".concat(JSON.stringify(this.options)," !== ").concat(JSON.stringify(Se.instance.options)));return Se.instance}Se.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?_e.FAILURE:this.done?_e.SUCCESS:this.loading?_e.LOADING:_e.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){var e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+="&key=".concat(this.apiKey)),this.channel&&(e+="&channel=".concat(this.channel)),this.client&&(e+="&client=".concat(this.client)),this.libraries.length>0&&(e+="&libraries=".concat(this.libraries.join(","))),this.language&&(e+="&language=".concat(this.language)),this.region&&(e+="&region=".concat(this.region)),this.version&&(e+="&v=".concat(this.version)),this.mapIds&&(e+="&map_ids=".concat(this.mapIds.join(","))),this.authReferrerPolicy&&(e+="&auth_referrer_policy=".concat(this.authReferrerPolicy)),e}deleteScript(){var e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(i=>{i?t(i.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}var i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach(o=>!i[o]&&delete i[o]),!((t=(e=window?.google)===null||e===void 0?void 0:e.maps)===null||t===void 0)&&t.importLibrary||(o=>{var r,a,d,h="The Google Maps JavaScript API",c="google",u="importLibrary",p="__ib__",f=document,g=window;g=g[c]||(g[c]={});var m=g.maps||(g.maps={}),C=new Set,E=new URLSearchParams,P=()=>r||(r=new Promise((S,y)=>Hs(this,void 0,void 0,function*(){var v;yield a=f.createElement("script"),a.id=this.id,E.set("libraries",[...C]+"");for(d in o)E.set(d.replace(/[A-Z]/g,b=>"_"+b[0].toLowerCase()),o[d]);E.set("callback",c+".maps."+p),a.src=this.url+"?"+E,m[p]=S,a.onerror=()=>r=y(Error(h+" could not load.")),a.nonce=this.nonce||((v=f.querySelector("script[nonce]"))===null||v===void 0?void 0:v.nonce)||"",f.head.append(a)})));m[u]||(m[u]=function(S){for(var y=arguments.length,v=new Array(y>1?y-1:0),b=1;b<y;b++)v[b-1]=arguments[b];return C.add(S)&&P().then(()=>m[u](S,...v))})})(i);var s=this.libraries.map(o=>this.importLibrary(o));s.length||s.push(this.importLibrary("core")),Promise.all(s).then(()=>this.callback(),o=>{var r=new ErrorEvent("error",{error:o});this.loadErrorCallback(r)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){var t=this.errors.length*Math.pow(2,this.errors.length);setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){this.callback();return}this.loading=!0,this.setScript()}}}var qs=["maps"];function La(n){var{id:e=He.id,version:t=He.version,nonce:i,googleMapsApiKey:s,language:o,region:r,libraries:a=qs,preventGoogleFontsLoading:d,mapIds:h,authReferrerPolicy:c}=n,u=l.useRef(!1),[p,f]=l.useState(!1),[g,m]=l.useState(void 0);l.useEffect(function(){return u.current=!0,()=>{u.current=!1}},[]);var C=l.useMemo(()=>new Se({id:e,apiKey:s,version:t,libraries:a,language:o||"en",region:r||"US",mapIds:h||[],nonce:i||"",authReferrerPolicy:c||"origin"}),[e,s,t,a,o,r,h,i,c]);l.useEffect(function(){p||C.load().then(()=>{u.current&&f(!0)}).catch(S=>{m(S)})},[]),l.useEffect(()=>{Pe&&d&&$t()},[d]);var E=l.useRef();return l.useEffect(()=>{E.current&&E.current,E.current=a},[a]),{isLoaded:p,loadError:g}}function Ei(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function vt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ei(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ei(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Mi={},xi={options(n,e){n.setOptions(e)}};function Js(n){var{options:e,onLoad:t,onUnmount:i}=n,s=l.useContext(N),[o,r]=l.useState(null);return l.useEffect(()=>{o!==null&&o.setMap(s)},[s]),l.useEffect(()=>{e&&o!==null&&o.setOptions(e)},[o,e]),l.useEffect(()=>{var a=new google.maps.TrafficLayer(vt(vt({},e),{},{map:s}));return r(a),t&&t(a),()=>{o!==null&&(i&&i(o),o.setMap(null))}},[]),null}l.memo(Js);class Qs extends l.PureComponent{constructor(){super(...arguments),L(this,"state",{trafficLayer:null}),L(this,"setTrafficLayerCallback",()=>{this.state.trafficLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.trafficLayer)}),L(this,"registeredEvents",[])}componentDidMount(){var e=new google.maps.TrafficLayer(vt(vt({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:xi,eventMap:Mi,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{trafficLayer:e}},this.setTrafficLayerCallback)}componentDidUpdate(e){this.state.trafficLayer!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:xi,eventMap:Mi,prevProps:e,nextProps:this.props,instance:this.state.trafficLayer}))}componentWillUnmount(){this.state.trafficLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.trafficLayer),V(this.registeredEvents),this.state.trafficLayer.setMap(null))}render(){return null}}L(Qs,"contextType",N);function eo(n){var{onLoad:e,onUnmount:t}=n,i=l.useContext(N),[s,o]=l.useState(null);return l.useEffect(()=>{s!==null&&s.setMap(i)},[i]),l.useEffect(()=>{var r=new google.maps.BicyclingLayer;return o(r),r.setMap(i),e&&e(r),()=>{r!==null&&(t&&t(r),r.setMap(null))}},[]),null}l.memo(eo);class to extends l.PureComponent{constructor(){super(...arguments),L(this,"state",{bicyclingLayer:null}),L(this,"setBicyclingLayerCallback",()=>{this.state.bicyclingLayer!==null&&(this.state.bicyclingLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.bicyclingLayer))})}componentDidMount(){var e=new google.maps.BicyclingLayer;this.setState(()=>({bicyclingLayer:e}),this.setBicyclingLayerCallback)}componentWillUnmount(){this.state.bicyclingLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.bicyclingLayer),this.state.bicyclingLayer.setMap(null))}render(){return null}}L(to,"contextType",N);function io(n){var{onLoad:e,onUnmount:t}=n,i=l.useContext(N),[s,o]=l.useState(null);return l.useEffect(()=>{s!==null&&s.setMap(i)},[i]),l.useEffect(()=>{var r=new google.maps.TransitLayer;return o(r),r.setMap(i),e&&e(r),()=>{s!==null&&(t&&t(s),s.setMap(null))}},[]),null}l.memo(io);class no extends l.PureComponent{constructor(){super(...arguments),L(this,"state",{transitLayer:null}),L(this,"setTransitLayerCallback",()=>{this.state.transitLayer!==null&&(this.state.transitLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.transitLayer))})}componentDidMount(){var e=new google.maps.TransitLayer;this.setState(function(){return{transitLayer:e}},this.setTransitLayerCallback)}componentWillUnmount(){this.state.transitLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.transitLayer),this.state.transitLayer.setMap(null))}render(){return null}}L(no,"contextType",N);function wi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function yt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wi(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Si={onCircleComplete:"circlecomplete",onMarkerComplete:"markercomplete",onOverlayComplete:"overlaycomplete",onPolygonComplete:"polygoncomplete",onPolylineComplete:"polylinecomplete",onRectangleComplete:"rectanglecomplete"},Ii={drawingMode(n,e){n.setDrawingMode(e)},options(n,e){n.setOptions(e)}};function so(n){var{options:e,drawingMode:t,onCircleComplete:i,onMarkerComplete:s,onOverlayComplete:o,onPolygonComplete:r,onPolylineComplete:a,onRectangleComplete:d,onLoad:h,onUnmount:c}=n,u=l.useContext(N),[p,f]=l.useState(null),[g,m]=l.useState(null),[C,E]=l.useState(null),[P,S]=l.useState(null),[y,v]=l.useState(null),[b,w]=l.useState(null),[k,M]=l.useState(null);return l.useEffect(()=>{p!==null&&p.setMap(u)},[u]),l.useEffect(()=>{e&&p!==null&&p.setOptions(e)},[p,e]),l.useEffect(()=>{p!==null&&p.setDrawingMode(t??null)},[p,t]),l.useEffect(()=>{p&&i&&(g!==null&&google.maps.event.removeListener(g),m(google.maps.event.addListener(p,"circlecomplete",i)))},[p,i]),l.useEffect(()=>{p&&s&&(C!==null&&google.maps.event.removeListener(C),E(google.maps.event.addListener(p,"markercomplete",s)))},[p,s]),l.useEffect(()=>{p&&o&&(P!==null&&google.maps.event.removeListener(P),S(google.maps.event.addListener(p,"overlaycomplete",o)))},[p,o]),l.useEffect(()=>{p&&r&&(y!==null&&google.maps.event.removeListener(y),v(google.maps.event.addListener(p,"polygoncomplete",r)))},[p,r]),l.useEffect(()=>{p&&a&&(b!==null&&google.maps.event.removeListener(b),w(google.maps.event.addListener(p,"polylinecomplete",a)))},[p,a]),l.useEffect(()=>{p&&d&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(p,"rectanglecomplete",d)))},[p,d]),l.useEffect(()=>{ae(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing);var I=new google.maps.drawing.DrawingManager(yt(yt({},e),{},{map:u}));return t&&I.setDrawingMode(t),i&&m(google.maps.event.addListener(I,"circlecomplete",i)),s&&E(google.maps.event.addListener(I,"markercomplete",s)),o&&S(google.maps.event.addListener(I,"overlaycomplete",o)),r&&v(google.maps.event.addListener(I,"polygoncomplete",r)),a&&w(google.maps.event.addListener(I,"polylinecomplete",a)),d&&M(google.maps.event.addListener(I,"rectanglecomplete",d)),f(I),h&&h(I),()=>{p!==null&&(g&&google.maps.event.removeListener(g),C&&google.maps.event.removeListener(C),P&&google.maps.event.removeListener(P),y&&google.maps.event.removeListener(y),b&&google.maps.event.removeListener(b),k&&google.maps.event.removeListener(k),c&&c(p),p.setMap(null))}},[]),null}l.memo(so);class oo extends l.PureComponent{constructor(e){super(e),L(this,"registeredEvents",[]),L(this,"state",{drawingManager:null}),L(this,"setDrawingManagerCallback",()=>{this.state.drawingManager!==null&&this.props.onLoad&&this.props.onLoad(this.state.drawingManager)}),ae(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing)}componentDidMount(){var e=new google.maps.drawing.DrawingManager(yt(yt({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:Ii,eventMap:Si,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{drawingManager:e}},this.setDrawingManagerCallback)}componentDidUpdate(e){this.state.drawingManager!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Ii,eventMap:Si,prevProps:e,nextProps:this.props,instance:this.state.drawingManager}))}componentWillUnmount(){this.state.drawingManager!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.drawingManager),V(this.registeredEvents),this.state.drawingManager.setMap(null))}render(){return null}}L(oo,"contextType",N);function Oi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function je(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Oi(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Oi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var ki={onAnimationChanged:"animation_changed",onClick:"click",onClickableChanged:"clickable_changed",onCursorChanged:"cursor_changed",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDraggableChanged:"draggable_changed",onDragStart:"dragstart",onFlatChanged:"flat_changed",onIconChanged:"icon_changed",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPositionChanged:"position_changed",onRightClick:"rightclick",onShapeChanged:"shape_changed",onTitleChanged:"title_changed",onVisibleChanged:"visible_changed",onZindexChanged:"zindex_changed"},Di={animation(n,e){n.setAnimation(e)},clickable(n,e){n.setClickable(e)},cursor(n,e){n.setCursor(e)},draggable(n,e){n.setDraggable(e)},icon(n,e){n.setIcon(e)},label(n,e){n.setLabel(e)},map(n,e){n.setMap(e)},opacity(n,e){n.setOpacity(e)},options(n,e){n.setOptions(e)},position(n,e){n.setPosition(e)},shape(n,e){n.setShape(e)},title(n,e){n.setTitle(e)},visible(n,e){n.setVisible(e)},zIndex(n,e){n.setZIndex(e)}},Ct={};function ro(n){var{position:e,options:t,clusterer:i,noClustererRedraw:s,children:o,draggable:r,visible:a,animation:d,clickable:h,cursor:c,icon:u,label:p,opacity:f,shape:g,title:m,zIndex:C,onClick:E,onDblClick:P,onDrag:S,onDragEnd:y,onDragStart:v,onMouseOut:b,onMouseOver:w,onMouseUp:k,onMouseDown:M,onRightClick:I,onClickableChanged:O,onCursorChanged:_,onAnimationChanged:U,onDraggableChanged:T,onFlatChanged:B,onIconChanged:G,onPositionChanged:K,onShapeChanged:z,onTitleChanged:Y,onVisibleChanged:$,onZindexChanged:X,onLoad:Q,onUnmount:F}=n,ee=l.useContext(N),[x,oe]=l.useState(null),[ne,A]=l.useState(null),[re,j]=l.useState(null),[Z,fe]=l.useState(null),[ve,Re]=l.useState(null),[te,qt]=l.useState(null),[Xe,Jt]=l.useState(null),[qe,Qt]=l.useState(null),[Je,ei]=l.useState(null),[Qe,ti]=l.useState(null),[ii,ni]=l.useState(null),[et,si]=l.useState(null),[tt,oi]=l.useState(null),[it,ri]=l.useState(null),[nt,ai]=l.useState(null),[st,li]=l.useState(null),[ot,di]=l.useState(null),[rt,hi]=l.useState(null),[ci,ui]=l.useState(null),[at,pi]=l.useState(null),[lt,gi]=l.useState(null),[dt,fi]=l.useState(null);l.useEffect(()=>{x!==null&&x.setMap(ee)},[ee]),l.useEffect(()=>{typeof t<"u"&&x!==null&&x.setOptions(t)},[x,t]),l.useEffect(()=>{typeof r<"u"&&x!==null&&x.setDraggable(r)},[x,r]),l.useEffect(()=>{e&&x!==null&&x.setPosition(e)},[x,e]),l.useEffect(()=>{typeof a<"u"&&x!==null&&x.setVisible(a)},[x,a]),l.useEffect(()=>{x?.setAnimation(d)},[x,d]),l.useEffect(()=>{x&&h!==void 0&&x.setClickable(h)},[x,h]),l.useEffect(()=>{x&&c!==void 0&&x.setCursor(c)},[x,c]),l.useEffect(()=>{x&&u!==void 0&&x.setIcon(u)},[x,u]),l.useEffect(()=>{x&&p!==void 0&&x.setLabel(p)},[x,p]),l.useEffect(()=>{x&&f!==void 0&&x.setOpacity(f)},[x,f]),l.useEffect(()=>{x&&g!==void 0&&x.setShape(g)},[x,g]),l.useEffect(()=>{x&&m!==void 0&&x.setTitle(m)},[x,m]),l.useEffect(()=>{x&&C!==void 0&&x.setZIndex(C)},[x,C]),l.useEffect(()=>{x&&P&&(ne!==null&&google.maps.event.removeListener(ne),A(google.maps.event.addListener(x,"dblclick",P)))},[P]),l.useEffect(()=>{x&&y&&(re!==null&&google.maps.event.removeListener(re),j(google.maps.event.addListener(x,"dragend",y)))},[y]),l.useEffect(()=>{x&&v&&(Z!==null&&google.maps.event.removeListener(Z),fe(google.maps.event.addListener(x,"dragstart",v)))},[v]),l.useEffect(()=>{x&&M&&(ve!==null&&google.maps.event.removeListener(ve),Re(google.maps.event.addListener(x,"mousedown",M)))},[M]),l.useEffect(()=>{x&&b&&(te!==null&&google.maps.event.removeListener(te),qt(google.maps.event.addListener(x,"mouseout",b)))},[b]),l.useEffect(()=>{x&&w&&(Xe!==null&&google.maps.event.removeListener(Xe),Jt(google.maps.event.addListener(x,"mouseover",w)))},[w]),l.useEffect(()=>{x&&k&&(qe!==null&&google.maps.event.removeListener(qe),Qt(google.maps.event.addListener(x,"mouseup",k)))},[k]),l.useEffect(()=>{x&&I&&(Je!==null&&google.maps.event.removeListener(Je),ei(google.maps.event.addListener(x,"rightclick",I)))},[I]),l.useEffect(()=>{x&&E&&(Qe!==null&&google.maps.event.removeListener(Qe),ti(google.maps.event.addListener(x,"click",E)))},[E]),l.useEffect(()=>{x&&S&&(ii!==null&&google.maps.event.removeListener(ii),ni(google.maps.event.addListener(x,"drag",S)))},[S]),l.useEffect(()=>{x&&O&&(et!==null&&google.maps.event.removeListener(et),si(google.maps.event.addListener(x,"clickable_changed",O)))},[O]),l.useEffect(()=>{x&&_&&(tt!==null&&google.maps.event.removeListener(tt),oi(google.maps.event.addListener(x,"cursor_changed",_)))},[_]),l.useEffect(()=>{x&&U&&(it!==null&&google.maps.event.removeListener(it),ri(google.maps.event.addListener(x,"animation_changed",U)))},[U]),l.useEffect(()=>{x&&T&&(nt!==null&&google.maps.event.removeListener(nt),ai(google.maps.event.addListener(x,"draggable_changed",T)))},[T]),l.useEffect(()=>{x&&B&&(st!==null&&google.maps.event.removeListener(st),li(google.maps.event.addListener(x,"flat_changed",B)))},[B]),l.useEffect(()=>{x&&G&&(ot!==null&&google.maps.event.removeListener(ot),di(google.maps.event.addListener(x,"icon_changed",G)))},[G]),l.useEffect(()=>{x&&K&&(rt!==null&&google.maps.event.removeListener(rt),hi(google.maps.event.addListener(x,"position_changed",K)))},[K]),l.useEffect(()=>{x&&z&&(ci!==null&&google.maps.event.removeListener(ci),ui(google.maps.event.addListener(x,"shape_changed",z)))},[z]),l.useEffect(()=>{x&&Y&&(at!==null&&google.maps.event.removeListener(at),pi(google.maps.event.addListener(x,"title_changed",Y)))},[Y]),l.useEffect(()=>{x&&$&&(lt!==null&&google.maps.event.removeListener(lt),gi(google.maps.event.addListener(x,"visible_changed",$)))},[$]),l.useEffect(()=>{x&&X&&(dt!==null&&google.maps.event.removeListener(dt),fi(google.maps.event.addListener(x,"zindex_changed",X)))},[X]),l.useEffect(()=>{var Ne=je(je(je({},t||Ct),i?Ct:{map:ee}),{},{position:e}),R=new google.maps.Marker(Ne);return i?i.addMarker(R,!!s):R.setMap(ee),e&&R.setPosition(e),typeof a<"u"&&R.setVisible(a),typeof r<"u"&&R.setDraggable(r),typeof h<"u"&&R.setClickable(h),typeof c=="string"&&R.setCursor(c),u&&R.setIcon(u),typeof p<"u"&&R.setLabel(p),typeof f<"u"&&R.setOpacity(f),g&&R.setShape(g),typeof m=="string"&&R.setTitle(m),typeof C=="number"&&R.setZIndex(C),P&&A(google.maps.event.addListener(R,"dblclick",P)),y&&j(google.maps.event.addListener(R,"dragend",y)),v&&fe(google.maps.event.addListener(R,"dragstart",v)),M&&Re(google.maps.event.addListener(R,"mousedown",M)),b&&qt(google.maps.event.addListener(R,"mouseout",b)),w&&Jt(google.maps.event.addListener(R,"mouseover",w)),k&&Qt(google.maps.event.addListener(R,"mouseup",k)),I&&ei(google.maps.event.addListener(R,"rightclick",I)),E&&ti(google.maps.event.addListener(R,"click",E)),S&&ni(google.maps.event.addListener(R,"drag",S)),O&&si(google.maps.event.addListener(R,"clickable_changed",O)),_&&oi(google.maps.event.addListener(R,"cursor_changed",_)),U&&ri(google.maps.event.addListener(R,"animation_changed",U)),T&&ai(google.maps.event.addListener(R,"draggable_changed",T)),B&&li(google.maps.event.addListener(R,"flat_changed",B)),G&&di(google.maps.event.addListener(R,"icon_changed",G)),K&&hi(google.maps.event.addListener(R,"position_changed",K)),z&&ui(google.maps.event.addListener(R,"shape_changed",z)),Y&&pi(google.maps.event.addListener(R,"title_changed",Y)),$&&gi(google.maps.event.addListener(R,"visible_changed",$)),X&&fi(google.maps.event.addListener(R,"zindex_changed",X)),oe(R),Q&&Q(R),()=>{ne!==null&&google.maps.event.removeListener(ne),re!==null&&google.maps.event.removeListener(re),Z!==null&&google.maps.event.removeListener(Z),ve!==null&&google.maps.event.removeListener(ve),te!==null&&google.maps.event.removeListener(te),Xe!==null&&google.maps.event.removeListener(Xe),qe!==null&&google.maps.event.removeListener(qe),Je!==null&&google.maps.event.removeListener(Je),Qe!==null&&google.maps.event.removeListener(Qe),et!==null&&google.maps.event.removeListener(et),tt!==null&&google.maps.event.removeListener(tt),it!==null&&google.maps.event.removeListener(it),nt!==null&&google.maps.event.removeListener(nt),st!==null&&google.maps.event.removeListener(st),ot!==null&&google.maps.event.removeListener(ot),rt!==null&&google.maps.event.removeListener(rt),at!==null&&google.maps.event.removeListener(at),lt!==null&&google.maps.event.removeListener(lt),dt!==null&&google.maps.event.removeListener(dt),F&&F(R),i?i.removeMarker(R,!!s):R&&R.setMap(null)}},[]);var Es=l.useMemo(()=>o?l.Children.map(o,Ne=>{if(!l.isValidElement(Ne))return Ne;var R=Ne;return l.cloneElement(R,{anchor:x})}):null,[o,x]);return he.jsx(he.Fragment,{children:Es})||null}l.memo(ro);class ao extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[])}componentDidMount(){var e=this;return Xn(function*(){var t=je(je(je({},e.props.options||Ct),e.props.clusterer?Ct:{map:e.context}),{},{position:e.props.position});e.marker=new google.maps.Marker(t),e.props.clusterer?e.props.clusterer.addMarker(e.marker,!!e.props.noClustererRedraw):e.marker.setMap(e.context),e.registeredEvents=W({updaterMap:Di,eventMap:ki,prevProps:{},nextProps:e.props,instance:e.marker}),e.props.onLoad&&e.props.onLoad(e.marker)})()}componentDidUpdate(e){this.marker&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Di,eventMap:ki,prevProps:e,nextProps:this.props,instance:this.marker}))}componentWillUnmount(){this.marker&&(this.props.onUnmount&&this.props.onUnmount(this.marker),V(this.registeredEvents),this.props.clusterer?this.props.clusterer.removeMarker(this.marker,!!this.props.noClustererRedraw):this.marker&&this.marker.setMap(null))}render(){var e=this.props.children?l.Children.map(this.props.children,t=>{if(!l.isValidElement(t))return t;var i=t;return l.cloneElement(i,{anchor:this.marker})}):null;return e||null}}L(ao,"contextType",N);var lo=function(){function n(e,t){e.getClusterer().extend(n,google.maps.OverlayView),this.cluster=e,this.clusterClassName=this.cluster.getClusterer().getClusterClass(),this.className=this.clusterClassName,this.styles=t,this.center=void 0,this.div=null,this.sums=null,this.visible=!1,this.boundsChangedListener=null,this.url="",this.height=0,this.width=0,this.anchorText=[0,0],this.anchorIcon=[0,0],this.textColor="black",this.textSize=11,this.textDecoration="none",this.fontWeight="bold",this.fontStyle="normal",this.fontFamily="Arial,sans-serif",this.backgroundPosition="0 0",this.cMouseDownInCluster=null,this.cDraggingMapByCluster=null,this.timeOut=null,this.setMap(e.getMap()),this.onBoundsChanged=this.onBoundsChanged.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onAdd=this.onAdd.bind(this),this.onRemove=this.onRemove.bind(this),this.draw=this.draw.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.useStyle=this.useStyle.bind(this),this.setCenter=this.setCenter.bind(this),this.getPosFromLatLng=this.getPosFromLatLng.bind(this)}return n.prototype.onBoundsChanged=function(){this.cDraggingMapByCluster=this.cMouseDownInCluster},n.prototype.onMouseDown=function(){this.cMouseDownInCluster=!0,this.cDraggingMapByCluster=!1},n.prototype.onClick=function(e){if(this.cMouseDownInCluster=!1,!this.cDraggingMapByCluster){var t=this.cluster.getClusterer();if(google.maps.event.trigger(t,"click",this.cluster),google.maps.event.trigger(t,"clusterclick",this.cluster),t.getZoomOnClick()){var i=t.getMaxZoom(),s=this.cluster.getBounds(),o=t.getMap();o!==null&&"fitBounds"in o&&o.fitBounds(s),this.timeOut=window.setTimeout(function(){var r=t.getMap();if(r!==null){"fitBounds"in r&&r.fitBounds(s);var a=r.getZoom()||0;i!==null&&a>i&&r.setZoom(i+1)}},100)}e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}},n.prototype.onMouseOver=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseover",this.cluster)},n.prototype.onMouseOut=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseout",this.cluster)},n.prototype.onAdd=function(){var e;this.div=document.createElement("div"),this.div.className=this.className,this.visible&&this.show(),(e=this.getPanes())===null||e===void 0||e.overlayMouseTarget.appendChild(this.div);var t=this.getMap();t!==null&&(this.boundsChangedListener=google.maps.event.addListener(t,"bounds_changed",this.onBoundsChanged),this.div.addEventListener("mousedown",this.onMouseDown),this.div.addEventListener("click",this.onClick),this.div.addEventListener("mouseover",this.onMouseOver),this.div.addEventListener("mouseout",this.onMouseOut))},n.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.hide(),this.boundsChangedListener!==null&&google.maps.event.removeListener(this.boundsChangedListener),this.div.removeEventListener("mousedown",this.onMouseDown),this.div.removeEventListener("click",this.onClick),this.div.removeEventListener("mouseover",this.onMouseOver),this.div.removeEventListener("mouseout",this.onMouseOut),this.div.parentNode.removeChild(this.div),this.timeOut!==null&&(window.clearTimeout(this.timeOut),this.timeOut=null),this.div=null)},n.prototype.draw=function(){if(this.visible&&this.div!==null&&this.center){var e=this.getPosFromLatLng(this.center);this.div.style.top=e!==null?"".concat(e.y,"px"):"0",this.div.style.left=e!==null?"".concat(e.x,"px"):"0"}},n.prototype.hide=function(){this.div&&(this.div.style.display="none"),this.visible=!1},n.prototype.show=function(){var e,t,i,s,o,r;if(this.div&&this.center){var a=this.sums===null||typeof this.sums.title>"u"||this.sums.title===""?this.cluster.getClusterer().getTitle():this.sums.title,d=this.backgroundPosition.split(" "),h=parseInt(((e=d[0])===null||e===void 0?void 0:e.replace(/^\s+|\s+$/g,""))||"0",10),c=parseInt(((t=d[1])===null||t===void 0?void 0:t.replace(/^\s+|\s+$/g,""))||"0",10),u=this.getPosFromLatLng(this.center);this.div.className=this.className,this.div.setAttribute("style","cursor: pointer; position: absolute; top: ".concat(u!==null?"".concat(u.y,"px"):"0","; left: ").concat(u!==null?"".concat(u.x,"px"):"0","; width: ").concat(this.width,"px; height: ").concat(this.height,"px; "));var p=document.createElement("img");p.alt=a,p.src=this.url,p.width=this.width,p.height=this.height,p.setAttribute("style","position: absolute; top: ".concat(c,"px; left: ").concat(h,"px")),this.cluster.getClusterer().enableRetinaIcons||(p.style.clip="rect(-".concat(c,"px, -").concat(h+this.width,"px, -").concat(c+this.height,", -").concat(h,")"));var f=document.createElement("div");f.setAttribute("style","position: absolute; top: ".concat(this.anchorText[0],"px; left: ").concat(this.anchorText[1],"px; color: ").concat(this.textColor,"; font-size: ").concat(this.textSize,"px; font-family: ").concat(this.fontFamily,"; font-weight: ").concat(this.fontWeight,"; fontStyle: ").concat(this.fontStyle,"; text-decoration: ").concat(this.textDecoration,"; text-align: center; width: ").concat(this.width,"px; line-height: ").concat(this.height,"px")),!((i=this.sums)===null||i===void 0)&&i.text&&(f.innerText="".concat((s=this.sums)===null||s===void 0?void 0:s.text)),!((o=this.sums)===null||o===void 0)&&o.html&&(f.innerHTML="".concat((r=this.sums)===null||r===void 0?void 0:r.html)),this.div.innerHTML="",this.div.appendChild(p),this.div.appendChild(f),this.div.title=a,this.div.style.display=""}this.visible=!0},n.prototype.useStyle=function(e){this.sums=e;var t=this.cluster.getClusterer().getStyles(),i=t[Math.min(t.length-1,Math.max(0,e.index-1))];i&&(this.url=i.url,this.height=i.height,this.width=i.width,i.className&&(this.className="".concat(this.clusterClassName," ").concat(i.className)),this.anchorText=i.anchorText||[0,0],this.anchorIcon=i.anchorIcon||[this.height/2,this.width/2],this.textColor=i.textColor||"black",this.textSize=i.textSize||11,this.textDecoration=i.textDecoration||"none",this.fontWeight=i.fontWeight||"bold",this.fontStyle=i.fontStyle||"normal",this.fontFamily=i.fontFamily||"Arial,sans-serif",this.backgroundPosition=i.backgroundPosition||"0 0")},n.prototype.setCenter=function(e){this.center=e},n.prototype.getPosFromLatLng=function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return t!==null&&(t.x-=this.anchorIcon[1],t.y-=this.anchorIcon[0]),t},n}(),ho=function(){function n(e){this.markerClusterer=e,this.map=this.markerClusterer.getMap(),this.gridSize=this.markerClusterer.getGridSize(),this.minClusterSize=this.markerClusterer.getMinimumClusterSize(),this.averageCenter=this.markerClusterer.getAverageCenter(),this.markers=[],this.center=void 0,this.bounds=null,this.clusterIcon=new lo(this,this.markerClusterer.getStyles()),this.getSize=this.getSize.bind(this),this.getMarkers=this.getMarkers.bind(this),this.getCenter=this.getCenter.bind(this),this.getMap=this.getMap.bind(this),this.getClusterer=this.getClusterer.bind(this),this.getBounds=this.getBounds.bind(this),this.remove=this.remove.bind(this),this.addMarker=this.addMarker.bind(this),this.isMarkerInClusterBounds=this.isMarkerInClusterBounds.bind(this),this.calculateBounds=this.calculateBounds.bind(this),this.updateIcon=this.updateIcon.bind(this),this.isMarkerAlreadyAdded=this.isMarkerAlreadyAdded.bind(this)}return n.prototype.getSize=function(){return this.markers.length},n.prototype.getMarkers=function(){return this.markers},n.prototype.getCenter=function(){return this.center},n.prototype.getMap=function(){return this.map},n.prototype.getClusterer=function(){return this.markerClusterer},n.prototype.getBounds=function(){for(var e=new google.maps.LatLngBounds(this.center,this.center),t=this.getMarkers(),i=0,s=t;i<s.length;i++){var o=s[i],r=o.getPosition();r&&e.extend(r)}return e},n.prototype.remove=function(){this.clusterIcon.setMap(null),this.markers=[],delete this.markers},n.prototype.addMarker=function(e){var t;if(this.isMarkerAlreadyAdded(e))return!1;if(this.center){if(this.averageCenter){var i=e.getPosition();if(i){var s=this.markers.length+1;this.center=new google.maps.LatLng((this.center.lat()*(s-1)+i.lat())/s,(this.center.lng()*(s-1)+i.lng())/s),this.calculateBounds()}}}else{var i=e.getPosition();i&&(this.center=i,this.calculateBounds())}e.isAdded=!0,this.markers.push(e);var o=this.markers.length,r=this.markerClusterer.getMaxZoom(),a=(t=this.map)===null||t===void 0?void 0:t.getZoom();if(r!==null&&typeof a<"u"&&a>r)e.getMap()!==this.map&&e.setMap(this.map);else if(o<this.minClusterSize)e.getMap()!==this.map&&e.setMap(this.map);else if(o===this.minClusterSize)for(var d=0,h=this.markers;d<h.length;d++){var c=h[d];c.setMap(null)}else e.setMap(null);return!0},n.prototype.isMarkerInClusterBounds=function(e){if(this.bounds!==null){var t=e.getPosition();if(t)return this.bounds.contains(t)}return!1},n.prototype.calculateBounds=function(){this.bounds=this.markerClusterer.getExtendedBounds(new google.maps.LatLngBounds(this.center,this.center))},n.prototype.updateIcon=function(){var e,t=this.markers.length,i=this.markerClusterer.getMaxZoom(),s=(e=this.map)===null||e===void 0?void 0:e.getZoom();if(i!==null&&typeof s<"u"&&s>i){this.clusterIcon.hide();return}if(t<this.minClusterSize){this.clusterIcon.hide();return}this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.useStyle(this.markerClusterer.getCalculator()(this.markers,this.markerClusterer.getStyles().length)),this.clusterIcon.show()},n.prototype.isMarkerAlreadyAdded=function(e){if(this.markers.includes)return this.markers.includes(e);for(var t=0;t<this.markers.length;t++)if(e===this.markers[t])return!0;return!1},n}();function co(n,e){var t=n.length,i=t.toString().length,s=Math.min(i,e);return{text:t.toString(),index:s,title:""}}var uo=2e3,po=500,go="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",fo="png",mo=[53,56,66,78,90],vo="cluster",es=function(){function n(e,t,i){t===void 0&&(t=[]),i===void 0&&(i={}),this.getMinimumClusterSize=this.getMinimumClusterSize.bind(this),this.setMinimumClusterSize=this.setMinimumClusterSize.bind(this),this.getEnableRetinaIcons=this.getEnableRetinaIcons.bind(this),this.setEnableRetinaIcons=this.setEnableRetinaIcons.bind(this),this.addToClosestCluster=this.addToClosestCluster.bind(this),this.getImageExtension=this.getImageExtension.bind(this),this.setImageExtension=this.setImageExtension.bind(this),this.getExtendedBounds=this.getExtendedBounds.bind(this),this.getAverageCenter=this.getAverageCenter.bind(this),this.setAverageCenter=this.setAverageCenter.bind(this),this.getTotalClusters=this.getTotalClusters.bind(this),this.fitMapToMarkers=this.fitMapToMarkers.bind(this),this.getIgnoreHidden=this.getIgnoreHidden.bind(this),this.setIgnoreHidden=this.setIgnoreHidden.bind(this),this.getClusterClass=this.getClusterClass.bind(this),this.setClusterClass=this.setClusterClass.bind(this),this.getTotalMarkers=this.getTotalMarkers.bind(this),this.getZoomOnClick=this.getZoomOnClick.bind(this),this.setZoomOnClick=this.setZoomOnClick.bind(this),this.getBatchSizeIE=this.getBatchSizeIE.bind(this),this.setBatchSizeIE=this.setBatchSizeIE.bind(this),this.createClusters=this.createClusters.bind(this),this.onZoomChanged=this.onZoomChanged.bind(this),this.getImageSizes=this.getImageSizes.bind(this),this.setImageSizes=this.setImageSizes.bind(this),this.getCalculator=this.getCalculator.bind(this),this.setCalculator=this.setCalculator.bind(this),this.removeMarkers=this.removeMarkers.bind(this),this.resetViewport=this.resetViewport.bind(this),this.getImagePath=this.getImagePath.bind(this),this.setImagePath=this.setImagePath.bind(this),this.pushMarkerTo=this.pushMarkerTo.bind(this),this.removeMarker=this.removeMarker.bind(this),this.clearMarkers=this.clearMarkers.bind(this),this.setupStyles=this.setupStyles.bind(this),this.getGridSize=this.getGridSize.bind(this),this.setGridSize=this.setGridSize.bind(this),this.getClusters=this.getClusters.bind(this),this.getMaxZoom=this.getMaxZoom.bind(this),this.setMaxZoom=this.setMaxZoom.bind(this),this.getMarkers=this.getMarkers.bind(this),this.addMarkers=this.addMarkers.bind(this),this.getStyles=this.getStyles.bind(this),this.setStyles=this.setStyles.bind(this),this.addMarker=this.addMarker.bind(this),this.onRemove=this.onRemove.bind(this),this.getTitle=this.getTitle.bind(this),this.setTitle=this.setTitle.bind(this),this.repaint=this.repaint.bind(this),this.onIdle=this.onIdle.bind(this),this.redraw=this.redraw.bind(this),this.onAdd=this.onAdd.bind(this),this.draw=this.draw.bind(this),this.extend=this.extend.bind(this),this.extend(n,google.maps.OverlayView),this.markers=[],this.clusters=[],this.listeners=[],this.activeMap=null,this.ready=!1,this.gridSize=i.gridSize||60,this.minClusterSize=i.minimumClusterSize||2,this.maxZoom=i.maxZoom||null,this.styles=i.styles||[],this.title=i.title||"",this.zoomOnClick=!0,i.zoomOnClick!==void 0&&(this.zoomOnClick=i.zoomOnClick),this.averageCenter=!1,i.averageCenter!==void 0&&(this.averageCenter=i.averageCenter),this.ignoreHidden=!1,i.ignoreHidden!==void 0&&(this.ignoreHidden=i.ignoreHidden),this.enableRetinaIcons=!1,i.enableRetinaIcons!==void 0&&(this.enableRetinaIcons=i.enableRetinaIcons),this.imagePath=i.imagePath||go,this.imageExtension=i.imageExtension||fo,this.imageSizes=i.imageSizes||mo,this.calculator=i.calculator||co,this.batchSize=i.batchSize||uo,this.batchSizeIE=i.batchSizeIE||po,this.clusterClass=i.clusterClass||vo,navigator.userAgent.toLowerCase().indexOf("msie")!==-1&&(this.batchSize=this.batchSizeIE),this.timerRefStatic=null,this.setupStyles(),this.addMarkers(t,!0),this.setMap(e)}return n.prototype.onZoomChanged=function(){var e,t;this.resetViewport(!1),(((e=this.getMap())===null||e===void 0?void 0:e.getZoom())===(this.get("minZoom")||0)||((t=this.getMap())===null||t===void 0?void 0:t.getZoom())===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")},n.prototype.onIdle=function(){this.redraw()},n.prototype.onAdd=function(){var e=this.getMap();this.activeMap=e,this.ready=!0,this.repaint(),e!==null&&(this.listeners=[google.maps.event.addListener(e,"zoom_changed",this.onZoomChanged),google.maps.event.addListener(e,"idle",this.onIdle)])},n.prototype.onRemove=function(){for(var e=0,t=this.markers;e<t.length;e++){var i=t[e];i.getMap()!==this.activeMap&&i.setMap(this.activeMap)}for(var s=0,o=this.clusters;s<o.length;s++){var r=o[s];r.remove()}this.clusters=[];for(var a=0,d=this.listeners;a<d.length;a++){var h=d[a];google.maps.event.removeListener(h)}this.listeners=[],this.activeMap=null,this.ready=!1},n.prototype.draw=function(){},n.prototype.getMap=function(){return null},n.prototype.getPanes=function(){return null},n.prototype.getProjection=function(){return{fromContainerPixelToLatLng:function(){return null},fromDivPixelToLatLng:function(){return null},fromLatLngToContainerPixel:function(){return null},fromLatLngToDivPixel:function(){return null},getVisibleRegion:function(){return null},getWorldWidth:function(){return 0}}},n.prototype.setMap=function(){},n.prototype.addListener=function(){return{remove:function(){}}},n.prototype.bindTo=function(){},n.prototype.get=function(){},n.prototype.notify=function(){},n.prototype.set=function(){},n.prototype.setValues=function(){},n.prototype.unbind=function(){},n.prototype.unbindAll=function(){},n.prototype.setupStyles=function(){if(!(this.styles.length>0))for(var e=0;e<this.imageSizes.length;e++)this.styles.push({url:"".concat(this.imagePath+(e+1),".").concat(this.imageExtension),height:this.imageSizes[e]||0,width:this.imageSizes[e]||0})},n.prototype.fitMapToMarkers=function(){for(var e=this.getMarkers(),t=new google.maps.LatLngBounds,i=0,s=e;i<s.length;i++){var o=s[i],r=o.getPosition();r&&t.extend(r)}var a=this.getMap();a!==null&&"fitBounds"in a&&a.fitBounds(t)},n.prototype.getGridSize=function(){return this.gridSize},n.prototype.setGridSize=function(e){this.gridSize=e},n.prototype.getMinimumClusterSize=function(){return this.minClusterSize},n.prototype.setMinimumClusterSize=function(e){this.minClusterSize=e},n.prototype.getMaxZoom=function(){return this.maxZoom},n.prototype.setMaxZoom=function(e){this.maxZoom=e},n.prototype.getStyles=function(){return this.styles},n.prototype.setStyles=function(e){this.styles=e},n.prototype.getTitle=function(){return this.title},n.prototype.setTitle=function(e){this.title=e},n.prototype.getZoomOnClick=function(){return this.zoomOnClick},n.prototype.setZoomOnClick=function(e){this.zoomOnClick=e},n.prototype.getAverageCenter=function(){return this.averageCenter},n.prototype.setAverageCenter=function(e){this.averageCenter=e},n.prototype.getIgnoreHidden=function(){return this.ignoreHidden},n.prototype.setIgnoreHidden=function(e){this.ignoreHidden=e},n.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons},n.prototype.setEnableRetinaIcons=function(e){this.enableRetinaIcons=e},n.prototype.getImageExtension=function(){return this.imageExtension},n.prototype.setImageExtension=function(e){this.imageExtension=e},n.prototype.getImagePath=function(){return this.imagePath},n.prototype.setImagePath=function(e){this.imagePath=e},n.prototype.getImageSizes=function(){return this.imageSizes},n.prototype.setImageSizes=function(e){this.imageSizes=e},n.prototype.getCalculator=function(){return this.calculator},n.prototype.setCalculator=function(e){this.calculator=e},n.prototype.getBatchSizeIE=function(){return this.batchSizeIE},n.prototype.setBatchSizeIE=function(e){this.batchSizeIE=e},n.prototype.getClusterClass=function(){return this.clusterClass},n.prototype.setClusterClass=function(e){this.clusterClass=e},n.prototype.getMarkers=function(){return this.markers},n.prototype.getTotalMarkers=function(){return this.markers.length},n.prototype.getClusters=function(){return this.clusters},n.prototype.getTotalClusters=function(){return this.clusters.length},n.prototype.addMarker=function(e,t){this.pushMarkerTo(e),t||this.redraw()},n.prototype.addMarkers=function(e,t){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];s&&this.pushMarkerTo(s)}t||this.redraw()},n.prototype.pushMarkerTo=function(e){var t=this;e.getDraggable()&&google.maps.event.addListener(e,"dragend",function(){t.ready&&(e.isAdded=!1,t.repaint())}),e.isAdded=!1,this.markers.push(e)},n.prototype.removeMarker_=function(e){var t=-1;if(this.markers.indexOf)t=this.markers.indexOf(e);else for(var i=0;i<this.markers.length;i++)if(e===this.markers[i]){t=i;break}return t===-1?!1:(e.setMap(null),this.markers.splice(t,1),!0)},n.prototype.removeMarker=function(e,t){var i=this.removeMarker_(e);return!t&&i&&this.repaint(),i},n.prototype.removeMarkers=function(e,t){for(var i=!1,s=0,o=e;s<o.length;s++){var r=o[s];i=i||this.removeMarker_(r)}return!t&&i&&this.repaint(),i},n.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers=[]},n.prototype.repaint=function(){var e=this.clusters.slice();this.clusters=[],this.resetViewport(!1),this.redraw(),setTimeout(function(){for(var i=0,s=e;i<s.length;i++){var o=s[i];o.remove()}},0)},n.prototype.getExtendedBounds=function(e){var t=this.getProjection(),i=t.fromLatLngToDivPixel(new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()));i!==null&&(i.x+=this.gridSize,i.y-=this.gridSize);var s=t.fromLatLngToDivPixel(new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()));if(s!==null&&(s.x-=this.gridSize,s.y+=this.gridSize),i!==null){var o=t.fromDivPixelToLatLng(i);o!==null&&e.extend(o)}if(s!==null){var r=t.fromDivPixelToLatLng(s);r!==null&&e.extend(r)}return e},n.prototype.redraw=function(){this.createClusters(0)},n.prototype.resetViewport=function(e){for(var t=0,i=this.clusters;t<i.length;t++){var s=i[t];s.remove()}this.clusters=[];for(var o=0,r=this.markers;o<r.length;o++){var a=r[o];a.isAdded=!1,e&&a.setMap(null)}},n.prototype.distanceBetweenPoints=function(e,t){var i=6371,s=(t.lat()-e.lat())*Math.PI/180,o=(t.lng()-e.lng())*Math.PI/180,r=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return i*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},n.prototype.isMarkerInBounds=function(e,t){var i=e.getPosition();return i?t.contains(i):!1},n.prototype.addToClosestCluster=function(e){for(var t,i=4e4,s=null,o=0,r=this.clusters;o<r.length;o++){var a=r[o];t=a;var d=t.getCenter(),h=e.getPosition();if(d&&h){var c=this.distanceBetweenPoints(d,h);c<i&&(i=c,s=t)}}s&&s.isMarkerInClusterBounds(e)?s.addMarker(e):(t=new ho(this),t.addMarker(e),this.clusters.push(t))},n.prototype.createClusters=function(e){var t=this;if(this.ready){e===0&&(google.maps.event.trigger(this,"clusteringbegin",this),this.timerRefStatic!==null&&(window.clearTimeout(this.timerRefStatic),delete this.timerRefStatic));for(var i=this.getMap(),s=i!==null&&("getBounds"in i)?i.getBounds():null,o=i?.getZoom()||0,r=o>3?new google.maps.LatLngBounds(s?.getSouthWest(),s?.getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625)),a=this.getExtendedBounds(r),d=Math.min(e+this.batchSize,this.markers.length),h=e;h<d;h++){var c=this.markers[h];c&&!c.isAdded&&this.isMarkerInBounds(c,a)&&(!this.ignoreHidden||this.ignoreHidden&&c.getVisible())&&this.addToClosestCluster(c)}if(d<this.markers.length)this.timerRefStatic=window.setTimeout(function(){t.createClusters(d)},0);else{this.timerRefStatic=null,google.maps.event.trigger(this,"clusteringend",this);for(var u=0,p=this.clusters;u<p.length;u++){var f=p[u];f.updateIcon()}}}},n.prototype.extend=function(e,t){return function(s){for(var o in s.prototype){var r=o;this.prototype[r]=s.prototype[r]}return this}.apply(e,[t])},n}();function _i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function yo(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_i(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_i(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var pe={onClick:"click",onClusteringBegin:"clusteringbegin",onClusteringEnd:"clusteringend",onMouseOut:"mouseout",onMouseOver:"mouseover"},H={averageCenter(n,e){n.setAverageCenter(e)},batchSizeIE(n,e){n.setBatchSizeIE(e)},calculator(n,e){n.setCalculator(e)},clusterClass(n,e){n.setClusterClass(e)},enableRetinaIcons(n,e){n.setEnableRetinaIcons(e)},gridSize(n,e){n.setGridSize(e)},ignoreHidden(n,e){n.setIgnoreHidden(e)},imageExtension(n,e){n.setImageExtension(e)},imagePath(n,e){n.setImagePath(e)},imageSizes(n,e){n.setImageSizes(e)},maxZoom(n,e){n.setMaxZoom(e)},minimumClusterSize(n,e){n.setMinimumClusterSize(e)},styles(n,e){n.setStyles(e)},title(n,e){n.setTitle(e)},zoomOnClick(n,e){n.setZoomOnClick(e)}},Co={};function Po(n){var{children:e,options:t,averageCenter:i,batchSizeIE:s,calculator:o,clusterClass:r,enableRetinaIcons:a,gridSize:d,ignoreHidden:h,imageExtension:c,imagePath:u,imageSizes:p,maxZoom:f,minimumClusterSize:g,styles:m,title:C,zoomOnClick:E,onClick:P,onClusteringBegin:S,onClusteringEnd:y,onMouseOver:v,onMouseOut:b,onLoad:w,onUnmount:k}=n,[M,I]=l.useState(null),O=l.useContext(N),[_,U]=l.useState(null),[T,B]=l.useState(null),[G,K]=l.useState(null),[z,Y]=l.useState(null),[$,X]=l.useState(null);return l.useEffect(()=>{M&&b&&(z!==null&&google.maps.event.removeListener(z),Y(google.maps.event.addListener(M,pe.onMouseOut,b)))},[b]),l.useEffect(()=>{M&&v&&($!==null&&google.maps.event.removeListener($),X(google.maps.event.addListener(M,pe.onMouseOver,v)))},[v]),l.useEffect(()=>{M&&P&&(_!==null&&google.maps.event.removeListener(_),U(google.maps.event.addListener(M,pe.onClick,P)))},[P]),l.useEffect(()=>{M&&S&&(T!==null&&google.maps.event.removeListener(T),B(google.maps.event.addListener(M,pe.onClusteringBegin,S)))},[S]),l.useEffect(()=>{M&&y&&(G!==null&&google.maps.event.removeListener(G),B(google.maps.event.addListener(M,pe.onClusteringEnd,y)))},[y]),l.useEffect(()=>{typeof i<"u"&&M!==null&&H.averageCenter(M,i)},[M,i]),l.useEffect(()=>{typeof s<"u"&&M!==null&&H.batchSizeIE(M,s)},[M,s]),l.useEffect(()=>{typeof o<"u"&&M!==null&&H.calculator(M,o)},[M,o]),l.useEffect(()=>{typeof r<"u"&&M!==null&&H.clusterClass(M,r)},[M,r]),l.useEffect(()=>{typeof a<"u"&&M!==null&&H.enableRetinaIcons(M,a)},[M,a]),l.useEffect(()=>{typeof d<"u"&&M!==null&&H.gridSize(M,d)},[M,d]),l.useEffect(()=>{typeof h<"u"&&M!==null&&H.ignoreHidden(M,h)},[M,h]),l.useEffect(()=>{typeof c<"u"&&M!==null&&H.imageExtension(M,c)},[M,c]),l.useEffect(()=>{typeof u<"u"&&M!==null&&H.imagePath(M,u)},[M,u]),l.useEffect(()=>{typeof p<"u"&&M!==null&&H.imageSizes(M,p)},[M,p]),l.useEffect(()=>{typeof f<"u"&&M!==null&&H.maxZoom(M,f)},[M,f]),l.useEffect(()=>{typeof g<"u"&&M!==null&&H.minimumClusterSize(M,g)},[M,g]),l.useEffect(()=>{typeof m<"u"&&M!==null&&H.styles(M,m)},[M,m]),l.useEffect(()=>{typeof C<"u"&&M!==null&&H.title(M,C)},[M,C]),l.useEffect(()=>{typeof E<"u"&&M!==null&&H.zoomOnClick(M,E)},[M,E]),l.useEffect(()=>{if(O){var Q=yo({},t||Co),F=new es(O,[],Q);return i&&H.averageCenter(F,i),s&&H.batchSizeIE(F,s),o&&H.calculator(F,o),r&&H.clusterClass(F,r),a&&H.enableRetinaIcons(F,a),d&&H.gridSize(F,d),h&&H.ignoreHidden(F,h),c&&H.imageExtension(F,c),u&&H.imagePath(F,u),p&&H.imageSizes(F,p),f&&H.maxZoom(F,f),g&&H.minimumClusterSize(F,g),m&&H.styles(F,m),C&&H.title(F,C),E&&H.zoomOnClick(F,E),b&&Y(google.maps.event.addListener(F,pe.onMouseOut,b)),v&&X(google.maps.event.addListener(F,pe.onMouseOver,v)),P&&U(google.maps.event.addListener(F,pe.onClick,P)),S&&B(google.maps.event.addListener(F,pe.onClusteringBegin,S)),y&&K(google.maps.event.addListener(F,pe.onClusteringEnd,y)),I(F),w&&w(F),()=>{z!==null&&google.maps.event.removeListener(z),$!==null&&google.maps.event.removeListener($),_!==null&&google.maps.event.removeListener(_),T!==null&&google.maps.event.removeListener(T),G!==null&&google.maps.event.removeListener(G),k&&k(F)}}},[]),M!==null&&e(M)||null}l.memo(Po);class Lo extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{markerClusterer:null}),L(this,"setClustererCallback",()=>{this.state.markerClusterer!==null&&this.props.onLoad&&this.props.onLoad(this.state.markerClusterer)})}componentDidMount(){if(this.context){var e=new es(this.context,[],this.props.options);this.registeredEvents=W({updaterMap:H,eventMap:pe,prevProps:{},nextProps:this.props,instance:e}),this.setState(()=>({markerClusterer:e}),this.setClustererCallback)}}componentDidUpdate(e){this.state.markerClusterer&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:H,eventMap:pe,prevProps:e,nextProps:this.props,instance:this.state.markerClusterer}))}componentWillUnmount(){this.state.markerClusterer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.markerClusterer),V(this.registeredEvents),this.state.markerClusterer.setMap(null))}render(){return this.state.markerClusterer!==null?this.props.children(this.state.markerClusterer):null}}L(Lo,"contextType",N);function ji(n){n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation()}var ts=function(){function n(e){e===void 0&&(e={}),this.getCloseClickHandler=this.getCloseClickHandler.bind(this),this.closeClickHandler=this.closeClickHandler.bind(this),this.createInfoBoxDiv=this.createInfoBoxDiv.bind(this),this.addClickHandler=this.addClickHandler.bind(this),this.getCloseBoxImg=this.getCloseBoxImg.bind(this),this.getBoxWidths=this.getBoxWidths.bind(this),this.setBoxStyle=this.setBoxStyle.bind(this),this.setPosition=this.setPosition.bind(this),this.getPosition=this.getPosition.bind(this),this.setOptions=this.setOptions.bind(this),this.setContent=this.setContent.bind(this),this.setVisible=this.setVisible.bind(this),this.getContent=this.getContent.bind(this),this.getVisible=this.getVisible.bind(this),this.setZIndex=this.setZIndex.bind(this),this.getZIndex=this.getZIndex.bind(this),this.onRemove=this.onRemove.bind(this),this.panBox=this.panBox.bind(this),this.extend=this.extend.bind(this),this.close=this.close.bind(this),this.draw=this.draw.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.open=this.open.bind(this),this.extend(n,google.maps.OverlayView),this.content=e.content||"",this.disableAutoPan=e.disableAutoPan||!1,this.maxWidth=e.maxWidth||0,this.pixelOffset=e.pixelOffset||new google.maps.Size(0,0),this.position=e.position||new google.maps.LatLng(0,0),this.zIndex=e.zIndex||null,this.boxClass=e.boxClass||"infoBox",this.boxStyle=e.boxStyle||{},this.closeBoxMargin=e.closeBoxMargin||"2px",this.closeBoxURL=e.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",e.closeBoxURL===""&&(this.closeBoxURL=""),this.infoBoxClearance=e.infoBoxClearance||new google.maps.Size(1,1),typeof e.visible>"u"&&(typeof e.isHidden>"u"?e.visible=!0:e.visible=!e.isHidden),this.isHidden=!e.visible,this.alignBottom=e.alignBottom||!1,this.pane=e.pane||"floatPane",this.enableEventPropagation=e.enableEventPropagation||!1,this.div=null,this.closeListener=null,this.moveListener=null,this.mapListener=null,this.contextListener=null,this.eventListeners=null,this.fixedWidthSet=null}return n.prototype.createInfoBoxDiv=function(){var e=this,t=function(c){c.returnValue=!1,c.preventDefault&&c.preventDefault(),e.enableEventPropagation||ji(c)};if(!this.div){this.div=document.createElement("div"),this.setBoxStyle(),typeof this.content=="string"?this.div.innerHTML=this.getCloseBoxImg()+this.content:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(this.content));var i=this.getPanes();if(i!==null&&i[this.pane].appendChild(this.div),this.addClickHandler(),this.div.style.width)this.fixedWidthSet=!0;else if(this.maxWidth!==0&&this.div.offsetWidth>this.maxWidth)this.div.style.width=this.maxWidth+"px",this.fixedWidthSet=!0;else{var s=this.getBoxWidths();this.div.style.width=this.div.offsetWidth-s.left-s.right+"px",this.fixedWidthSet=!1}if(this.panBox(this.disableAutoPan),!this.enableEventPropagation){this.eventListeners=[];for(var o=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],r=0,a=o;r<a.length;r++){var d=a[r];this.eventListeners.push(google.maps.event.addListener(this.div,d,ji))}this.eventListeners.push(google.maps.event.addListener(this.div,"mouseover",function(){e.div&&(e.div.style.cursor="default")}))}this.contextListener=google.maps.event.addListener(this.div,"contextmenu",t),google.maps.event.trigger(this,"domready")}},n.prototype.getCloseBoxImg=function(){var e="";return this.closeBoxURL!==""&&(e='<img alt=""',e+=' aria-hidden="true"',e+=" src='"+this.closeBoxURL+"'",e+=" align=right",e+=" style='",e+=" position: relative;",e+=" cursor: pointer;",e+=" margin: "+this.closeBoxMargin+";",e+="'>"),e},n.prototype.addClickHandler=function(){this.closeListener=this.div&&this.div.firstChild&&this.closeBoxURL!==""?google.maps.event.addListener(this.div.firstChild,"click",this.getCloseClickHandler()):null},n.prototype.closeClickHandler=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),google.maps.event.trigger(this,"closeclick"),this.close()},n.prototype.getCloseClickHandler=function(){return this.closeClickHandler},n.prototype.panBox=function(e){if(this.div&&!e){var t=this.getMap();if(t instanceof google.maps.Map){var i=0,s=0,o=t.getBounds();o&&!o.contains(this.position)&&t.setCenter(this.position);var r=t.getDiv(),a=r.offsetWidth,d=r.offsetHeight,h=this.pixelOffset.width,c=this.pixelOffset.height,u=this.div.offsetWidth,p=this.div.offsetHeight,f=this.infoBoxClearance.width,g=this.infoBoxClearance.height,m=this.getProjection(),C=m.fromLatLngToContainerPixel(this.position);C!==null&&(C.x<-h+f?i=C.x+h-f:C.x+u+h+f>a&&(i=C.x+u+h+f-a),this.alignBottom?C.y<-c+g+p?s=C.y+c-g-p:C.y+c+g>d&&(s=C.y+c+g-d):C.y<-c+g?s=C.y+c-g:C.y+p+c+g>d&&(s=C.y+p+c+g-d)),i===0&&s===0||t.panBy(i,s)}}},n.prototype.setBoxStyle=function(){if(this.div){this.div.className=this.boxClass,this.div.style.cssText="";var e=this.boxStyle;for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this.div.style[t]=e[t]);if(this.div.style.webkitTransform="translateZ(0)",typeof this.div.style.opacity<"u"&&this.div.style.opacity!==""){var i=parseFloat(this.div.style.opacity||"");this.div.style.msFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+i*100+')"',this.div.style.filter="alpha(opacity="+i*100+")"}this.div.style.position="absolute",this.div.style.visibility="hidden",this.zIndex!==null&&(this.div.style.zIndex=this.zIndex+""),this.div.style.overflow||(this.div.style.overflow="auto")}},n.prototype.getBoxWidths=function(){var e={top:0,bottom:0,left:0,right:0};if(!this.div)return e;if(document.defaultView){var t=this.div.ownerDocument,i=t&&t.defaultView?t.defaultView.getComputedStyle(this.div,""):null;i&&(e.top=parseInt(i.borderTopWidth||"",10)||0,e.bottom=parseInt(i.borderBottomWidth||"",10)||0,e.left=parseInt(i.borderLeftWidth||"",10)||0,e.right=parseInt(i.borderRightWidth||"",10)||0)}else if(document.documentElement.currentStyle){var s=this.div.currentStyle;s&&(e.top=parseInt(s.borderTopWidth||"",10)||0,e.bottom=parseInt(s.borderBottomWidth||"",10)||0,e.left=parseInt(s.borderLeftWidth||"",10)||0,e.right=parseInt(s.borderRightWidth||"",10)||0)}return e},n.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.div.parentNode.removeChild(this.div),this.div=null)},n.prototype.draw=function(){if(this.createInfoBoxDiv(),this.div){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.position);t!==null&&(this.div.style.left=t.x+this.pixelOffset.width+"px",this.alignBottom?this.div.style.bottom=-(t.y+this.pixelOffset.height)+"px":this.div.style.top=t.y+this.pixelOffset.height+"px"),this.isHidden?this.div.style.visibility="hidden":this.div.style.visibility="visible"}},n.prototype.setOptions=function(e){e===void 0&&(e={}),typeof e.boxClass<"u"&&(this.boxClass=e.boxClass,this.setBoxStyle()),typeof e.boxStyle<"u"&&(this.boxStyle=e.boxStyle,this.setBoxStyle()),typeof e.content<"u"&&this.setContent(e.content),typeof e.disableAutoPan<"u"&&(this.disableAutoPan=e.disableAutoPan),typeof e.maxWidth<"u"&&(this.maxWidth=e.maxWidth),typeof e.pixelOffset<"u"&&(this.pixelOffset=e.pixelOffset),typeof e.alignBottom<"u"&&(this.alignBottom=e.alignBottom),typeof e.position<"u"&&this.setPosition(e.position),typeof e.zIndex<"u"&&this.setZIndex(e.zIndex),typeof e.closeBoxMargin<"u"&&(this.closeBoxMargin=e.closeBoxMargin),typeof e.closeBoxURL<"u"&&(this.closeBoxURL=e.closeBoxURL),typeof e.infoBoxClearance<"u"&&(this.infoBoxClearance=e.infoBoxClearance),typeof e.isHidden<"u"&&(this.isHidden=e.isHidden),typeof e.visible<"u"&&(this.isHidden=!e.visible),typeof e.enableEventPropagation<"u"&&(this.enableEventPropagation=e.enableEventPropagation),this.div&&this.draw()},n.prototype.setContent=function(e){this.content=e,this.div&&(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.fixedWidthSet||(this.div.style.width=""),typeof e=="string"?this.div.innerHTML=this.getCloseBoxImg()+e:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(e)),this.fixedWidthSet||(this.div.style.width=this.div.offsetWidth+"px",typeof e=="string"?this.div.innerHTML=this.getCloseBoxImg()+e:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(e))),this.addClickHandler()),google.maps.event.trigger(this,"content_changed")},n.prototype.setPosition=function(e){this.position=e,this.div&&this.draw(),google.maps.event.trigger(this,"position_changed")},n.prototype.setVisible=function(e){this.isHidden=!e,this.div&&(this.div.style.visibility=this.isHidden?"hidden":"visible")},n.prototype.setZIndex=function(e){this.zIndex=e,this.div&&(this.div.style.zIndex=e+""),google.maps.event.trigger(this,"zindex_changed")},n.prototype.getContent=function(){return this.content},n.prototype.getPosition=function(){return this.position},n.prototype.getZIndex=function(){return this.zIndex},n.prototype.getVisible=function(){var e=this.getMap();return typeof e>"u"||e===null?!1:!this.isHidden},n.prototype.show=function(){this.isHidden=!1,this.div&&(this.div.style.visibility="visible")},n.prototype.hide=function(){this.isHidden=!0,this.div&&(this.div.style.visibility="hidden")},n.prototype.open=function(e,t){var i=this;t&&(this.position=t.getPosition(),this.moveListener=google.maps.event.addListener(t,"position_changed",function(){var s=t.getPosition();i.setPosition(s)}),this.mapListener=google.maps.event.addListener(t,"map_changed",function(){i.setMap(t.map)})),this.setMap(e),this.div&&this.panBox()},n.prototype.close=function(){if(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.eventListeners){for(var e=0,t=this.eventListeners;e<t.length;e++){var i=t[e];google.maps.event.removeListener(i)}this.eventListeners=null}this.moveListener&&(google.maps.event.removeListener(this.moveListener),this.moveListener=null),this.mapListener&&(google.maps.event.removeListener(this.mapListener),this.mapListener=null),this.contextListener&&(google.maps.event.removeListener(this.contextListener),this.contextListener=null),this.setMap(null)},n.prototype.extend=function(e,t){return function(s){for(var o in s.prototype)Object.prototype.hasOwnProperty.call(this,o)||(this.prototype[o]=s.prototype[o]);return this}.apply(e,[t])},n}(),bo=["position"],Eo=["position"];function Fi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Pt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Fi(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Fi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Ti={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},Bi={options(n,e){n.setOptions(e)},position(n,e){e instanceof google.maps.LatLng?n.setPosition(e):n.setPosition(new google.maps.LatLng(e.lat,e.lng))},visible(n,e){n.setVisible(e)},zIndex(n,e){n.setZIndex(e)}},Mo={};function xo(n){var{children:e,anchor:t,options:i,position:s,zIndex:o,onCloseClick:r,onDomReady:a,onContentChanged:d,onPositionChanged:h,onZindexChanged:c,onLoad:u,onUnmount:p}=n,f=l.useContext(N),[g,m]=l.useState(null),[C,E]=l.useState(null),[P,S]=l.useState(null),[y,v]=l.useState(null),[b,w]=l.useState(null),[k,M]=l.useState(null),I=l.useRef(null);return l.useEffect(()=>{f&&g!==null&&(g.close(),t?g.open(f,t):g.getPosition()&&g.open(f))},[f,g,t]),l.useEffect(()=>{i&&g!==null&&g.setOptions(i)},[g,i]),l.useEffect(()=>{if(s&&g!==null){var O=s instanceof google.maps.LatLng?s:new google.maps.LatLng(s.lat,s.lng);g.setPosition(O)}},[s]),l.useEffect(()=>{typeof o=="number"&&g!==null&&g.setZIndex(o)},[o]),l.useEffect(()=>{g&&r&&(C!==null&&google.maps.event.removeListener(C),E(google.maps.event.addListener(g,"closeclick",r)))},[r]),l.useEffect(()=>{g&&a&&(P!==null&&google.maps.event.removeListener(P),S(google.maps.event.addListener(g,"domready",a)))},[a]),l.useEffect(()=>{g&&d&&(y!==null&&google.maps.event.removeListener(y),v(google.maps.event.addListener(g,"content_changed",d)))},[d]),l.useEffect(()=>{g&&h&&(b!==null&&google.maps.event.removeListener(b),w(google.maps.event.addListener(g,"position_changed",h)))},[h]),l.useEffect(()=>{g&&c&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(g,"zindex_changed",c)))},[c]),l.useEffect(()=>{if(f){var O=i||Mo,{position:_}=O,U=Zt(O,bo),T;_&&!(_ instanceof google.maps.LatLng)&&(T=new google.maps.LatLng(_.lat,_.lng));var B=new ts(Pt(Pt({},U),T?{position:T}:{}));I.current=document.createElement("div"),m(B),r&&E(google.maps.event.addListener(B,"closeclick",r)),a&&S(google.maps.event.addListener(B,"domready",a)),d&&v(google.maps.event.addListener(B,"content_changed",d)),h&&w(google.maps.event.addListener(B,"position_changed",h)),c&&M(google.maps.event.addListener(B,"zindex_changed",c)),B.setContent(I.current),t?B.open(f,t):B.getPosition()?B.open(f):ae(!1,"You must provide either an anchor or a position prop for <InfoBox>."),u&&u(B)}return()=>{g!==null&&(C&&google.maps.event.removeListener(C),y&&google.maps.event.removeListener(y),P&&google.maps.event.removeListener(P),b&&google.maps.event.removeListener(b),k&&google.maps.event.removeListener(k),p&&p(g),g.close())}},[]),I.current?Te.createPortal(l.Children.only(e),I.current):null}l.memo(xo);class wo extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"containerElement",null),L(this,"state",{infoBox:null}),L(this,"open",(e,t)=>{t?this.context!==null&&e.open(this.context,t):e.getPosition()?this.context!==null&&e.open(this.context):ae(!1,"You must provide either an anchor or a position prop for <InfoBox>.")}),L(this,"setInfoBoxCallback",()=>{this.state.infoBox!==null&&this.containerElement!==null&&(this.state.infoBox.setContent(this.containerElement),this.open(this.state.infoBox,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoBox))})}componentDidMount(){var e=this.props.options||{},{position:t}=e,i=Zt(e,Eo),s;t&&!(t instanceof google.maps.LatLng)&&(s=new google.maps.LatLng(t.lat,t.lng));var o=new ts(Pt(Pt({},i),s?{position:s}:{}));this.containerElement=document.createElement("div"),this.registeredEvents=W({updaterMap:Bi,eventMap:Ti,prevProps:{},nextProps:this.props,instance:o}),this.setState({infoBox:o},this.setInfoBoxCallback)}componentDidUpdate(e){var{infoBox:t}=this.state;t!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Bi,eventMap:Ti,prevProps:e,nextProps:this.props,instance:t}))}componentWillUnmount(){var{onUnmount:e}=this.props,{infoBox:t}=this.state;t!==null&&(e&&e(t),V(this.registeredEvents),t.close())}render(){return this.containerElement?Te.createPortal(l.Children.only(this.props.children),this.containerElement):null}}L(wo,"contextType",N);var Dt,Ri;function So(){return Ri||(Ri=1,Dt=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,s,o;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!n(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[s]))return!1;for(s=i;s--!==0;){var r=o[s];if(!n(e[r],t[r]))return!1}return!0}return e!==e&&t!==t}),Dt}var Io=So(),Ni=Yn(Io),Ai=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],_t=1,Ue=8;class Ht{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[t,i]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");var s=i>>4;if(s!==_t)throw new Error("Got v".concat(s," data when expected v").concat(_t,"."));var o=Ai[i&15];if(!o)throw new Error("Unrecognized array type.");var[r]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new Ht(a,r,o,e)}constructor(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,s=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;var o=Ai.indexOf(this.ArrayType),r=e*2*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,d=(8-a%8)%8;if(o<0)throw new Error("Unexpected typed array class: ".concat(i,"."));s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,Ue,e),this.coords=new this.ArrayType(this.data,Ue+a+d,e*2),this._pos=e*2,this._finished=!0):(this.data=new ArrayBuffer(Ue+r+a+d),this.ids=new this.IndexArrayType(this.data,Ue,e),this.coords=new this.ArrayType(this.data,Ue+a+d,e*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(_t<<4)+o]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){var i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){var e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return At(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:o,coords:r,nodeSize:a}=this,d=[0,o.length-1,0],h=[];d.length;){var c=d.pop()||0,u=d.pop()||0,p=d.pop()||0;if(u-p<=a){for(var f=p;f<=u;f++){var g=r[2*f],m=r[2*f+1];g>=e&&g<=i&&m>=t&&m<=s&&h.push(o[f])}continue}var C=p+u>>1,E=r[2*C],P=r[2*C+1];E>=e&&E<=i&&P>=t&&P<=s&&h.push(o[C]),(c===0?e<=E:t<=P)&&(d.push(p),d.push(C-1),d.push(1-c)),(c===0?i>=E:s>=P)&&(d.push(C+1),d.push(u),d.push(1-c))}return h}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:s,coords:o,nodeSize:r}=this,a=[0,s.length-1,0],d=[],h=i*i;a.length;){var c=a.pop()||0,u=a.pop()||0,p=a.pop()||0;if(u-p<=r){for(var f=p;f<=u;f++)Ui(o[2*f],o[2*f+1],e,t)<=h&&d.push(s[f]);continue}var g=p+u>>1,m=o[2*g],C=o[2*g+1];Ui(m,C,e,t)<=h&&d.push(s[g]),(c===0?e-i<=m:t-i<=C)&&(a.push(p),a.push(g-1),a.push(1-c)),(c===0?e+i>=m:t+i>=C)&&(a.push(g+1),a.push(u),a.push(1-c))}return d}}function At(n,e,t,i,s,o){if(!(s-i<=t)){var r=i+s>>1;is(n,e,r,i,s,o),At(n,e,t,i,r-1,1-o),At(n,e,t,r+1,s,1-o)}}function is(n,e,t,i,s,o){for(;s>i;){if(s-i>600){var r=s-i+1,a=t-i+1,d=Math.log(r),h=.5*Math.exp(2*d/3),c=.5*Math.sqrt(d*h*(r-h)/r)*(a-r/2<0?-1:1),u=Math.max(i,Math.floor(t-a*h/r+c)),p=Math.min(s,Math.floor(t+(r-a)*h/r+c));is(n,e,t,u,p,o)}var f=e[2*t+o],g=i,m=s;for(We(n,e,i,t),e[2*s+o]>f&&We(n,e,i,s);g<m;){for(We(n,e,g,m),g++,m--;e[2*g+o]<f;)g++;for(;e[2*m+o]>f;)m--}e[2*i+o]===f?We(n,e,i,m):(m++,We(n,e,m,s)),m<=t&&(i=m+1),t<=m&&(s=m-1)}}function We(n,e,t,i){jt(n,t,i),jt(e,2*t,2*i),jt(e,2*t+1,2*i+1)}function jt(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function Ui(n,e,t,i){var s=n-t,o=e-i;return s*s+o*o}var Oo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:n=>n},Wi=Math.fround||(n=>e=>(n[0]=+e,n[0]))(new Float32Array(1)),Me=2,Ce=3,Ft=4,ye=5,ns=6;class ko{constructor(e){this.options=Object.assign(Object.create(Oo),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){var{log:t,minZoom:i,maxZoom:s}=this.options,o="prepare ".concat(e.length," points");this.points=e;for(var r=[],a=0;a<e.length;a++){var d=e[a];if(d.geometry){var[h,c]=d.geometry.coordinates,u=Wi(ht(h)),p=Wi(ct(c));r.push(u,p,1/0,a,-1,1),this.options.reduce&&r.push(0)}}for(var f=this.trees[s+1]=this._createTree(r),g=s;g>=i;g--){var m=+Date.now();f=this.trees[g]=this._createTree(this._cluster(f,g))}return this}getClusters(e,t){var i=((e[0]+180)%360+360)%360-180,s=Math.max(-90,Math.min(90,e[1])),o=e[2]===180?180:((e[2]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,o=180;else if(i>o){var a=this.getClusters([i,s,180,r],t),d=this.getClusters([-180,s,o,r],t);return a.concat(d)}var h=this.trees[this._limitZoom(t)],c=h.range(ht(i),ct(r),ht(o),ct(s)),u=h.data,p=[];for(var f of c){var g=this.stride*f;p.push(u[g+ye]>1?Gi(u,g,this.clusterProps):this.points[u[g+Ce]])}return p}getChildren(e){var t=this._getOriginId(e),i=this._getOriginZoom(e),s="No cluster with the specified id.",o=this.trees[i];if(!o)throw new Error(s);var r=o.data;if(t*this.stride>=r.length)throw new Error(s);var a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),d=r[t*this.stride],h=r[t*this.stride+1],c=o.within(d,h,a),u=[];for(var p of c){var f=p*this.stride;r[f+Ft]===e&&u.push(r[f+ye]>1?Gi(r,f,this.clusterProps):this.points[r[f+Ce]])}if(u.length===0)throw new Error(s);return u}getLeaves(e,t,i){t=t||10,i=i||0;var s=[];return this._appendLeaves(s,e,t,i,0),s}getTile(e,t,i){var s=this.trees[this._limitZoom(e)],o=Math.pow(2,e),{extent:r,radius:a}=this.options,d=a/r,h=(i-d)/o,c=(i+1+d)/o,u={features:[]};return this._addTileFeatures(s.range((t-d)/o,h,(t+1+d)/o,c),s.data,t,i,o,u),t===0&&this._addTileFeatures(s.range(1-d/o,h,1,c),s.data,o,i,o,u),t===o-1&&this._addTileFeatures(s.range(0,h,d/o,c),s.data,-1,i,o,u),u.features.length?u:null}getClusterExpansionZoom(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var i=this.getChildren(e);if(t++,i.length!==1)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,s,o){var r=this.getChildren(t);for(var a of r){var d=a.properties;if(d&&d.cluster?o+d.point_count<=s?o+=d.point_count:o=this._appendLeaves(e,d.cluster_id,i,s,o):o<s?o++:e.push(a),e.length===i)break}return o}_createTree(e){for(var t=new Ht(e.length/this.stride|0,this.options.nodeSize,Float32Array),i=0;i<e.length;i+=this.stride)t.add(e[i],e[i+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,i,s,o,r){for(var a of e){var d=a*this.stride,h=t[d+ye]>1,c=void 0,u=void 0,p=void 0;if(h)c=ss(t,d,this.clusterProps),u=t[d],p=t[d+1];else{var f=this.points[t[d+Ce]];c=f.properties;var[g,m]=f.geometry.coordinates;u=ht(g),p=ct(m)}var C={type:1,geometry:[[Math.round(this.options.extent*(u*o-i)),Math.round(this.options.extent*(p*o-s))]],tags:c},E=void 0;h||this.options.generateId?E=t[d+Ce]:E=this.points[t[d+Ce]].id,E!==void 0&&(C.id=E),r.features.push(C)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){for(var{radius:i,extent:s,reduce:o,minPoints:r}=this.options,a=i/(s*Math.pow(2,t)),d=e.data,h=[],c=this.stride,u=0;u<d.length;u+=c)if(!(d[u+Me]<=t)){d[u+Me]=t;var p=d[u],f=d[u+1],g=e.within(d[u],d[u+1],a),m=d[u+ye],C=m;for(var E of g){var P=E*c;d[P+Me]>t&&(C+=d[P+ye])}if(C>m&&C>=r){var S=p*m,y=f*m,v=void 0,b=-1,w=((u/c|0)<<5)+(t+1)+this.points.length;for(var k of g){var M=k*c;if(!(d[M+Me]<=t)){d[M+Me]=t;var I=d[M+ye];S+=d[M]*I,y+=d[M+1]*I,d[M+Ft]=w,o&&(v||(v=this._map(d,u,!0),b=this.clusterProps.length,this.clusterProps.push(v)),o(v,this._map(d,M)))}}d[u+Ft]=w,h.push(S/C,y/C,1/0,w,-1,C),o&&h.push(b)}else{for(var O=0;O<c;O++)h.push(d[u+O]);if(C>1)for(var _ of g){var U=_*c;if(!(d[U+Me]<=t)){d[U+Me]=t;for(var T=0;T<c;T++)h.push(d[U+T])}}}}return h}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+ye]>1){var s=this.clusterProps[e[t+ns]];return i?Object.assign({},s):s}var o=this.points[e[t+Ce]].properties,r=this.options.map(o);return i&&r===o?Object.assign({},r):r}}function Gi(n,e,t){return{type:"Feature",id:n[e+Ce],properties:ss(n,e,t),geometry:{type:"Point",coordinates:[Do(n[e]),_o(n[e+1])]}}}function ss(n,e,t){var i=n[e+ye],s=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?"".concat(Math.round(i/100)/10,"k"):i,o=n[e+ns],r=o===-1?{}:Object.assign({},t[o]);return Object.assign(r,{cluster:!0,cluster_id:n[e+Ce],point_count:i,point_count_abbreviated:s})}function ht(n){return n/360+.5}function ct(n){var e=Math.sin(n*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Do(n){return(n-.5)*360}function _o(n){var e=(180-n*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function jo(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}class ue{static isAdvancedMarkerAvailable(e){return google.maps.marker&&e.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(e){return google.maps.marker&&e instanceof google.maps.marker.AdvancedMarkerElement}static setMap(e,t){this.isAdvancedMarker(e)?e.map=t:e.setMap(t)}static getPosition(e){if(this.isAdvancedMarker(e)){if(e.position){if(e.position instanceof google.maps.LatLng)return e.position;if(e.position.lat&&e.position.lng)return new google.maps.LatLng(e.position.lat,e.position.lng)}return new google.maps.LatLng(null)}return e.getPosition()}static getVisible(e){return this.isAdvancedMarker(e)?!0:e.getVisible()}}class Ut{constructor(e){var{markers:t,position:i}=e;this.markers=t,i&&(i instanceof google.maps.LatLng?this._position=i:this._position=new google.maps.LatLng(i))}get bounds(){if(!(this.markers.length===0&&!this._position)){var e=new google.maps.LatLngBounds(this._position,this._position);for(var t of this.markers)e.extend(ue.getPosition(t));return e}}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(e=>ue.getVisible(e)).length}push(e){this.markers.push(e)}delete(){this.marker&&(ue.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}class Fo{constructor(e){var{maxZoom:t=16}=e;this.maxZoom=t}noop(e){var{markers:t}=e;return To(t)}}var To=n=>{var e=n.map(t=>new Ut({position:ue.getPosition(t),markers:[t]}));return e};class Bo extends Fo{constructor(e){var{maxZoom:t,radius:i=60}=e,s=jo(e,["maxZoom","radius"]);super({maxZoom:t}),this.state={zoom:-1},this.superCluster=new ko(Object.assign({maxZoom:this.maxZoom,radius:i},s))}calculate(e){var t=!1,i={zoom:e.map.getZoom()};if(!Ni(e.markers,this.markers)){t=!0,this.markers=[...e.markers];var s=this.markers.map(o=>{var r=ue.getPosition(o),a=[r.lng(),r.lat()];return{type:"Feature",geometry:{type:"Point",coordinates:a},properties:{marker:o}}});this.superCluster.load(s)}return t||(this.state.zoom<=this.maxZoom||i.zoom<=this.maxZoom)&&(t=!Ni(this.state,i)),this.state=i,t&&(this.clusters=this.cluster(e)),{clusters:this.clusters,changed:t}}cluster(e){var{map:t}=e;return this.superCluster.getClusters([-180,-90,180,90],Math.round(t.getZoom())).map(i=>this.transformCluster(i))}transformCluster(e){var{geometry:{coordinates:[t,i]},properties:s}=e;if(s.cluster)return new Ut({markers:this.superCluster.getLeaves(s.cluster_id,1/0).map(r=>r.properties.marker),position:{lat:i,lng:t}});var o=s.marker;return new Ut({markers:[o],position:ue.getPosition(o)})}}class Ro{constructor(e,t){this.markers={sum:e.length};var i=t.map(o=>o.count),s=i.reduce((o,r)=>o+r,0);this.clusters={count:t.length,markers:{mean:s/t.length,sum:s,min:Math.min(...i),max:Math.max(...i)}}}}class No{render(e,t,i){var{count:s,position:o}=e,r=s>Math.max(10,t.clusters.markers.mean)?"#ff0000":"#0000ff",a='<svg fill="'.concat(r,`" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">
<circle cx="120" cy="120" opacity=".6" r="70" />
<circle cx="120" cy="120" opacity=".3" r="90" />
<circle cx="120" cy="120" opacity=".2" r="110" />
<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">`).concat(s,`</text>
</svg>`),d="Cluster of ".concat(s," markers"),h=Number(google.maps.Marker.MAX_ZINDEX)+s;if(ue.isAdvancedMarkerAvailable(i)){var c=new DOMParser,u=c.parseFromString(a,"image/svg+xml").documentElement;u.setAttribute("transform","translate(0 25)");var p={map:i,position:o,zIndex:h,title:d,content:u};return new google.maps.marker.AdvancedMarkerElement(p)}var f={position:o,zIndex:h,title:d,icon:{url:"data:image/svg+xml;base64,".concat(btoa(a)),anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(f)}}function Ao(n,e){for(var t in e.prototype)n.prototype[t]=e.prototype[t]}class Kt{constructor(){Ao(Kt,google.maps.OverlayView)}}var $e;(function(n){n.CLUSTERING_BEGIN="clusteringbegin",n.CLUSTERING_END="clusteringend",n.CLUSTER_CLICK="click"})($e||($e={}));var Uo=(n,e,t)=>{t.fitBounds(e.bounds)};class Wo extends Kt{constructor(e){var{map:t,markers:i=[],algorithmOptions:s={},algorithm:o=new Bo(s),renderer:r=new No,onClusterClick:a=Uo}=e;super(),this.markers=[...i],this.clusters=[],this.algorithm=o,this.renderer=r,this.onClusterClick=a,t&&this.setMap(t)}addMarker(e,t){this.markers.includes(e)||(this.markers.push(e),t||this.render())}addMarkers(e,t){e.forEach(i=>{this.addMarker(i,!0)}),t||this.render()}removeMarker(e,t){var i=this.markers.indexOf(e);return i===-1?!1:(ue.setMap(e,null),this.markers.splice(i,1),t||this.render(),!0)}removeMarkers(e,t){var i=!1;return e.forEach(s=>{i=this.removeMarker(s,!0)||i}),i&&!t&&this.render(),i}clearMarkers(e){this.markers.length=0,e||this.render()}render(){var e=this.getMap();if(e instanceof google.maps.Map&&e.getProjection()){google.maps.event.trigger(this,$e.CLUSTERING_BEGIN,this);var{clusters:t,changed:i}=this.algorithm.calculate({markers:this.markers,map:e,mapCanvasProjection:this.getProjection()});if(i||i==null){var s=new Set;for(var o of t)o.markers.length==1&&s.add(o.markers[0]);var r=[];for(var a of this.clusters)a.marker!=null&&(a.markers.length==1?s.has(a.marker)||ue.setMap(a.marker,null):r.push(a.marker));this.clusters=t,this.renderClusters(),requestAnimationFrame(()=>r.forEach(d=>ue.setMap(d,null)))}google.maps.event.trigger(this,$e.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(e=>ue.setMap(e,null)),this.clusters.forEach(e=>e.delete()),this.clusters=[]}renderClusters(){var e=new Ro(this.markers,this.clusters),t=this.getMap();this.clusters.forEach(i=>{i.markers.length===1?i.marker=i.markers[0]:(i.marker=this.renderer.render(i,e,t),i.markers.forEach(s=>ue.setMap(s,null)),this.onClusterClick&&i.marker.addListener("click",s=>{google.maps.event.trigger(this,$e.CLUSTER_CLICK,i),this.onClusterClick(s,i,t)})),ue.setMap(i.marker,t)})}}function zi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Vi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zi(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Go(n){var e=Fs(),[t,i]=l.useState(null);return l.useEffect(()=>{if(e&&t===null){var s=new Wo(Vi(Vi({},n),{},{map:e}));i(s)}},[e]),t}function zo(n){var{children:e,options:t}=n,i=Go(t);return i!==null?e(i):null}l.memo(zo);var $i={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},Zi={options(n,e){n.setOptions(e)},position(n,e){n.setPosition(e)},zIndex(n,e){n.setZIndex(e)}};function Vo(n){var{children:e,anchor:t,options:i,position:s,zIndex:o,onCloseClick:r,onDomReady:a,onContentChanged:d,onPositionChanged:h,onZindexChanged:c,onLoad:u,onUnmount:p}=n,f=l.useContext(N),[g,m]=l.useState(null),[C,E]=l.useState(null),[P,S]=l.useState(null),[y,v]=l.useState(null),[b,w]=l.useState(null),[k,M]=l.useState(null),I=l.useRef(null);return l.useEffect(()=>{g!==null&&(g.close(),t?g.open(f,t):g.getPosition()&&g.open(f))},[f,g,t]),l.useEffect(()=>{i&&g!==null&&g.setOptions(i)},[g,i]),l.useEffect(()=>{s&&g!==null&&g.setPosition(s)},[s]),l.useEffect(()=>{typeof o=="number"&&g!==null&&g.setZIndex(o)},[o]),l.useEffect(()=>{g&&r&&(C!==null&&google.maps.event.removeListener(C),E(google.maps.event.addListener(g,"closeclick",r)))},[r]),l.useEffect(()=>{g&&a&&(P!==null&&google.maps.event.removeListener(P),S(google.maps.event.addListener(g,"domready",a)))},[a]),l.useEffect(()=>{g&&d&&(y!==null&&google.maps.event.removeListener(y),v(google.maps.event.addListener(g,"content_changed",d)))},[d]),l.useEffect(()=>{g&&h&&(b!==null&&google.maps.event.removeListener(b),w(google.maps.event.addListener(g,"position_changed",h)))},[h]),l.useEffect(()=>{g&&c&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(g,"zindex_changed",c)))},[c]),l.useEffect(()=>{var O=new google.maps.InfoWindow(i);return m(O),I.current=document.createElement("div"),r&&E(google.maps.event.addListener(O,"closeclick",r)),a&&S(google.maps.event.addListener(O,"domready",a)),d&&v(google.maps.event.addListener(O,"content_changed",d)),h&&w(google.maps.event.addListener(O,"position_changed",h)),c&&M(google.maps.event.addListener(O,"zindex_changed",c)),O.setContent(I.current),s&&O.setPosition(s),o&&O.setZIndex(o),t?O.open(f,t):O.getPosition()?O.open(f):ae(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>."),u&&u(O),()=>{C&&google.maps.event.removeListener(C),y&&google.maps.event.removeListener(y),P&&google.maps.event.removeListener(P),b&&google.maps.event.removeListener(b),k&&google.maps.event.removeListener(k),p&&p(O),O.close()}},[]),I.current?Te.createPortal(l.Children.only(e),I.current):null}l.memo(Vo);class $o extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"containerElement",null),L(this,"state",{infoWindow:null}),L(this,"open",(e,t)=>{t?e.open(this.context,t):e.getPosition()?e.open(this.context):ae(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.")}),L(this,"setInfoWindowCallback",()=>{this.state.infoWindow!==null&&this.containerElement!==null&&(this.state.infoWindow.setContent(this.containerElement),this.open(this.state.infoWindow,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoWindow))})}componentDidMount(){var e=new google.maps.InfoWindow(this.props.options);this.containerElement=document.createElement("div"),this.registeredEvents=W({updaterMap:Zi,eventMap:$i,prevProps:{},nextProps:this.props,instance:e}),this.setState(()=>({infoWindow:e}),this.setInfoWindowCallback)}componentDidUpdate(e){this.state.infoWindow!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Zi,eventMap:$i,prevProps:e,nextProps:this.props,instance:this.state.infoWindow}))}componentWillUnmount(){this.state.infoWindow!==null&&(V(this.registeredEvents),this.props.onUnmount&&this.props.onUnmount(this.state.infoWindow),this.state.infoWindow.close())}render(){return this.containerElement?Te.createPortal(l.Children.only(this.props.children),this.containerElement):null}}L($o,"contextType",N);function Hi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Lt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hi(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Hi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Ki={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},Yi={draggable(n,e){n.setDraggable(e)},editable(n,e){n.setEditable(e)},map(n,e){n.setMap(e)},options(n,e){n.setOptions(e)},path(n,e){n.setPath(e)},visible(n,e){n.setVisible(e)}},Zo={};function Ho(n){var{options:e,draggable:t,editable:i,visible:s,path:o,onDblClick:r,onDragEnd:a,onDragStart:d,onMouseDown:h,onMouseMove:c,onMouseOut:u,onMouseOver:p,onMouseUp:f,onRightClick:g,onClick:m,onDrag:C,onLoad:E,onUnmount:P}=n,S=l.useContext(N),[y,v]=l.useState(null),[b,w]=l.useState(null),[k,M]=l.useState(null),[I,O]=l.useState(null),[_,U]=l.useState(null),[T,B]=l.useState(null),[G,K]=l.useState(null),[z,Y]=l.useState(null),[$,X]=l.useState(null),[Q,F]=l.useState(null),[ee,x]=l.useState(null),[oe,ne]=l.useState(null);return l.useEffect(()=>{y!==null&&y.setMap(S)},[S]),l.useEffect(()=>{typeof e<"u"&&y!==null&&y.setOptions(e)},[y,e]),l.useEffect(()=>{typeof t<"u"&&y!==null&&y.setDraggable(t)},[y,t]),l.useEffect(()=>{typeof i<"u"&&y!==null&&y.setEditable(i)},[y,i]),l.useEffect(()=>{typeof s<"u"&&y!==null&&y.setVisible(s)},[y,s]),l.useEffect(()=>{typeof o<"u"&&y!==null&&y.setPath(o)},[y,o]),l.useEffect(()=>{y&&r&&(b!==null&&google.maps.event.removeListener(b),w(google.maps.event.addListener(y,"dblclick",r)))},[r]),l.useEffect(()=>{y&&a&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(y,"dragend",a)))},[a]),l.useEffect(()=>{y&&d&&(I!==null&&google.maps.event.removeListener(I),O(google.maps.event.addListener(y,"dragstart",d)))},[d]),l.useEffect(()=>{y&&h&&(_!==null&&google.maps.event.removeListener(_),U(google.maps.event.addListener(y,"mousedown",h)))},[h]),l.useEffect(()=>{y&&c&&(T!==null&&google.maps.event.removeListener(T),B(google.maps.event.addListener(y,"mousemove",c)))},[c]),l.useEffect(()=>{y&&u&&(G!==null&&google.maps.event.removeListener(G),K(google.maps.event.addListener(y,"mouseout",u)))},[u]),l.useEffect(()=>{y&&p&&(z!==null&&google.maps.event.removeListener(z),Y(google.maps.event.addListener(y,"mouseover",p)))},[p]),l.useEffect(()=>{y&&f&&($!==null&&google.maps.event.removeListener($),X(google.maps.event.addListener(y,"mouseup",f)))},[f]),l.useEffect(()=>{y&&g&&(Q!==null&&google.maps.event.removeListener(Q),F(google.maps.event.addListener(y,"rightclick",g)))},[g]),l.useEffect(()=>{y&&m&&(ee!==null&&google.maps.event.removeListener(ee),x(google.maps.event.addListener(y,"click",m)))},[m]),l.useEffect(()=>{y&&C&&(oe!==null&&google.maps.event.removeListener(oe),ne(google.maps.event.addListener(y,"drag",C)))},[C]),l.useEffect(()=>{var A=new google.maps.Polyline(Lt(Lt({},e||Zo),{},{map:S}));return o&&A.setPath(o),typeof s<"u"&&A.setVisible(s),typeof i<"u"&&A.setEditable(i),typeof t<"u"&&A.setDraggable(t),r&&w(google.maps.event.addListener(A,"dblclick",r)),a&&M(google.maps.event.addListener(A,"dragend",a)),d&&O(google.maps.event.addListener(A,"dragstart",d)),h&&U(google.maps.event.addListener(A,"mousedown",h)),c&&B(google.maps.event.addListener(A,"mousemove",c)),u&&K(google.maps.event.addListener(A,"mouseout",u)),p&&Y(google.maps.event.addListener(A,"mouseover",p)),f&&X(google.maps.event.addListener(A,"mouseup",f)),g&&F(google.maps.event.addListener(A,"rightclick",g)),m&&x(google.maps.event.addListener(A,"click",m)),C&&ne(google.maps.event.addListener(A,"drag",C)),v(A),E&&E(A),()=>{b!==null&&google.maps.event.removeListener(b),k!==null&&google.maps.event.removeListener(k),I!==null&&google.maps.event.removeListener(I),_!==null&&google.maps.event.removeListener(_),T!==null&&google.maps.event.removeListener(T),G!==null&&google.maps.event.removeListener(G),z!==null&&google.maps.event.removeListener(z),$!==null&&google.maps.event.removeListener($),Q!==null&&google.maps.event.removeListener(Q),ee!==null&&google.maps.event.removeListener(ee),P&&P(A),A.setMap(null)}},[]),null}l.memo(Ho);class Ko extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{polyline:null}),L(this,"setPolylineCallback",()=>{this.state.polyline!==null&&this.props.onLoad&&this.props.onLoad(this.state.polyline)})}componentDidMount(){var e=new google.maps.Polyline(Lt(Lt({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:Yi,eventMap:Ki,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{polyline:e}},this.setPolylineCallback)}componentDidUpdate(e){this.state.polyline!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Yi,eventMap:Ki,prevProps:e,nextProps:this.props,instance:this.state.polyline}))}componentWillUnmount(){this.state.polyline!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.polyline),V(this.registeredEvents),this.state.polyline.setMap(null))}render(){return null}}L(Ko,"contextType",N);function Xi(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function qi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xi(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Xi(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Ji={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},Qi={draggable(n,e){n.setDraggable(e)},editable(n,e){n.setEditable(e)},map(n,e){n.setMap(e)},options(n,e){n.setOptions(e)},path(n,e){n.setPath(e)},paths(n,e){n.setPaths(e)},visible(n,e){n.setVisible(e)}};function Yo(n){var{options:e,draggable:t,editable:i,visible:s,path:o,paths:r,onDblClick:a,onDragEnd:d,onDragStart:h,onMouseDown:c,onMouseMove:u,onMouseOut:p,onMouseOver:f,onMouseUp:g,onRightClick:m,onClick:C,onDrag:E,onLoad:P,onUnmount:S,onEdit:y}=n,v=l.useContext(N),[b,w]=l.useState(null),[k,M]=l.useState(null),[I,O]=l.useState(null),[_,U]=l.useState(null),[T,B]=l.useState(null),[G,K]=l.useState(null),[z,Y]=l.useState(null),[$,X]=l.useState(null),[Q,F]=l.useState(null),[ee,x]=l.useState(null),[oe,ne]=l.useState(null),[A,re]=l.useState(null);return l.useEffect(()=>{b!==null&&b.setMap(v)},[v]),l.useEffect(()=>{typeof e<"u"&&b!==null&&b.setOptions(e)},[b,e]),l.useEffect(()=>{typeof t<"u"&&b!==null&&b.setDraggable(t)},[b,t]),l.useEffect(()=>{typeof i<"u"&&b!==null&&b.setEditable(i)},[b,i]),l.useEffect(()=>{typeof s<"u"&&b!==null&&b.setVisible(s)},[b,s]),l.useEffect(()=>{typeof o<"u"&&b!==null&&b.setPath(o)},[b,o]),l.useEffect(()=>{typeof r<"u"&&b!==null&&b.setPaths(r)},[b,r]),l.useEffect(()=>{b&&typeof a=="function"&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(b,"dblclick",a)))},[a]),l.useEffect(()=>{b&&(google.maps.event.addListener(b.getPath(),"insert_at",()=>{y?.(b)}),google.maps.event.addListener(b.getPath(),"set_at",()=>{y?.(b)}),google.maps.event.addListener(b.getPath(),"remove_at",()=>{y?.(b)}))},[b,y]),l.useEffect(()=>{b&&typeof d=="function"&&(I!==null&&google.maps.event.removeListener(I),O(google.maps.event.addListener(b,"dragend",d)))},[d]),l.useEffect(()=>{b&&typeof h=="function"&&(_!==null&&google.maps.event.removeListener(_),U(google.maps.event.addListener(b,"dragstart",h)))},[h]),l.useEffect(()=>{b&&typeof c=="function"&&(T!==null&&google.maps.event.removeListener(T),B(google.maps.event.addListener(b,"mousedown",c)))},[c]),l.useEffect(()=>{b&&typeof u=="function"&&(G!==null&&google.maps.event.removeListener(G),K(google.maps.event.addListener(b,"mousemove",u)))},[u]),l.useEffect(()=>{b&&typeof p=="function"&&(z!==null&&google.maps.event.removeListener(z),Y(google.maps.event.addListener(b,"mouseout",p)))},[p]),l.useEffect(()=>{b&&typeof f=="function"&&($!==null&&google.maps.event.removeListener($),X(google.maps.event.addListener(b,"mouseover",f)))},[f]),l.useEffect(()=>{b&&typeof g=="function"&&(Q!==null&&google.maps.event.removeListener(Q),F(google.maps.event.addListener(b,"mouseup",g)))},[g]),l.useEffect(()=>{b&&typeof m=="function"&&(ee!==null&&google.maps.event.removeListener(ee),x(google.maps.event.addListener(b,"rightclick",m)))},[m]),l.useEffect(()=>{b&&typeof C=="function"&&(oe!==null&&google.maps.event.removeListener(oe),ne(google.maps.event.addListener(b,"click",C)))},[C]),l.useEffect(()=>{b&&typeof E=="function"&&(A!==null&&google.maps.event.removeListener(A),re(google.maps.event.addListener(b,"drag",E)))},[E]),l.useEffect(()=>{var j=new google.maps.Polygon(qi(qi({},e),{},{map:v}));return o&&j.setPath(o),r&&j.setPaths(r),typeof s<"u"&&j.setVisible(s),typeof i<"u"&&j.setEditable(i),typeof t<"u"&&j.setDraggable(t),a&&M(google.maps.event.addListener(j,"dblclick",a)),d&&O(google.maps.event.addListener(j,"dragend",d)),h&&U(google.maps.event.addListener(j,"dragstart",h)),c&&B(google.maps.event.addListener(j,"mousedown",c)),u&&K(google.maps.event.addListener(j,"mousemove",u)),p&&Y(google.maps.event.addListener(j,"mouseout",p)),f&&X(google.maps.event.addListener(j,"mouseover",f)),g&&F(google.maps.event.addListener(j,"mouseup",g)),m&&x(google.maps.event.addListener(j,"rightclick",m)),C&&ne(google.maps.event.addListener(j,"click",C)),E&&re(google.maps.event.addListener(j,"drag",E)),w(j),P&&P(j),()=>{k!==null&&google.maps.event.removeListener(k),I!==null&&google.maps.event.removeListener(I),_!==null&&google.maps.event.removeListener(_),T!==null&&google.maps.event.removeListener(T),G!==null&&google.maps.event.removeListener(G),z!==null&&google.maps.event.removeListener(z),$!==null&&google.maps.event.removeListener($),Q!==null&&google.maps.event.removeListener(Q),ee!==null&&google.maps.event.removeListener(ee),oe!==null&&google.maps.event.removeListener(oe),S&&S(j),j.setMap(null)}},[]),null}l.memo(Yo);class Xo extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[])}componentDidMount(){var e=this.props.options||{};this.polygon=new google.maps.Polygon(e),this.polygon.setMap(this.context),this.registeredEvents=W({updaterMap:Qi,eventMap:Ji,prevProps:{},nextProps:this.props,instance:this.polygon}),this.props.onLoad&&this.props.onLoad(this.polygon)}componentDidUpdate(e){this.polygon&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Qi,eventMap:Ji,prevProps:e,nextProps:this.props,instance:this.polygon}))}componentWillUnmount(){this.polygon&&(this.props.onUnmount&&this.props.onUnmount(this.polygon),V(this.registeredEvents),this.polygon&&this.polygon.setMap(null))}render(){return null}}L(Xo,"contextType",N);function en(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function bt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?en(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):en(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var tn={onBoundsChanged:"bounds_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},nn={bounds(n,e){n.setBounds(e)},draggable(n,e){n.setDraggable(e)},editable(n,e){n.setEditable(e)},map(n,e){n.setMap(e)},options(n,e){n.setOptions(e)},visible(n,e){n.setVisible(e)}};function qo(n){var{options:e,bounds:t,draggable:i,editable:s,visible:o,onDblClick:r,onDragEnd:a,onDragStart:d,onMouseDown:h,onMouseMove:c,onMouseOut:u,onMouseOver:p,onMouseUp:f,onRightClick:g,onClick:m,onDrag:C,onBoundsChanged:E,onLoad:P,onUnmount:S}=n,y=l.useContext(N),[v,b]=l.useState(null),[w,k]=l.useState(null),[M,I]=l.useState(null),[O,_]=l.useState(null),[U,T]=l.useState(null),[B,G]=l.useState(null),[K,z]=l.useState(null),[Y,$]=l.useState(null),[X,Q]=l.useState(null),[F,ee]=l.useState(null),[x,oe]=l.useState(null),[ne,A]=l.useState(null),[re,j]=l.useState(null);return l.useEffect(()=>{v!==null&&v.setMap(y)},[y]),l.useEffect(()=>{typeof e<"u"&&v!==null&&v.setOptions(e)},[v,e]),l.useEffect(()=>{typeof i<"u"&&v!==null&&v.setDraggable(i)},[v,i]),l.useEffect(()=>{typeof s<"u"&&v!==null&&v.setEditable(s)},[v,s]),l.useEffect(()=>{typeof o<"u"&&v!==null&&v.setVisible(o)},[v,o]),l.useEffect(()=>{typeof t<"u"&&v!==null&&v.setBounds(t)},[v,t]),l.useEffect(()=>{v&&r&&(w!==null&&google.maps.event.removeListener(w),k(google.maps.event.addListener(v,"dblclick",r)))},[r]),l.useEffect(()=>{v&&a&&(M!==null&&google.maps.event.removeListener(M),I(google.maps.event.addListener(v,"dragend",a)))},[a]),l.useEffect(()=>{v&&d&&(O!==null&&google.maps.event.removeListener(O),_(google.maps.event.addListener(v,"dragstart",d)))},[d]),l.useEffect(()=>{v&&h&&(U!==null&&google.maps.event.removeListener(U),T(google.maps.event.addListener(v,"mousedown",h)))},[h]),l.useEffect(()=>{v&&c&&(B!==null&&google.maps.event.removeListener(B),G(google.maps.event.addListener(v,"mousemove",c)))},[c]),l.useEffect(()=>{v&&u&&(K!==null&&google.maps.event.removeListener(K),z(google.maps.event.addListener(v,"mouseout",u)))},[u]),l.useEffect(()=>{v&&p&&(Y!==null&&google.maps.event.removeListener(Y),$(google.maps.event.addListener(v,"mouseover",p)))},[p]),l.useEffect(()=>{v&&f&&(X!==null&&google.maps.event.removeListener(X),Q(google.maps.event.addListener(v,"mouseup",f)))},[f]),l.useEffect(()=>{v&&g&&(F!==null&&google.maps.event.removeListener(F),ee(google.maps.event.addListener(v,"rightclick",g)))},[g]),l.useEffect(()=>{v&&m&&(x!==null&&google.maps.event.removeListener(x),oe(google.maps.event.addListener(v,"click",m)))},[m]),l.useEffect(()=>{v&&C&&(ne!==null&&google.maps.event.removeListener(ne),A(google.maps.event.addListener(v,"drag",C)))},[C]),l.useEffect(()=>{v&&E&&(re!==null&&google.maps.event.removeListener(re),j(google.maps.event.addListener(v,"bounds_changed",E)))},[E]),l.useEffect(()=>{var Z=new google.maps.Rectangle(bt(bt({},e),{},{map:y}));return typeof o<"u"&&Z.setVisible(o),typeof s<"u"&&Z.setEditable(s),typeof i<"u"&&Z.setDraggable(i),typeof t<"u"&&Z.setBounds(t),r&&k(google.maps.event.addListener(Z,"dblclick",r)),a&&I(google.maps.event.addListener(Z,"dragend",a)),d&&_(google.maps.event.addListener(Z,"dragstart",d)),h&&T(google.maps.event.addListener(Z,"mousedown",h)),c&&G(google.maps.event.addListener(Z,"mousemove",c)),u&&z(google.maps.event.addListener(Z,"mouseout",u)),p&&$(google.maps.event.addListener(Z,"mouseover",p)),f&&Q(google.maps.event.addListener(Z,"mouseup",f)),g&&ee(google.maps.event.addListener(Z,"rightclick",g)),m&&oe(google.maps.event.addListener(Z,"click",m)),C&&A(google.maps.event.addListener(Z,"drag",C)),E&&j(google.maps.event.addListener(Z,"bounds_changed",E)),b(Z),P&&P(Z),()=>{w!==null&&google.maps.event.removeListener(w),M!==null&&google.maps.event.removeListener(M),O!==null&&google.maps.event.removeListener(O),U!==null&&google.maps.event.removeListener(U),B!==null&&google.maps.event.removeListener(B),K!==null&&google.maps.event.removeListener(K),Y!==null&&google.maps.event.removeListener(Y),X!==null&&google.maps.event.removeListener(X),F!==null&&google.maps.event.removeListener(F),x!==null&&google.maps.event.removeListener(x),ne!==null&&google.maps.event.removeListener(ne),re!==null&&google.maps.event.removeListener(re),S&&S(Z),Z.setMap(null)}},[]),null}l.memo(qo);class Jo extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{rectangle:null}),L(this,"setRectangleCallback",()=>{this.state.rectangle!==null&&this.props.onLoad&&this.props.onLoad(this.state.rectangle)})}componentDidMount(){var e=new google.maps.Rectangle(bt(bt({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:nn,eventMap:tn,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{rectangle:e}},this.setRectangleCallback)}componentDidUpdate(e){this.state.rectangle!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:nn,eventMap:tn,prevProps:e,nextProps:this.props,instance:this.state.rectangle}))}componentWillUnmount(){this.state.rectangle!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.rectangle),V(this.registeredEvents),this.state.rectangle.setMap(null))}render(){return null}}L(Jo,"contextType",N);function sn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Et(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sn(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):sn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var on={onCenterChanged:"center_changed",onRadiusChanged:"radius_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},rn={center(n,e){n.setCenter(e)},draggable(n,e){n.setDraggable(e)},editable(n,e){n.setEditable(e)},map(n,e){n.setMap(e)},options(n,e){n.setOptions(e)},radius(n,e){n.setRadius(e)},visible(n,e){n.setVisible(e)}},Qo={};function er(n){var{options:e,center:t,radius:i,draggable:s,editable:o,visible:r,onDblClick:a,onDragEnd:d,onDragStart:h,onMouseDown:c,onMouseMove:u,onMouseOut:p,onMouseOver:f,onMouseUp:g,onRightClick:m,onClick:C,onDrag:E,onCenterChanged:P,onRadiusChanged:S,onLoad:y,onUnmount:v}=n,b=l.useContext(N),[w,k]=l.useState(null),[M,I]=l.useState(null),[O,_]=l.useState(null),[U,T]=l.useState(null),[B,G]=l.useState(null),[K,z]=l.useState(null),[Y,$]=l.useState(null),[X,Q]=l.useState(null),[F,ee]=l.useState(null),[x,oe]=l.useState(null),[ne,A]=l.useState(null),[re,j]=l.useState(null),[Z,fe]=l.useState(null),[ve,Re]=l.useState(null);return l.useEffect(()=>{w!==null&&w.setMap(b)},[b]),l.useEffect(()=>{typeof e<"u"&&w!==null&&w.setOptions(e)},[w,e]),l.useEffect(()=>{typeof s<"u"&&w!==null&&w.setDraggable(s)},[w,s]),l.useEffect(()=>{typeof o<"u"&&w!==null&&w.setEditable(o)},[w,o]),l.useEffect(()=>{typeof r<"u"&&w!==null&&w.setVisible(r)},[w,r]),l.useEffect(()=>{typeof i=="number"&&w!==null&&w.setRadius(i)},[w,i]),l.useEffect(()=>{typeof t<"u"&&w!==null&&w.setCenter(t)},[w,t]),l.useEffect(()=>{w&&a&&(M!==null&&google.maps.event.removeListener(M),I(google.maps.event.addListener(w,"dblclick",a)))},[a]),l.useEffect(()=>{w&&d&&(O!==null&&google.maps.event.removeListener(O),_(google.maps.event.addListener(w,"dragend",d)))},[d]),l.useEffect(()=>{w&&h&&(U!==null&&google.maps.event.removeListener(U),T(google.maps.event.addListener(w,"dragstart",h)))},[h]),l.useEffect(()=>{w&&c&&(B!==null&&google.maps.event.removeListener(B),G(google.maps.event.addListener(w,"mousedown",c)))},[c]),l.useEffect(()=>{w&&u&&(K!==null&&google.maps.event.removeListener(K),z(google.maps.event.addListener(w,"mousemove",u)))},[u]),l.useEffect(()=>{w&&p&&(Y!==null&&google.maps.event.removeListener(Y),$(google.maps.event.addListener(w,"mouseout",p)))},[p]),l.useEffect(()=>{w&&f&&(X!==null&&google.maps.event.removeListener(X),Q(google.maps.event.addListener(w,"mouseover",f)))},[f]),l.useEffect(()=>{w&&g&&(F!==null&&google.maps.event.removeListener(F),ee(google.maps.event.addListener(w,"mouseup",g)))},[g]),l.useEffect(()=>{w&&m&&(x!==null&&google.maps.event.removeListener(x),oe(google.maps.event.addListener(w,"rightclick",m)))},[m]),l.useEffect(()=>{w&&C&&(ne!==null&&google.maps.event.removeListener(ne),A(google.maps.event.addListener(w,"click",C)))},[C]),l.useEffect(()=>{w&&E&&(re!==null&&google.maps.event.removeListener(re),j(google.maps.event.addListener(w,"drag",E)))},[E]),l.useEffect(()=>{w&&P&&(Z!==null&&google.maps.event.removeListener(Z),fe(google.maps.event.addListener(w,"center_changed",P)))},[C]),l.useEffect(()=>{w&&S&&(ve!==null&&google.maps.event.removeListener(ve),Re(google.maps.event.addListener(w,"radius_changed",S)))},[S]),l.useEffect(()=>{var te=new google.maps.Circle(Et(Et({},e||Qo),{},{map:b}));return typeof i=="number"&&te.setRadius(i),typeof t<"u"&&te.setCenter(t),typeof i=="number"&&te.setRadius(i),typeof r<"u"&&te.setVisible(r),typeof o<"u"&&te.setEditable(o),typeof s<"u"&&te.setDraggable(s),a&&I(google.maps.event.addListener(te,"dblclick",a)),d&&_(google.maps.event.addListener(te,"dragend",d)),h&&T(google.maps.event.addListener(te,"dragstart",h)),c&&G(google.maps.event.addListener(te,"mousedown",c)),u&&z(google.maps.event.addListener(te,"mousemove",u)),p&&$(google.maps.event.addListener(te,"mouseout",p)),f&&Q(google.maps.event.addListener(te,"mouseover",f)),g&&ee(google.maps.event.addListener(te,"mouseup",g)),m&&oe(google.maps.event.addListener(te,"rightclick",m)),C&&A(google.maps.event.addListener(te,"click",C)),E&&j(google.maps.event.addListener(te,"drag",E)),P&&fe(google.maps.event.addListener(te,"center_changed",P)),S&&Re(google.maps.event.addListener(te,"radius_changed",S)),k(te),y&&y(te),()=>{M!==null&&google.maps.event.removeListener(M),O!==null&&google.maps.event.removeListener(O),U!==null&&google.maps.event.removeListener(U),B!==null&&google.maps.event.removeListener(B),K!==null&&google.maps.event.removeListener(K),Y!==null&&google.maps.event.removeListener(Y),X!==null&&google.maps.event.removeListener(X),F!==null&&google.maps.event.removeListener(F),x!==null&&google.maps.event.removeListener(x),ne!==null&&google.maps.event.removeListener(ne),Z!==null&&google.maps.event.removeListener(Z),ve!==null&&google.maps.event.removeListener(ve),v&&v(te),te.setMap(null)}},[]),null}l.memo(er);class tr extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{circle:null}),L(this,"setCircleCallback",()=>{this.state.circle!==null&&this.props.onLoad&&this.props.onLoad(this.state.circle)})}componentDidMount(){var e=new google.maps.Circle(Et(Et({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:rn,eventMap:on,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{circle:e}},this.setCircleCallback)}componentDidUpdate(e){this.state.circle!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:rn,eventMap:on,prevProps:e,nextProps:this.props,instance:this.state.circle}))}componentWillUnmount(){if(this.state.circle!==null){var e;this.props.onUnmount&&this.props.onUnmount(this.state.circle),V(this.registeredEvents),(e=this.state.circle)===null||e===void 0||e.setMap(null)}}render(){return null}}L(tr,"contextType",N);function an(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Mt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?an(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):an(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var ln={onClick:"click",onDblClick:"dblclick",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick",onAddFeature:"addfeature",onRemoveFeature:"removefeature",onRemoveProperty:"removeproperty",onSetGeometry:"setgeometry",onSetProperty:"setproperty"},dn={add(n,e){n.add(e)},addgeojson(n,e,t){n.addGeoJson(e,t)},contains(n,e){n.contains(e)},foreach(n,e){n.forEach(e)},loadgeojson(n,e,t,i){n.loadGeoJson(e,t,i)},overridestyle(n,e,t){n.overrideStyle(e,t)},remove(n,e){n.remove(e)},revertstyle(n,e){n.revertStyle(e)},controlposition(n,e){n.setControlPosition(e)},controls(n,e){n.setControls(e)},drawingmode(n,e){n.setDrawingMode(e)},map(n,e){n.setMap(e)},style(n,e){n.setStyle(e)},togeojson(n,e){n.toGeoJson(e)}};function ir(n){var{options:e,onClick:t,onDblClick:i,onMouseDown:s,onMouseMove:o,onMouseOut:r,onMouseOver:a,onMouseUp:d,onRightClick:h,onAddFeature:c,onRemoveFeature:u,onRemoveProperty:p,onSetGeometry:f,onSetProperty:g,onLoad:m,onUnmount:C}=n,E=l.useContext(N),[P,S]=l.useState(null),[y,v]=l.useState(null),[b,w]=l.useState(null),[k,M]=l.useState(null),[I,O]=l.useState(null),[_,U]=l.useState(null),[T,B]=l.useState(null),[G,K]=l.useState(null),[z,Y]=l.useState(null),[$,X]=l.useState(null),[Q,F]=l.useState(null),[ee,x]=l.useState(null),[oe,ne]=l.useState(null),[A,re]=l.useState(null);return l.useEffect(()=>{P!==null&&P.setMap(E)},[E]),l.useEffect(()=>{P&&i&&(y!==null&&google.maps.event.removeListener(y),v(google.maps.event.addListener(P,"dblclick",i)))},[i]),l.useEffect(()=>{P&&s&&(b!==null&&google.maps.event.removeListener(b),w(google.maps.event.addListener(P,"mousedown",s)))},[s]),l.useEffect(()=>{P&&o&&(k!==null&&google.maps.event.removeListener(k),M(google.maps.event.addListener(P,"mousemove",o)))},[o]),l.useEffect(()=>{P&&r&&(I!==null&&google.maps.event.removeListener(I),O(google.maps.event.addListener(P,"mouseout",r)))},[r]),l.useEffect(()=>{P&&a&&(_!==null&&google.maps.event.removeListener(_),U(google.maps.event.addListener(P,"mouseover",a)))},[a]),l.useEffect(()=>{P&&d&&(T!==null&&google.maps.event.removeListener(T),B(google.maps.event.addListener(P,"mouseup",d)))},[d]),l.useEffect(()=>{P&&h&&(G!==null&&google.maps.event.removeListener(G),K(google.maps.event.addListener(P,"rightclick",h)))},[h]),l.useEffect(()=>{P&&t&&(z!==null&&google.maps.event.removeListener(z),Y(google.maps.event.addListener(P,"click",t)))},[t]),l.useEffect(()=>{P&&c&&($!==null&&google.maps.event.removeListener($),X(google.maps.event.addListener(P,"addfeature",c)))},[c]),l.useEffect(()=>{P&&u&&(Q!==null&&google.maps.event.removeListener(Q),F(google.maps.event.addListener(P,"removefeature",u)))},[u]),l.useEffect(()=>{P&&p&&(ee!==null&&google.maps.event.removeListener(ee),x(google.maps.event.addListener(P,"removeproperty",p)))},[p]),l.useEffect(()=>{P&&f&&(oe!==null&&google.maps.event.removeListener(oe),ne(google.maps.event.addListener(P,"setgeometry",f)))},[f]),l.useEffect(()=>{P&&g&&(A!==null&&google.maps.event.removeListener(A),re(google.maps.event.addListener(P,"setproperty",g)))},[g]),l.useEffect(()=>{if(E!==null){var j=new google.maps.Data(Mt(Mt({},e),{},{map:E}));i&&v(google.maps.event.addListener(j,"dblclick",i)),s&&w(google.maps.event.addListener(j,"mousedown",s)),o&&M(google.maps.event.addListener(j,"mousemove",o)),r&&O(google.maps.event.addListener(j,"mouseout",r)),a&&U(google.maps.event.addListener(j,"mouseover",a)),d&&B(google.maps.event.addListener(j,"mouseup",d)),h&&K(google.maps.event.addListener(j,"rightclick",h)),t&&Y(google.maps.event.addListener(j,"click",t)),c&&X(google.maps.event.addListener(j,"addfeature",c)),u&&F(google.maps.event.addListener(j,"removefeature",u)),p&&x(google.maps.event.addListener(j,"removeproperty",p)),f&&ne(google.maps.event.addListener(j,"setgeometry",f)),g&&re(google.maps.event.addListener(j,"setproperty",g)),S(j),m&&m(j)}return()=>{P&&(y!==null&&google.maps.event.removeListener(y),b!==null&&google.maps.event.removeListener(b),k!==null&&google.maps.event.removeListener(k),I!==null&&google.maps.event.removeListener(I),_!==null&&google.maps.event.removeListener(_),T!==null&&google.maps.event.removeListener(T),G!==null&&google.maps.event.removeListener(G),z!==null&&google.maps.event.removeListener(z),$!==null&&google.maps.event.removeListener($),Q!==null&&google.maps.event.removeListener(Q),ee!==null&&google.maps.event.removeListener(ee),oe!==null&&google.maps.event.removeListener(oe),A!==null&&google.maps.event.removeListener(A),C&&C(P),P.setMap(null))}},[]),null}l.memo(ir);class nr extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{data:null}),L(this,"setDataCallback",()=>{this.state.data!==null&&this.props.onLoad&&this.props.onLoad(this.state.data)})}componentDidMount(){if(this.context!==null){var e=new google.maps.Data(Mt(Mt({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:dn,eventMap:ln,prevProps:{},nextProps:this.props,instance:e}),this.setState(()=>({data:e}),this.setDataCallback)}}componentDidUpdate(e){this.state.data!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:dn,eventMap:ln,prevProps:e,nextProps:this.props,instance:this.state.data}))}componentWillUnmount(){this.state.data!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.data),V(this.registeredEvents),this.state.data&&this.state.data.setMap(null))}render(){return null}}L(nr,"contextType",N);function hn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function cn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hn(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):hn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var un={onClick:"click",onDefaultViewportChanged:"defaultviewport_changed",onStatusChanged:"status_changed"},pn={options(n,e){n.setOptions(e)},url(n,e){n.setUrl(e)},zIndex(n,e){n.setZIndex(e)}};class sr extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{kmlLayer:null}),L(this,"setKmlLayerCallback",()=>{this.state.kmlLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.kmlLayer)})}componentDidMount(){var e=new google.maps.KmlLayer(cn(cn({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:pn,eventMap:un,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{kmlLayer:e}},this.setKmlLayerCallback)}componentDidUpdate(e){this.state.kmlLayer!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:pn,eventMap:un,prevProps:e,nextProps:this.props,instance:this.state.kmlLayer}))}componentWillUnmount(){this.state.kmlLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.kmlLayer),V(this.registeredEvents),this.state.kmlLayer.setMap(null))}render(){return null}}L(sr,"contextType",N);function os(n,e){return typeof e=="function"?e(n.offsetWidth,n.offsetHeight):{x:0,y:0}}function or(n,e){return new e(n.lat,n.lng)}function rr(n,e){return new e(new google.maps.LatLng(n.ne.lat,n.ne.lng),new google.maps.LatLng(n.sw.lat,n.sw.lng))}function ar(n,e,t){return n instanceof e?n:t(n,e)}function lr(n,e,t){return n instanceof e?n:t(n,e)}function dr(n,e,t){var i=n&&n.fromLatLngToDivPixel(t.getNorthEast()),s=n&&n.fromLatLngToDivPixel(t.getSouthWest());return i&&s?{left:"".concat(s.x+e.x,"px"),top:"".concat(i.y+e.y,"px"),width:"".concat(i.x-s.x-e.x,"px"),height:"".concat(s.y-i.y-e.y,"px")}:{left:"-9999px",top:"-9999px"}}function hr(n,e,t){var i=n&&n.fromLatLngToDivPixel(t);if(i){var{x:s,y:o}=i;return{left:"".concat(s+e.x,"px"),top:"".concat(o+e.y,"px")}}return{left:"-9999px",top:"-9999px"}}function rs(n,e,t,i){return t!==void 0?dr(n,e,lr(t,google.maps.LatLngBounds,rr)):hr(n,e,ar(i,google.maps.LatLng,or))}function cr(n,e){return n.left===e.left&&n.top===e.top&&n.width===e.height&&n.height===e.height}function gn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function ur(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gn(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function pr(n,e,t,i,s){class o extends google.maps.OverlayView{constructor(a,d,h,c){super(),this.container=a,this.pane=d,this.position=h,this.bounds=c}onAdd(){var a,d=(a=this.getPanes())===null||a===void 0?void 0:a[this.pane];d?.appendChild(this.container)}draw(){var a=this.getProjection(),d=ur({},this.container?os(this.container,s):{x:0,y:0}),h=rs(a,d,this.bounds,this.position);for(var[c,u]of Object.entries(h))this.container.style[c]=u}onRemove(){this.container.parentNode!==null&&this.container.parentNode.removeChild(this.container)}}return new o(n,e,t,i)}function fn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function gr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fn(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function mn(n){if(!n)return"";var e=n instanceof google.maps.LatLng?n:new google.maps.LatLng(n.lat,n.lng);return e+""}function vn(n){if(!n)return"";var e=n instanceof google.maps.LatLngBounds?n:new google.maps.LatLngBounds(new google.maps.LatLng(n.south,n.east),new google.maps.LatLng(n.north,n.west));return e+""}function fr(n){var{position:e,bounds:t,mapPaneName:i,zIndex:s,onLoad:o,onUnmount:r,getPixelPositionOffset:a,children:d}=n,h=l.useContext(N),c=l.useMemo(()=>{var p=document.createElement("div");return p.style.position="absolute",p},[]),u=l.useMemo(()=>pr(c,i,e,t,a),[c,i,e,t]);return l.useEffect(()=>(o?.(u),u?.setMap(h),()=>{r?.(u),u?.setMap(null)}),[h,u]),l.useEffect(()=>{c.style.zIndex="".concat(s)},[s,c]),Te.createPortal(d,c)}l.memo(fr);class Be extends l.PureComponent{constructor(e){super(e),L(this,"state",{paneEl:null,containerStyle:{position:"absolute"}}),L(this,"updatePane",()=>{var i=this.props.mapPaneName,s=this.overlayView.getPanes();ae(!!i,"OverlayView requires props.mapPaneName but got %s",i),s?this.setState({paneEl:s[i]}):this.setState({paneEl:null})}),L(this,"onAdd",()=>{var i,s;this.updatePane(),(i=(s=this.props).onLoad)===null||i===void 0||i.call(s,this.overlayView)}),L(this,"onPositionElement",()=>{var i=this.overlayView.getProjection(),s=gr({x:0,y:0},this.containerRef.current?os(this.containerRef.current,this.props.getPixelPositionOffset):{}),o=rs(i,s,this.props.bounds,this.props.position);if(!cr(o,{left:this.state.containerStyle.left,top:this.state.containerStyle.top,width:this.state.containerStyle.width,height:this.state.containerStyle.height})){var r,a,d,h;this.setState({containerStyle:{top:(r=o.top)!==null&&r!==void 0?r:0,left:(a=o.left)!==null&&a!==void 0?a:0,width:(d=o.width)!==null&&d!==void 0?d:0,height:(h=o.height)!==null&&h!==void 0?h:0,position:"absolute"}})}}),L(this,"draw",()=>{this.onPositionElement()}),L(this,"onRemove",()=>{var i,s;this.setState(()=>({paneEl:null})),(i=(s=this.props).onUnmount)===null||i===void 0||i.call(s,this.overlayView)}),this.containerRef=l.createRef();var t=new google.maps.OverlayView;t.onAdd=this.onAdd,t.draw=this.draw,t.onRemove=this.onRemove,this.overlayView=t}componentDidMount(){this.overlayView.setMap(this.context)}componentDidUpdate(e){var t=mn(e.position),i=mn(this.props.position),s=vn(e.bounds),o=vn(this.props.bounds);(t!==i||s!==o)&&this.overlayView.draw(),e.mapPaneName!==this.props.mapPaneName&&this.updatePane()}componentWillUnmount(){this.overlayView.setMap(null)}render(){var e=this.state.paneEl;return e?Te.createPortal(he.jsx("div",{ref:this.containerRef,style:this.state.containerStyle,children:l.Children.only(this.props.children)}),e):null}}L(Be,"FLOAT_PANE","floatPane");L(Be,"MAP_PANE","mapPane");L(Be,"MARKER_LAYER","markerLayer");L(Be,"OVERLAY_LAYER","overlayLayer");L(Be,"OVERLAY_MOUSE_TARGET","overlayMouseTarget");L(Be,"contextType",N);function mr(){}function yn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Cn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yn(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):yn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var Pn={onDblClick:"dblclick",onClick:"click"},Ln={opacity(n,e){n.setOpacity(e)}};function vr(n){var{url:e,bounds:t,options:i,visible:s}=n,o=l.useContext(N),r=new google.maps.LatLngBounds(new google.maps.LatLng(t.south,t.west),new google.maps.LatLng(t.north,t.east)),a=l.useMemo(()=>new google.maps.GroundOverlay(e,r,i),[]);return l.useEffect(()=>{a!==null&&a.setMap(o)},[o]),l.useEffect(()=>{typeof e<"u"&&a!==null&&(a.set("url",e),a.setMap(o))},[a,e]),l.useEffect(()=>{typeof s<"u"&&a!==null&&a.setOpacity(s?1:0)},[a,s]),l.useEffect(()=>{var d=new google.maps.LatLngBounds(new google.maps.LatLng(t.south,t.west),new google.maps.LatLng(t.north,t.east));typeof t<"u"&&a!==null&&(a.set("bounds",d),a.setMap(o))},[a,t]),null}l.memo(vr);class as extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{groundOverlay:null}),L(this,"setGroundOverlayCallback",()=>{this.state.groundOverlay!==null&&this.props.onLoad&&this.props.onLoad(this.state.groundOverlay)})}componentDidMount(){ae(!!this.props.url||!!this.props.bounds,"For GroundOverlay, url and bounds are passed in to constructor and are immutable after instantiated. This is the behavior of Google Maps JavaScript API v3 ( See https://developers.google.com/maps/documentation/javascript/reference#GroundOverlay) Hence, use the corresponding two props provided by `react-google-maps-api`, url and bounds. In some cases, you'll need the GroundOverlay component to reflect the changes of url and bounds. You can leverage the React's key property to remount the component. Typically, just `key={url}` would serve your need. See https://github.com/tomchentw/react-google-maps/issues/655");var e=new google.maps.GroundOverlay(this.props.url,this.props.bounds,Cn(Cn({},this.props.options),{},{map:this.context}));this.registeredEvents=W({updaterMap:Ln,eventMap:Pn,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{groundOverlay:e}},this.setGroundOverlayCallback)}componentDidUpdate(e){this.state.groundOverlay!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:Ln,eventMap:Pn,prevProps:e,nextProps:this.props,instance:this.state.groundOverlay}))}componentWillUnmount(){this.state.groundOverlay&&(this.props.onUnmount&&this.props.onUnmount(this.state.groundOverlay),this.state.groundOverlay.setMap(null))}render(){return null}}L(as,"defaultProps",{onLoad:mr});L(as,"contextType",N);function bn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function xt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bn(Object(t),!0).forEach(function(i){L(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bn(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var En={},Mn={data(n,e){n.setData(e)},map(n,e){n.setMap(e)},options(n,e){n.setOptions(e)}};function yr(n){var{data:e,onLoad:t,onUnmount:i,options:s}=n,o=l.useContext(N),[r,a]=l.useState(null);return l.useEffect(()=>{google.maps.visualization||ae(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} in useJsApiScript? %s',google.maps.visualization)},[]),l.useEffect(()=>{ae(!!e,"data property is required in HeatmapLayer %s",e)},[e]),l.useEffect(()=>{r!==null&&r.setMap(o)},[o]),l.useEffect(()=>{s&&r!==null&&r.setOptions(s)},[r,s]),l.useEffect(()=>{var d=new google.maps.visualization.HeatmapLayer(xt(xt({},s),{},{data:e,map:o}));return a(d),t&&t(d),()=>{r!==null&&(i&&i(r),r.setMap(null))}},[]),null}l.memo(yr);class Cr extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{heatmapLayer:null}),L(this,"setHeatmapLayerCallback",()=>{this.state.heatmapLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.heatmapLayer)})}componentDidMount(){ae(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} to <LoadScript />? %s',google.maps.visualization),ae(!!this.props.data,"data property is required in HeatmapLayer %s",this.props.data);var e=new google.maps.visualization.HeatmapLayer(xt(xt({},this.props.options),{},{data:this.props.data,map:this.context}));this.registeredEvents=W({updaterMap:Mn,eventMap:En,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{heatmapLayer:e}},this.setHeatmapLayerCallback)}componentDidUpdate(e){V(this.registeredEvents),this.registeredEvents=W({updaterMap:Mn,eventMap:En,prevProps:e,nextProps:this.props,instance:this.state.heatmapLayer})}componentWillUnmount(){this.state.heatmapLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.heatmapLayer),V(this.registeredEvents),this.state.heatmapLayer.setMap(null))}render(){return null}}L(Cr,"contextType",N);var xn={onCloseClick:"closeclick",onPanoChanged:"pano_changed",onPositionChanged:"position_changed",onPovChanged:"pov_changed",onResize:"resize",onStatusChanged:"status_changed",onVisibleChanged:"visible_changed",onZoomChanged:"zoom_changed"},wn={register(n,e,t){n.registerPanoProvider(e,t)},links(n,e){n.setLinks(e)},motionTracking(n,e){n.setMotionTracking(e)},options(n,e){n.setOptions(e)},pano(n,e){n.setPano(e)},position(n,e){n.setPosition(e)},pov(n,e){n.setPov(e)},visible(n,e){n.setVisible(e)},zoom(n,e){n.setZoom(e)}};class Pr extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{streetViewPanorama:null}),L(this,"setStreetViewPanoramaCallback",()=>{this.state.streetViewPanorama!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewPanorama)})}componentDidMount(){var e,t,i=(e=(t=this.context)===null||t===void 0?void 0:t.getStreetView())!==null&&e!==void 0?e:null;this.registeredEvents=W({updaterMap:wn,eventMap:xn,prevProps:{},nextProps:this.props,instance:i}),this.setState(()=>({streetViewPanorama:i}),this.setStreetViewPanoramaCallback)}componentDidUpdate(e){this.state.streetViewPanorama!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:wn,eventMap:xn,prevProps:e,nextProps:this.props,instance:this.state.streetViewPanorama}))}componentWillUnmount(){this.state.streetViewPanorama!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.streetViewPanorama),V(this.registeredEvents),this.state.streetViewPanorama.setVisible(!1))}render(){return null}}L(Pr,"contextType",N);class Lr extends l.PureComponent{constructor(){super(...arguments),L(this,"state",{streetViewService:null}),L(this,"setStreetViewServiceCallback",()=>{this.state.streetViewService!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewService)})}componentDidMount(){var e=new google.maps.StreetViewService;this.setState(function(){return{streetViewService:e}},this.setStreetViewServiceCallback)}componentWillUnmount(){this.state.streetViewService!==null&&this.props.onUnmount&&this.props.onUnmount(this.state.streetViewService)}render(){return null}}L(Lr,"contextType",N);var Sn={onDirectionsChanged:"directions_changed"},In={directions(n,e){n.setDirections(e)},map(n,e){n.setMap(e)},options(n,e){n.setOptions(e)},panel(n,e){n.setPanel(e)},routeIndex(n,e){n.setRouteIndex(e)}};class br extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"state",{directionsRenderer:null}),L(this,"setDirectionsRendererCallback",()=>{this.state.directionsRenderer!==null&&(this.state.directionsRenderer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.directionsRenderer))})}componentDidMount(){var e=new google.maps.DirectionsRenderer(this.props.options);this.registeredEvents=W({updaterMap:In,eventMap:Sn,prevProps:{},nextProps:this.props,instance:e}),this.setState(function(){return{directionsRenderer:e}},this.setDirectionsRendererCallback)}componentDidUpdate(e){this.state.directionsRenderer!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:In,eventMap:Sn,prevProps:e,nextProps:this.props,instance:this.state.directionsRenderer}))}componentWillUnmount(){this.state.directionsRenderer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.directionsRenderer),V(this.registeredEvents),this.state.directionsRenderer&&this.state.directionsRenderer.setMap(null))}render(){return null}}L(br,"contextType",N);var On={onPlacesChanged:"places_changed"},kn={bounds(n,e){n.setBounds(e)}};class Er extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"containerElement",l.createRef()),L(this,"state",{searchBox:null}),L(this,"setSearchBoxCallback",()=>{this.state.searchBox!==null&&this.props.onLoad&&this.props.onLoad(this.state.searchBox)})}componentDidMount(){if(ae(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places),this.containerElement!==null&&this.containerElement.current!==null){var e=this.containerElement.current.querySelector("input");if(e!==null){var t=new google.maps.places.SearchBox(e,this.props.options);this.registeredEvents=W({updaterMap:kn,eventMap:On,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{searchBox:t}},this.setSearchBoxCallback)}}}componentDidUpdate(e){this.state.searchBox!==null&&(V(this.registeredEvents),this.registeredEvents=W({updaterMap:kn,eventMap:On,prevProps:e,nextProps:this.props,instance:this.state.searchBox}))}componentWillUnmount(){this.state.searchBox!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.searchBox),V(this.registeredEvents))}render(){return he.jsx("div",{ref:this.containerElement,children:l.Children.only(this.props.children)})}}L(Er,"contextType",N);var Dn={onPlaceChanged:"place_changed"},_n={bounds(n,e){n.setBounds(e)},restrictions(n,e){n.setComponentRestrictions(e)},fields(n,e){n.setFields(e)},options(n,e){n.setOptions(e)},types(n,e){n.setTypes(e)}};class ls extends l.PureComponent{constructor(){super(...arguments),L(this,"registeredEvents",[]),L(this,"containerElement",l.createRef()),L(this,"state",{autocomplete:null}),L(this,"setAutocompleteCallback",()=>{this.state.autocomplete!==null&&this.props.onLoad&&this.props.onLoad(this.state.autocomplete)})}componentDidMount(){var e;ae(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places);var t=(e=this.containerElement.current)===null||e===void 0?void 0:e.querySelector("input");if(t){var i=new google.maps.places.Autocomplete(t,this.props.options);this.registeredEvents=W({updaterMap:_n,eventMap:Dn,prevProps:{},nextProps:this.props,instance:i}),this.setState(()=>({autocomplete:i}),this.setAutocompleteCallback)}}componentDidUpdate(e){V(this.registeredEvents),this.registeredEvents=W({updaterMap:_n,eventMap:Dn,prevProps:e,nextProps:this.props,instance:this.state.autocomplete})}componentWillUnmount(){this.state.autocomplete!==null&&V(this.registeredEvents)}render(){return he.jsx("div",{ref:this.containerElement,className:this.props.className,children:l.Children.only(this.props.children)})}}L(ls,"defaultProps",{className:""});L(ls,"contextType",N);function J(){return J=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},J.apply(null,arguments)}var q;(function(n){n.Commit="commit",n.Provisional="provisional",n.Finish="finish"})(q||(q={}));const le={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT_FEATURE_ID:"selectionPointFeatureId",SELECTION_POINT:"selectionPoint"},D={MODE:"mode",CURRENTLY_DRAWING:"currentlyDrawing",EDITED:"edited",CLOSING_POINT:"closingPoint",SNAPPING_POINT:"snappingPoint",COORDINATE_POINT:"coordinatePoint",COORDINATE_POINT_FEATURE_ID:"coordinatePointFeatureId",COORDINATE_POINT_IDS:"coordinatePointIds",PROVISIONAL_COORDINATE_COUNT:"provisionalCoordinateCount",COMMITTED_COORDINATE_COUNT:"committedCoordinateCount"},Le=10;function Tt(n){return!!(n&&typeof n=="object"&&n!==null&&!Array.isArray(n))}function jn(n){return!!(n&&typeof n=="object"&&"properties"in n&&typeof n.properties=="object"&&n.properties!==null&&"mode"in n.properties)}function Fn(n){return!!function(e){return typeof e=="number"&&!isNaN(new Date(e).valueOf())}(n)}const Mr="Feature mode property does not match the mode being added to";var Fe;(function(n){n.Drawing="drawing",n.Select="select",n.Static="static",n.Render="render"})(Fe||(Fe={}));const xr={rightClick:!0,contextMenu:!1,leftClick:!0,onDragStart:!0,onDrag:!0,onDragEnd:!0};class Ee{get state(){return this._state}set state(e){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if(typeof e!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}constructor(e,t=!1){this._state="unregistered",this._styles={},this.pointerEvents=xr,this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=Fe.Drawing,this.mode="base",t||this.updateOptions(e)}updateOptions(e){e!=null&&e.styles&&(this.styles=J({},this._styles,e.styles)),e!=null&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),e!=null&&e.validation&&(this.validate=e&&e.validation),e!=null&&e.projection&&(this.projection=e.projection),e?.pointerEvents!==void 0&&(this.pointerEvents=e.pointerEvents)}allowPointerEvent(e,t){return typeof e=="boolean"?e:typeof e!="function"||e(t)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}afterFeatureAdded(e){}afterFeatureUpdated(e){}performFeatureValidation(e){if(this._state==="unregistered")throw new Error("Mode must be registered");const t=function(i,s){let o;if(Tt(i))if(i.id==null)o="Feature has no id";else if(typeof i.id!="string"&&typeof i.id!="number")o="Feature must be string or number as per GeoJSON spec";else if(s(i.id))if(Tt(i.geometry))if(Tt(i.properties))if(typeof i.geometry.type=="string"&&["Polygon","LineString","Point"].includes(i.geometry.type))if(Array.isArray(i.geometry.coordinates)){if(!i.properties.mode||typeof i.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else o="Feature coordinates is not an array";else o="Feature is not Point, LineString or Polygon";else o="Feature has no properties";else o="Feature has no geometry";else o="Feature must match the id strategy (default is UUID4)";else o="Feature is not object";return o?{valid:!1,reason:o}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){const i=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional});return{valid:t.valid&&i.valid,reason:i.reason}}return{valid:t.valid,reason:t.reason}}validateModeFeature(e,t){const i=this.performFeatureValidation(e);return i.valid?e.properties.mode!==this.mode?{valid:!1,reason:Mr}:t(e):{valid:!1,reason:i.reason}}onFinish(e,t){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,t){}onDrag(e,t){}onDragEnd(e,t){}getHexColorStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getNumericStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getStylingValue(e,t,i){return e===void 0?t:typeof e=="function"?e(i):e}}class wr extends Ee{constructor(...e){super(...e),this.type=Fe.Select}}function me(n,e){const t=h=>h*Math.PI/180,i=t(n[1]),s=t(n[0]),o=t(e[1]),r=o-i,a=t(e[0])-s,d=Math.sin(r/2)*Math.sin(r/2)+Math.cos(i)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))*6371e3/1e3}const ds=63710088e-1;function de(n){return n%360*Math.PI/180}function hs(n){return n/6371.0088}function be(n){return n%(2*Math.PI)*180/Math.PI}function ie(n,e=9){const t=Math.pow(10,e);return Math.round(n*t)/t}const Tn=57.29577951308232,Bn=.017453292519943295,wt=6378137,se=(n,e)=>({x:n===0?0:n*Bn*wt,y:e===0?0:Math.log(Math.tan(Math.PI/4+e*Bn/2))*wt}),Ie=(n,e)=>({lng:n===0?0:Tn*(n/wt),lat:e===0?0:(2*Math.atan(Math.exp(e/wt))-Math.PI/2)*Tn});function Sr(n,e,t){const i=de(n[0]),s=de(n[1]),o=de(t),r=hs(e),a=Math.asin(Math.sin(s)*Math.cos(r)+Math.cos(s)*Math.sin(r)*Math.cos(o));return[be(i+Math.atan2(Math.sin(o)*Math.sin(r)*Math.cos(s),Math.cos(r)-Math.sin(s)*Math.sin(a))),be(a)]}function Rn(n){const{center:e,radiusKilometers:t,coordinatePrecision:i}=n,s=n.steps?n.steps:64,o=[];for(let r=0;r<s;r++){const a=Sr(e,t,-360*r/s);o.push([ie(a[0],i),ie(a[1],i)])}return o.push(o[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[o]},properties:{}}}function cs(n){let e;if(n.geometry.type==="Polygon")e=n.geometry.coordinates;else{if(n.geometry.type!=="LineString")throw new Error("Self intersects only accepts Polygons and LineStrings");e=[n.geometry.coordinates]}const t=[];for(let o=0;o<e.length;o++)for(let r=0;r<e[o].length-1;r++)for(let a=0;a<e.length;a++)for(let d=0;d<e[a].length-1;d++)s(o,r,a,d);return t.length>0;function i(o){return o<0||o>1}function s(o,r,a,d){const h=e[o][r],c=e[o][r+1],u=e[a][d],p=e[a][d+1],f=function(C,E,P,S){if(ut(C,P)||ut(C,S)||ut(E,P)||ut(S,P))return null;const y=C[0],v=C[1],b=E[0],w=E[1],k=P[0],M=P[1],I=S[0],O=S[1],_=(y-b)*(M-O)-(v-w)*(k-I);return _===0?null:[((y*w-v*b)*(k-I)-(y-b)*(k*O-M*I))/_,((y*w-v*b)*(M-O)-(v-w)*(k*O-M*I))/_]}(h,c,u,p);if(f===null)return;let g,m;g=c[0]!==h[0]?(f[0]-h[0])/(c[0]-h[0]):(f[1]-h[1])/(c[1]-h[1]),m=p[0]!==u[0]?(f[0]-u[0])/(p[0]-u[0]):(f[1]-u[1])/(p[1]-u[1]),i(g)||i(m)||(f.toString(),t.push(f))}}function ut(n,e){return n[0]===e[0]&&n[1]===e[1]}function Ot(n,e){return Nn(n[0])<=e&&Nn(n[1])<=e}function Yt(n){return n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"&&n[0]!==1/0&&n[1]!==1/0&&(t=n[0])>=-180&&t<=180&&(e=n[1])>=-90&&e<=90;var e,t}function Nn(n){let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}const Ir="Feature has holes",Or="Feature has less than 4 coordinates",kr="Feature has invalid coordinates",Dr="Feature coordinates are not closed";function us(n,e){if(n.geometry.type!=="Polygon")return{valid:!1,reason:"Feature is not a Polygon"};if(n.geometry.coordinates.length!==1)return{valid:!1,reason:Ir};if(n.geometry.coordinates[0].length<4)return{valid:!1,reason:Or};for(let s=0;s<n.geometry.coordinates[0].length;s++){if(!Yt(n.geometry.coordinates[0][s]))return{valid:!1,reason:kr};if(!Ot(n.geometry.coordinates[0][s],e))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return(t=n.geometry.coordinates[0][0])[0]!==(i=n.geometry.coordinates[0][n.geometry.coordinates[0].length-1])[0]||t[1]!==i[1]?{valid:!1,reason:Dr}:{valid:!0};var t,i}function ps(n,e){const t=us(n,e);return t.valid?cs(n)?{valid:!1,reason:"Feature intersects itself"}:{valid:!0}:t}const _r={cancel:"Escape",finish:"Enter"},jr={start:"crosshair"};class ba extends Ee{constructor(e){super(e,!0),this.mode="circle",this.center=void 0,this.clickCount=0,this.currentCircleId=void 0,this.keyEvents=_r,this.cursors=jr,this.startingRadiusKilometers=1e-5,this.cursorMovedAfterInitialCursorDown=!1,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=J({},this.cursors,e.cursors)),e?.keyEvents===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=J({},this.keyEvents,e.keyEvents)),e!=null&&e.startingRadiusKilometers&&(this.startingRadiusKilometers=e.startingRadiusKilometers)}close(){if(this.currentCircleId===void 0)return;this.store.updateProperty([{id:this.currentCircleId,property:D.CURRENTLY_DRAWING,value:void 0}]);const e=this.currentCircleId;if(this.validate&&e){const t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid)return}this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))if(this.clickCount===0){this.center=[e.lng,e.lat];const t=Rn({center:this.center,radiusKilometers:this.startingRadiusKilometers,coordinatePrecision:this.coordinatePrecision}),[i]=this.store.create([{geometry:t.geometry,properties:{mode:this.mode,radiusKilometers:this.startingRadiusKilometers,[D.CURRENTLY_DRAWING]:!0}}]);this.currentCircleId=i,this.clickCount++,this.cursorMovedAfterInitialCursorDown=!1,this.setDrawing()}else this.clickCount===1&&this.center&&this.currentCircleId!==void 0&&this.cursorMovedAfterInitialCursorDown&&this.updateCircle(e),this.close()}onMouseMove(e){this.cursorMovedAfterInitialCursorDown=!0,this.updateCircle(e)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e])}catch{}}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=Le),t}validateFeature(e){return this.validateModeFeature(e,t=>ps(t,this.coordinatePrecision))}updateCircle(e){if(this.clickCount===1&&this.center&&this.currentCircleId){const t=me(this.center,[e.lng,e.lat]);let i;if(this.projection==="web-mercator"){const s=function(o,r){const a=1e3*me(o,r);if(a===0)return 1;const{x:d,y:h}=se(o[0],o[1]),{x:c,y:u}=se(r[0],r[1]);return Math.sqrt(Math.pow(c-d,2)+Math.pow(u-h,2))/a}(this.center,[e.lng,e.lat]);i=function(o){const{center:r,radiusKilometers:a,coordinatePrecision:d}=o,h=o.steps?o.steps:64,c=1e3*a,[u,p]=r,{x:f,y:g}=se(u,p),m=[];for(let C=0;C<h;C++){const E=360*C/h*Math.PI/180,P=c*Math.cos(E),S=c*Math.sin(E),[y,v]=[f+P,g+S],{lng:b,lat:w}=Ie(y,v);m.push([ie(b,d),ie(w,d)])}return m.push(m[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[m]},properties:{}}}({center:this.center,radiusKilometers:t*s,coordinatePrecision:this.coordinatePrecision})}else{if(this.projection!=="globe")throw new Error("Invalid projection");i=Rn({center:this.center,radiusKilometers:t,coordinatePrecision:this.coordinatePrecision})}if(this.validate&&!this.validate({type:"Feature",id:this.currentCircleId,geometry:i.geometry,properties:{radiusKilometers:t}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid)return;this.store.updateGeometry([{id:this.currentCircleId,geometry:i.geometry}]),this.store.updateProperty([{id:this.currentCircleId,property:"radiusKilometers",value:t}])}}afterFeatureUpdated(e){this.currentCircleId===e.id&&(this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted())}}const ge=(n,e)=>{const{x:t,y:i}=n,{x:s,y:o}=e,r=s-t,a=o-i;return Math.sqrt(a*a+r*r)};function gs(n){if(!function(t){const i=t.coordinates[0];let s=0;for(let o=0;o<i.length-1;o++){const[r,a]=i[o],[d,h]=i[o+1];s+=(d-r)*(h+a)}return s<0}(n))return{type:"Polygon",coordinates:[n.coordinates[0].reverse()]}}class ce{constructor({store:e,mode:t,project:i,unproject:s,pointerDistance:o,coordinatePrecision:r,projection:a}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=e,this.mode=t,this.project=i,this.unproject=s,this.pointerDistance=o,this.coordinatePrecision=r,this.projection=a}}function fs({unproject:n,point:e,pointerDistance:t}){const i=t/2,{x:s,y:o}=e;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[n(s-i,o-i),n(s+i,o-i),n(s+i,o+i),n(s-i,o+i),n(s-i,o-i)].map(r=>[r.lng,r.lat])]}}}class Ke extends ce{constructor(e){super(e)}create(e){const{containerX:t,containerY:i}=e;return fs({unproject:this.unproject,point:{x:t,y:i},pointerDistance:this.pointerDistance})}}class Ye extends ce{constructor(e){super(e)}measure(e,t){const{x:i,y:s}=this.project(t[0],t[1]);return ge({x:i,y:s},{x:e.containerX,y:e.containerY})}}class St extends ce{constructor(e,t,i){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=s=>this.getSnappable(s,o=>!!(o.properties&&o.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(s,o)=>this.getSnappable(s,r=>!!(r.properties&&r.properties.mode===this.mode&&r.id!==o)).coordinate,this.config=e,this.pixelDistance=t,this.clickBoundingBox=i}getSnappable(e,t){const i=this.clickBoundingBox.create(e),s=this.store.search(i,t),o={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return s.forEach(r=>{let a;if(r.geometry.type==="Polygon")a=r.geometry.coordinates[0];else{if(r.geometry.type!=="LineString")return;a=r.geometry.coordinates}a.forEach((d,h)=>{const c=this.pixelDistance.measure(e,d);c<o.minDist&&c<this.pointerDistance&&(o.coordinate=d,o.minDist=c,o.featureId=r.id,o.featureCoordinateIndex=h)})}),o}}function An(n,e,t){const i=de(n[0]),s=de(n[1]),o=de(t),r=hs(e),a=Math.asin(Math.sin(s)*Math.cos(r)+Math.cos(s)*Math.sin(r)*Math.cos(o));return[be(i+Math.atan2(Math.sin(o)*Math.sin(r)*Math.cos(s),Math.cos(r)-Math.sin(s)*Math.sin(a))),be(a)]}function Un(n,e){const t=de(n[0]),i=de(e[0]),s=de(n[1]),o=de(e[1]),r=Math.sin(i-t)*Math.cos(o),a=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(i-t);return be(Math.atan2(r,a))}function Fr({x:n,y:e},{x:t,y:i}){const s=t-n,o=i-e;if(s===0&&o===0)return 0;let r=Math.atan2(o,s);return r*=180/Math.PI,r>180?r-=360:r<-180&&(r+=360),r}function Tr(n,e,t){const i=[],s=n.length;let o,r,a,d=0;for(let c=0;c<n.length&&!(e>=d&&c===n.length-1);c++){if(d>e&&i.length===0){if(o=e-d,!o)return i.push(n[c]),i;r=Un(n[c],n[c-1])-180,a=An(n[c],o,r),i.push(a)}if(d>=t)return o=t-d,o?(r=Un(n[c],n[c-1])-180,a=An(n[c],o,r),i.push(a),i):(i.push(n[c]),i);if(d>=e&&i.push(n[c]),c===n.length-1)return i;d+=me(n[c],n[c+1])}if(d<e&&n.length===s)throw new Error("Start position is beyond line");const h=n[n.length-1];return[h,h]}function pt(n){return n*(Math.PI/180)}function Wn(n){return n*(180/Math.PI)}class Br extends ce{constructor(e){super(e),this.config=void 0,this.config=e}generateInsertionCoordinates(e,t,i){const s=[e,t];let o=0;for(let h=0;h<s.length-1;h++)o+=me(s[0],s[1]);if(o<=i)return s;let r=o/i-1;Number.isInteger(r)||(r=Math.floor(r)+1);const a=[];for(let h=0;h<r;h++){const c=Tr(s,i*h,i*(h+1));a.push(c)}const d=[];for(let h=0;h<a.length;h++)d.push(a[h][1]);return this.limitCoordinates(d)}generateInsertionGeodesicCoordinates(e,t,i){const s=me(e,t),o=function(r,a,d){const h=[],c=pt(r[1]),u=pt(r[0]),p=pt(a[1]),f=pt(a[0]);d+=1;const g=2*Math.asin(Math.sqrt(Math.sin((p-c)/2)**2+Math.cos(c)*Math.cos(p)*Math.sin((f-u)/2)**2));if(g===0||isNaN(g))return h;for(let m=0;m<=d;m++){const C=m/d,E=Math.sin((1-C)*g)/Math.sin(g),P=Math.sin(C*g)/Math.sin(g),S=E*Math.cos(c)*Math.cos(u)+P*Math.cos(p)*Math.cos(f),y=E*Math.cos(c)*Math.sin(u)+P*Math.cos(p)*Math.sin(f),v=E*Math.sin(c)+P*Math.sin(p);if(isNaN(S)||isNaN(y)||isNaN(v))continue;const b=Math.atan2(v,Math.sqrt(S**2+y**2)),w=Math.atan2(y,S);isNaN(b)||isNaN(w)||h.push([Wn(w),Wn(b)])}return h.slice(1,-1)}(e,t,Math.floor(s/i));return this.limitCoordinates(o)}limitCoordinates(e){return e.map(t=>[ie(t[0],this.config.coordinatePrecision),ie(t[1],this.config.coordinatePrecision)])}}function mt(n,e){return n[0]===e[0]&&n[1]===e[1]}function ms(n,e){if(n.geometry.type!=="LineString")return{valid:!1,reason:"Feature is not a LineString"};if(n.geometry.coordinates.length<2)return{valid:!1,reason:"Feature has less than 2 coordinates"};for(let t=0;t<n.geometry.coordinates.length;t++){if(!Yt(n.geometry.coordinates[t]))return{valid:!1,reason:"Feature has invalid coordinates"};if(!Ot(n.geometry.coordinates[t],e))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return{valid:!0}}function Gn(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2))}function xe(n,e){const t=function(i,s){const[o,r,a]=i,[d,h,c]=s;return o*d+r*h+a*c}(n,e)/(Gn(n)*Gn(e));return Math.acos(Math.min(Math.max(t,-1),1))}function Bt(n){const e=de(n[1]),t=de(n[0]);return[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}function we(n){const[e,t,i]=n,s=be(Math.asin(i));return[be(Math.atan2(t,e)),s]}function Rr(n,e,t){const i=Bt(n),s=Bt(e),o=Bt(t),[r,a,d]=o,[h,c,u]=function(O,_){const[U,T,B]=O,[G,K,z]=_;return[T*z-B*K,B*G-U*z,U*K-T*G]}(i,s),p=c*d-u*a,f=u*r-h*d,g=h*a-c*r,m=g*c-f*u,C=p*u-g*h,E=f*h-p*c,P=1/Math.sqrt(Math.pow(m,2)+Math.pow(C,2)+Math.pow(E,2)),S=[m*P,C*P,E*P],y=[-1*m*P,-1*C*P,-1*E*P],v=xe(i,s),b=xe(i,S),w=xe(s,S),k=xe(i,y),M=xe(s,y);let I;return I=b<k&&b<M||w<k&&w<M?S:y,xe(i,I)>v||xe(s,I)>v?me(we(I),we(i))<=me(we(I),we(s))?[we(i),!0,!1]:[we(s),!1,!0]:[we(I),!1,!1]}function Nr(n,e,t){const i=e.x-n.x,s=e.y-n.y,o=Math.max(0,Math.min(1,((t.x-n.x)*i+(t.y-n.y)*s)/(i*i+s*s)));return{x:n.x+o*i,y:n.y+o*s}}class Xt extends ce{constructor(e,t,i){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=s=>{const o=this.getSnappable(s,r=>!!(r.properties&&r.properties.mode===this.mode));return o.coordinate?[ie(o.coordinate[0],this.config.coordinatePrecision),ie(o.coordinate[1],this.config.coordinatePrecision)]:void 0},this.getSnappableCoordinate=(s,o)=>{const r=this.getSnappable(s,a=>!!(a.properties&&a.properties.mode===this.mode&&a.id!==o));return r.coordinate?[ie(r.coordinate[0],this.config.coordinatePrecision),ie(r.coordinate[1],this.config.coordinatePrecision)]:void 0},this.config=e,this.pixelDistance=t,this.clickBoundingBox=i}getSnappable(e,t){const i=this.clickBoundingBox.create(e),s=this.store.search(i,t),o={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return s.forEach(r=>{let a;if(r.geometry.type==="Polygon")a=r.geometry.coordinates[0];else{if(r.geometry.type!=="LineString")return;a=r.geometry.coordinates}const d=[];for(let p=0;p<a.length-1;p++)d.push([a[p],a[p+1]]);let h;const c=[e.lng,e.lat];if(this.config.projection==="web-mercator"?h=function(p,f){let g=[1/0,1/0],m=1/0,C=0;for(let E of f){const P=E[0],S=E[1];let y,v=1/0;const b=se(P[0],P[1]),w=se(S[0],S[1]),k=se(p[0],p[1]);if(P[0]===p[0]&&P[1]===p[1])y=P;else if(S[0]===p[0]&&S[1]===p[1])y=S;else{const{x:M,y:I}=Nr(b,w,k),{lng:O,lat:_}=Ie(M,I);y=[O,_]}y&&(v=ge(k,se(y[0],y[1])),v<m&&(g=y,m=v,C=f.indexOf(E)))}return m===1/0?void 0:{coordinate:g,lineIndex:C,distance:m}}(c,d):this.config.projection==="globe"&&(h=function(p,f){let g=[1/0,1/0],m=1/0,C=0;for(let E of f){const P=E[0],S=E[1];let y,v=1/0;P[0]===p[0]&&P[1]===p[1]?y=P:S[0]===p[0]&&S[1]===p[1]?y=S:[y]=Rr(P,S,p),y&&(v=me(p,y),v<m&&(g=y,m=v,C=f.indexOf(E)))}return m===1/0?void 0:{coordinate:g,distance:m,lineIndex:C}}(c,d)),!h)return;const u=this.pixelDistance.measure(e,h.coordinate);u<o.minDistance&&u<this.pointerDistance&&(o.featureId=r.id,o.coordinate=[ie(h.coordinate[0],this.config.coordinatePrecision),ie(h.coordinate[1],this.config.coordinatePrecision)],o.featureCoordinateIndex=h.lineIndex,o.minDistance=u)}),o}}const Ar={cancel:"Escape",finish:"Enter"},Ur={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class Ea extends Ee{constructor(e){super(e,!0),this.mode="linestring",this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.keyEvents=Ar,this.snapping=void 0,this.cursors=Ur,this.mouseMove=!1,this.insertCoordinates=void 0,this.lastCommittedCoordinates=void 0,this.snappedPointId=void 0,this.lastMouseMoveEvent=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinateSnapping=void 0,this.insertPoint=void 0,this.lineSnapping=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=J({},this.cursors,e.cursors)),e!=null&&e.snapping&&(this.snapping=e.snapping),e?.keyEvents===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=J({},this.keyEvents,e.keyEvents)),e!=null&&e.insertCoordinates&&(this.insertCoordinates=e.insertCoordinates),e&&e.editable&&(this.editable=e.editable)}updateSnappedCoordinate(e){const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[i]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[D.SNAPPING_POINT]:!0}}]);this.snappedPointId=i}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);return t}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId);e.coordinates.pop(),this.updateGeometries([...e.coordinates],void 0,q.Commit),this.store.updateProperty([{id:this.currentId,property:D.CURRENTLY_DRAWING,value:void 0}]);const t=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommittedCoordinates=void 0,this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}updateGeometries(e,t,i){if(!this.currentId)return;const s={type:"LineString",coordinates:e};if(this.validate&&!this.validate({type:"Feature",geometry:s},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:i}).valid)return;const o=[{id:this.currentId,geometry:s}];this.closingPointId&&t&&o.push({id:this.closingPointId,geometry:{type:"Point",coordinates:t}}),i==="commit"&&(this.lastCommittedCoordinates=s.coordinates),this.store.updateGeometry(o)}generateInsertCoordinates(e,t){if(!this.insertCoordinates||!this.lastCommittedCoordinates)throw new Error("Not able to insert coordinates");if(this.insertCoordinates.strategy!=="amount")throw new Error("Strategy does not exist");const i=me(e,t)/(this.insertCoordinates.value+1);let s=[];return this.projection==="globe"?s=this.insertPoint.generateInsertionGeodesicCoordinates(e,t,i):this.projection==="web-mercator"&&(s=this.insertPoint.generateInsertionCoordinates(e,t,i)),s}createLine(e){const[t]=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode,[D.CURRENTLY_DRAWING]:!0}}]);this.lastCommittedCoordinates=[e,e],this.currentId=t,this.currentCoordinate++,this.setDrawing()}firstUpdateToLine(e){if(!this.currentId)return;const t=this.store.getGeometryCopy(this.currentId).coordinates,[i]=this.store.create([{geometry:{type:"Point",coordinates:[...e]},properties:{mode:this.mode,[D.CLOSING_POINT]:!0}}]);this.closingPointId=i,this.setCursor(this.cursors.close);const s=[...t,e];this.updateGeometries(s,void 0,q.Commit),this.currentCoordinate++}updateToLine(e,t){if(!this.currentId)return;const i=this.store.getGeometryCopy(this.currentId).coordinates,[s,o]=this.lastCommittedCoordinates?this.lastCommittedCoordinates[this.lastCommittedCoordinates.length-1]:i[i.length-2],{x:r,y:a}=this.project(s,o);if(ge({x:r,y:a},{x:t.x,y:t.y})<this.pointerDistance)return void this.close();this.setCursor(this.cursors.close);const d=[...i,e];this.updateGeometries(d,i[i.length-1],q.Commit),this.currentCoordinate++}registerBehaviors(e){this.coordinateSnapping=new St(e,new Ye(e),new Ke(e)),this.insertPoint=new Br(e),this.clickBoundingBox=new Ke(e),this.pixelDistance=new Ye(e),this.lineSnapping=new Xt(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new St(e,this.pixelDistance,this.clickBoundingBox)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start),this.lastMouseMoveEvent=e;const t=this.updateSnappedCoordinate(e)||[e.lng,e.lat];if(this.currentId===void 0||this.currentCoordinate===0)return;const i=this.store.getGeometryCopy(this.currentId).coordinates;if(i.pop(),this.closingPointId){const[o,r]=i[i.length-1],{x:a,y:d}=this.project(o,r);ge({x:a,y:d},{x:e.containerX,y:e.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}let s=[...i,t];if(this.insertCoordinates&&this.currentId&&this.lastCommittedCoordinates){const o=this.lastCommittedCoordinates[this.lastCommittedCoordinates.length-1],r=t;if(!mt(o,r)){const a=this.generateInsertCoordinates(o,r);s=[...this.lastCommittedCoordinates.slice(0,-1),...a,t]}}this.updateGeometries(s,void 0,q.Provisional)}onRightClick(e){if(!this.editable||this.state!=="started")return;const{featureId:t,featureCoordinateIndex:i}=this.coordinateSnapping.getSnappable(e,r=>this.lineStringFilter(r));if(!t||i===void 0)return;const s=this.store.getGeometryCopy(t);let o;if(s.type==="LineString"&&(o=s.coordinates,!(o.length<=2))){if(o.splice(i,1),this.validate&&!this.validate({id:t,type:"Feature",geometry:s,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:s}]),this.onFinish(t,{mode:this.mode,action:"edit"})}}onLeftClick(e){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const t=this.snapCoordinate(e)||[e.lng,e.lat];this.currentCoordinate===0?this.createLine(t):this.currentCoordinate===1&&this.currentId?this.firstUpdateToLine(t):this.currentId&&this.updateToLine(t,{x:e.containerX,y:e.containerY})}onClick(e){(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))&&(this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button==="right"?this.onRightClick(e):e.button==="left"&&this.onLeftClick(e))}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.editable)return;let i;if(this.state==="started"){const s=this.lineSnapping.getSnappable(e,r=>this.lineStringFilter(r));s.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=s.featureCoordinateIndex,this.editedFeatureId=s.featureId,i=s.coordinate);const o=this.coordinateSnapping.getSnappable(e,r=>this.lineStringFilter(r));o.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=o.featureCoordinateIndex,this.editedFeatureId=o.featureId,i=o.coordinate)}if(this.editedFeatureId&&i){if(!this.editedPointId){const[s]=this.store.create([{geometry:{type:"Point",coordinates:i},properties:{mode:this.mode,[D.EDITED]:!0}}]);this.editedPointId=s}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const i=this.store.getGeometryCopy(this.editedFeatureId);this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?i.coordinates[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,i.coordinates.splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const s={type:"LineString",coordinates:i.coordinates};this.validate&&!this.validate({type:"Feature",geometry:s,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:s}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:D.EDITED,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:D.EDITED,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.closingPointId,i=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),i!==void 0&&this.store.delete([i]),t!==void 0&&this.store.delete([t])}catch{}}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="LineString"&&e.properties.mode===this.mode)return t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=Le,t;if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const i=e.properties[D.CLOSING_POINT];return t.pointColor=this.getHexColorStylingValue(i?this.styles.closingPointColor:this.styles.snappingPointColor,t.pointColor,e),t.pointWidth=this.getNumericStylingValue(i?this.styles.closingPointWidth:this.styles.snappingPointWidth,t.pointWidth,e),t.pointOutlineColor=this.getHexColorStylingValue(i?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e),t.pointOutlineWidth=this.getNumericStylingValue(i?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e),t.zIndex=50,t}return t}validateFeature(e){return this.validateModeFeature(e,t=>ms(t,this.coordinatePrecision))}lineStringFilter(e){return!!(e.geometry.type==="LineString"&&e.properties&&e.properties.mode===this.mode)}snapCoordinate(e){var t,i,s;let o;if((t=this.snapping)!=null&&t.toLine){let r;r=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e),r&&(o=r)}return(i=this.snapping)!=null&&i.toCoordinate&&(o=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e)),(s=this.snapping)!=null&&s.toCustom&&(o=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),o}afterFeatureUpdated(e){this.editedFeatureId===e.id&&this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0),this.snappedPointId&&this.lastMouseMoveEvent&&this.updateSnappedCoordinate(this.lastMouseMoveEvent),this.currentId===e.id&&(this.closingPointId&&(this.store.delete([this.closingPointId]),this.closingPointId=void 0),this.currentCoordinate=0,this.currentId=void 0,this.state==="drawing"&&this.setStarted())}}const Wr="Feature is not a Point",Gr="Feature has invalid coordinates",zr="Feature has coordinates with excessive precision";function Vr(n,e){return n.geometry.type!=="Point"?{valid:!1,reason:Wr}:Yt(n.geometry.coordinates)?Ot(n.geometry.coordinates,e)?{valid:!0}:{valid:!1,reason:zr}:{valid:!1,reason:Gr}}const $r={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"};class Ma extends Ee{constructor(e){super(e,!0),this.mode="point",this.cursors=$r,this.editable=!1,this.editedFeatureId=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=J({},this.cursors,e.cursors)),e!=null&&e.editable&&(this.editable=e.editable)}start(){this.setStarted(),this.setCursor(this.cursors.create)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onMouseMove(){}onKeyDown(){}onKeyUp(){}cleanUp(){this.editedFeatureId=void 0}onDragStart(e,t){if(this.allowPointerEvent(this.pointerEvents.onDragStart,e)){if(this.editable){const i=this.getNearestPointFeature(e);this.editedFeatureId=i?.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),t(!1))}}onDrag(e,t){this.allowPointerEvent(this.pointerEvents.onDrag,e)&&this.editedFeatureId!==void 0&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:D.EDITED,value:!0}])))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:D.EDITED,value:!1}]),this.editedFeatureId=void 0,t(!0))}registerBehaviors(e){this.pixelDistance=new Ye(e),this.clickBoundingBox=new Ke(e)}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const i=!!(e.id&&this.editedFeatureId===e.id);t.pointWidth=this.getNumericStylingValue(i?this.styles.editedPointWidth:this.styles.pointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(i?this.styles.editedPointColor:this.styles.pointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(i?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(i?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e),t.zIndex=30}return t}validateFeature(e){return this.validateModeFeature(e,t=>Vr(t,this.coordinatePrecision))}onLeftClick(e){const t={type:"Point",coordinates:[e.lng,e.lat]},i={mode:this.mode};if(this.validate&&!this.validate({type:"Feature",geometry:t,properties:i},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid)return;const[s]=this.store.create([{geometry:t,properties:i}]);this.onFinish(s,{mode:this.mode,action:"draw"})}onRightClick(e){if(!this.editable)return;const t=this.getNearestPointFeature(e);t&&this.store.delete([t.id])}getNearestPointFeature(e){const t=this.clickBoundingBox.create(e),i=this.store.search(t);let s,o=1/0;for(let r=0;r<i.length;r++){const a=i[r];if(a.geometry.type!=="Point"||a.properties.mode!==this.mode)continue;const d=this.pixelDistance.measure(e,a.geometry.coordinates);d>o||d>this.pointerDistance||(o=d,s=a)}return s}afterFeatureUpdated(e){this.editedFeatureId===e.id&&(this.editedFeatureId=void 0,this.setCursor(this.cursors.create))}}class Zr extends ce{constructor(e,t){super(e),this.config=void 0,this.pixelDistance=void 0,this._startEndPoints=[],this.config=e,this.pixelDistance=t}get ids(){return this._startEndPoints.concat()}set ids(e){}create(e,t){if(this.ids.length)throw new Error("Opening and closing points already created");if(e.length<=3)throw new Error("Requires at least 4 coordinates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:e[0]},properties:{mode:t,[D.CLOSING_POINT]:!0}},{geometry:{type:"Point",coordinates:e[e.length-2]},properties:{mode:t,[D.CLOSING_POINT]:!0}}])}delete(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])}update(e){if(this.ids.length!==2)throw new Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:e[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:e[e.length-3]}}])}isClosingPoint(e){const t=this.store.getGeometryCopy(this.ids[0]),i=this.store.getGeometryCopy(this.ids[1]),s=this.pixelDistance.measure(e,t.coordinates),o=this.pixelDistance.measure(e,i.coordinates);return{isClosing:s<this.pointerDistance,isPreviousClosing:o<this.pointerDistance}}}class vs extends ce{constructor(e){super(e)}createOrUpdate(e){const t=this.store.getGeometryCopy(e),i=this.store.getPropertiesCopy(e);let s;if(t.type==="Polygon")s=t.coordinates[0].slice(0,-1);else{if(t.type!=="LineString")return;s=t.coordinates}const o=this.store.getPropertiesCopy(e),r=o.coordinatePointIds;if(r)if(r&&r.every(a=>this.store.has(a))){const a=o.coordinatePointIds,d=a.map(h=>this.store.getGeometryCopy(h).coordinates);if(a.length!==s.length){this.deleteCoordinatePoints(a);const h=this.createPoints(s,i.mode,e);this.setFeatureCoordinatePoints(e,h)}else s.forEach((h,c)=>{h[0]===d[c][0]&&h[1]===d[c][1]||this.store.updateGeometry([{id:a[c],geometry:{type:"Point",coordinates:h}}])})}else{const a=r.filter(h=>this.store.has(h));a.length&&this.deleteCoordinatePoints(a);const d=this.createPoints(s,i.mode,e);this.setFeatureCoordinatePoints(e,d)}else{const a=this.createPoints(s,i.mode,e);this.setFeatureCoordinatePoints(e,a)}}deletePointsByFeatureIds(e){for(const t of e)this.deleteIfPresent(t)}getUpdated(e,t){const i=this.store.getPropertiesCopy(e);if(i.coordinatePointIds)return i.coordinatePointIds.map((s,o)=>({id:s,geometry:J({},this.store.getGeometryCopy(s),{coordinates:t[o]})}))}createPoints(e,t,i){return this.store.create(e.map((s,o)=>({geometry:{type:"Point",coordinates:s},properties:{mode:t,[D.COORDINATE_POINT]:!0,[D.COORDINATE_POINT_FEATURE_ID]:i,index:o}})))}setFeatureCoordinatePoints(e,t){this.store.updateProperty([{id:e,property:D.COORDINATE_POINT_IDS,value:t}])}deleteCoordinatePoints(e){const t=e.filter(i=>this.store.has(i));this.store.delete(t)}deleteIfPresent(e){const t=this.store.getPropertiesCopy(e).coordinatePointIds;t&&(this.deleteCoordinatePoints(t),this.setFeatureCoordinatePoints(e,null))}}const Hr={cancel:"Escape",finish:"Enter"},Kr={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class xa extends Ee{constructor(e){super(e,!0),this.mode="polygon",this.currentCoordinate=0,this.currentId=void 0,this.keyEvents=Hr,this.cursors=Kr,this.mouseMove=!1,this.showCoordinatePoints=!1,this.lastMouseMoveEvent=void 0,this.snapping=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinatePoints=void 0,this.lineSnapping=void 0,this.coordinateSnapping=void 0,this.pixelDistance=void 0,this.closingPoints=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=J({},this.cursors,e.cursors)),e?.keyEvents===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=J({},this.keyEvents,e.keyEvents)),e!=null&&e.snapping&&(this.snapping=e.snapping),e?.editable!==void 0&&(this.editable=e.editable),e?.pointerEvents!==void 0&&(this.pointerEvents=e.pointerEvents),e?.showCoordinatePoints!==void 0){if(this.showCoordinatePoints=e.showCoordinatePoints,this.coordinatePoints&&e.showCoordinatePoints===!0)this.store.copyAllWhere(t=>t.mode===this.mode).map(t=>t.id).forEach(t=>{this.coordinatePoints.createOrUpdate(t)});else if(this.coordinatePoints&&this.showCoordinatePoints===!1){const t=this.store.copyAllWhere(i=>i.mode===this.mode&&!!i[D.COORDINATE_POINT_IDS]);this.coordinatePoints.deletePointsByFeatureIds(t.map(i=>i.id))}}}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId).coordinates[0];if(e.length<5||!this.updatePolygonGeometry([...e.slice(0,-2),e[0]],q.Finish))return;const t=this.currentId;if(this.currentId){const i=gs(this.store.getGeometryCopy(this.currentId));i&&(this.store.updateGeometry([{id:this.currentId,geometry:i}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.currentId)),this.store.updateProperty([{id:this.currentId,property:D.CURRENTLY_DRAWING,value:void 0},{id:this.currentId,property:D.COMMITTED_COORDINATE_COUNT,value:void 0},{id:this.currentId,property:D.PROVISIONAL_COORDINATE_COUNT,value:void 0}])}this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.snappedPointId=void 0,this.closingPoints.delete(),this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}registerBehaviors(e){this.clickBoundingBox=new Ke(e),this.pixelDistance=new Ye(e),this.lineSnapping=new Xt(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new St(e,this.pixelDistance,this.clickBoundingBox),this.closingPoints=new Zr(e,this.pixelDistance),this.coordinatePoints=new vs(e)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}updateSnappedCoordinate(e){const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[i]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[D.SNAPPING_POINT]:!0}}]);this.snappedPointId=i}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0)}onMouseMove(e){if(this.mouseMove=!0,this.setCursor(this.cursors.start),this.lastMouseMoveEvent=e,this.updateSnappedCoordinate(e),this.currentId===void 0||this.currentCoordinate===0)return;const t=this.store.getGeometryCopy(this.currentId).coordinates[0];let i;if(this.currentCoordinate===1){const s=1/Math.pow(10,this.coordinatePrecision-1),o=Math.max(1e-6,s);i=[t[0],[e.lng,e.lat],[e.lng,e.lat-o],t[0]]}else if(this.currentCoordinate===2)i=[t[0],t[1],[e.lng,e.lat],t[0]];else{const{isClosing:s,isPreviousClosing:o}=this.closingPoints.isClosingPoint(e);o||s?(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.setCursor(this.cursors.close),i=[...t.slice(0,-2),t[0],t[0]]):i=[...t.slice(0,-2),[e.lng,e.lat],t[0]]}this.store.updateProperty([{id:this.currentId,property:D.PROVISIONAL_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.updatePolygonGeometry(i,q.Provisional)}updatePolygonGeometry(e,t){if(!this.currentId)return!1;const i={type:"Polygon",coordinates:[e]};return!(this.validate&&!this.validate({type:"Feature",geometry:i},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:i}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.currentId),0))}snapCoordinate(e){var t,i,s;let o;if((t=this.snapping)!=null&&t.toLine){let r;r=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e),r&&(o=r)}if((i=this.snapping)!=null&&i.toCoordinate){let r;r=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e),r&&(o=r)}return(s=this.snapping)!=null&&s.toCustom&&(o=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),o}polygonFilter(e){return!!(e.geometry.type==="Polygon"&&e.properties&&e.properties.mode===this.mode)}onRightClick(e){if(!this.editable||this.state!=="started")return;const{featureId:t,featureCoordinateIndex:i}=this.coordinateSnapping.getSnappable(e,r=>this.polygonFilter(r));if(!t||i===void 0)return;const s=this.store.getGeometryCopy(t);let o;s.type==="Polygon"&&(o=s.coordinates[0],o.length<=4||(s.type!=="Polygon"||i!==0&&i!==o.length-1?o.splice(i,1):(o.shift(),o.pop(),o.push([o[0][0],o[0][1]])),(!this.validate||this.validate({id:t,type:"Feature",geometry:s,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Commit}).valid)&&(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:s}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(t),this.onFinish(t,{mode:this.mode,action:"edit"}))))}onLeftClick(e){if(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.currentCoordinate===0){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const[i]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[D.CURRENTLY_DRAWING]:!0,[D.COMMITTED_COORDINATE_COUNT]:this.currentCoordinate+1,[D.PROVISIONAL_COORDINATE_COUNT]:this.currentCoordinate+1}}]);this.currentId=i,this.currentCoordinate++,this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(i),this.setDrawing()}else if(this.currentCoordinate===1&&this.currentId){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const i=this.store.getGeometryCopy(this.currentId);if(mt([e.lng,e.lat],i.coordinates[0][0])||!this.updatePolygonGeometry([i.coordinates[0][0],[e.lng,e.lat],[e.lng,e.lat],i.coordinates[0][0]],q.Commit))return;this.store.updateProperty([{id:this.currentId,property:D.COMMITTED_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.currentCoordinate++}else if(this.currentCoordinate===2&&this.currentId){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const i=this.store.getGeometryCopy(this.currentId).coordinates[0];if(mt([e.lng,e.lat],i[1])||!this.updatePolygonGeometry([i[0],i[1],[e.lng,e.lat],[e.lng,e.lat],i[0]],q.Commit))return;this.currentCoordinate===2&&this.closingPoints.create(i,"polygon"),this.store.updateProperty([{id:this.currentId,property:D.COMMITTED_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.currentCoordinate++}else if(this.currentId){const t=this.store.getGeometryCopy(this.currentId).coordinates[0],{isClosing:i,isPreviousClosing:s}=this.closingPoints.isClosingPoint(e);if(s||i)this.close();else{const o=this.snapCoordinate(e);if(o&&(e.lng=o[0],e.lat=o[1]),mt([e.lng,e.lat],t[this.currentCoordinate-1]))return;const r=function(a=[[[0,0],[0,1],[1,1],[1,0],[0,0]]]){return{type:"Feature",geometry:{type:"Polygon",coordinates:a},properties:{}}}([[...t.slice(0,-1),[e.lng,e.lat],t[0]]]);if(!this.updatePolygonGeometry(r.geometry.coordinates[0],q.Commit))return;this.store.updateProperty([{id:this.currentId,property:D.COMMITTED_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(r.geometry.coordinates[0])}}}onClick(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onKeyDown(){}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.editable)return;let i;if(this.state==="started"){const s=this.lineSnapping.getSnappable(e,r=>this.polygonFilter(r));s.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=s.featureCoordinateIndex,this.editedFeatureId=s.featureId,i=s.coordinate);const o=this.coordinateSnapping.getSnappable(e,r=>this.polygonFilter(r));o.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=o.featureCoordinateIndex,this.editedFeatureId=o.featureId,i=o.coordinate)}if(this.editedFeatureId&&i){if(!this.editedPointId){const[s]=this.store.create([{geometry:{type:"Point",coordinates:i},properties:{mode:this.mode,[D.EDITED]:!0}}]);this.editedPointId=s}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const i=this.store.getGeometryCopy(this.editedFeatureId),s=i.coordinates[0];this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?this.editedFeatureCoordinateIndex===0||this.editedFeatureCoordinateIndex===i.coordinates[0].length-1?(s[0]=[e.lng,e.lat],s[s.length-1]=[e.lng,e.lat]):s[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,i.coordinates[0].splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const o={type:"Polygon",coordinates:i.coordinates};this.validate&&!this.validate({type:"Feature",geometry:o,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:o}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.editedFeatureId),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:D.EDITED,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:D.EDITED,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.snappedPointId,i=this.editedPointId;this.currentId=void 0,this.snappedPointId=void 0,this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e&&this.coordinatePoints.deletePointsByFeatureIds([e]),e!==void 0&&this.store.delete([e]),i!==void 0&&this.store.delete([i]),t!==void 0&&this.store.delete([t]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch{}}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=Le,t;if(e.geometry.type==="Point"){const i=e.properties[D.EDITED],s=e.properties[D.COORDINATE_POINT],o=i?"editedPoint":e.properties[D.CLOSING_POINT]?"closingPoint":e.properties[D.SNAPPING_POINT]?"snappingPoint":s?"coordinatePoint":void 0;if(!o)return t;const r={editedPoint:{width:this.styles.editedPointOutlineWidth,color:this.styles.editedPointColor,outlineColor:this.styles.editedPointOutlineColor,outlineWidth:this.styles.editedPointOutlineWidth},closingPoint:{width:this.styles.closingPointWidth,color:this.styles.closingPointColor,outlineColor:this.styles.closingPointOutlineColor,outlineWidth:this.styles.closingPointOutlineWidth},snappingPoint:{width:this.styles.snappingPointWidth,color:this.styles.snappingPointColor,outlineColor:this.styles.snappingPointOutlineColor,outlineWidth:this.styles.snappingPointOutlineWidth},coordinatePoint:{width:this.styles.coordinatePointWidth,color:this.styles.coordinatePointColor,outlineColor:this.styles.coordinatePointOutlineColor,outlineWidth:this.styles.coordinatePointOutlineWidth}};return t.pointWidth=this.getNumericStylingValue(r[o].width,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(r[o].color,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(r[o].outlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(r[o].outlineWidth,2,e),t.zIndex=i?40:s?20:30,t}}return t}afterFeatureAdded(e){this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(e.id)}afterFeatureUpdated(e){this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(e.id),this.editedFeatureId===e.id&&this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0),this.snappedPointId&&this.lastMouseMoveEvent&&this.updateSnappedCoordinate(this.lastMouseMoveEvent),this.currentId===e.id&&(this.currentCoordinate=0,this.currentId=void 0,this.closingPoints.delete(),this.state==="drawing"&&this.setStarted())}validateFeature(e){return this.validateModeFeature(e,t=>us(t,this.coordinatePrecision))}}const Yr={cancel:"Escape",finish:"Enter"},Xr={start:"crosshair"};class wa extends Ee{constructor(e){super(e,!0),this.mode="rectangle",this.center=void 0,this.clickCount=0,this.currentRectangleId=void 0,this.keyEvents=Yr,this.cursors=Xr,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=J({},this.cursors,e.cursors)),e?.keyEvents===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=J({},this.keyEvents,e.keyEvents))}updateRectangle(e,t){if(this.clickCount===1&&this.center&&this.currentRectangleId){const i=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0],s={type:"Polygon",coordinates:[[i,[e.lng,i[1]],[e.lng,e.lat],[i[0],e.lat],i]]};if(this.validate&&!this.validate({id:this.currentRectangleId,geometry:s},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid)return;this.store.updateGeometry([{id:this.currentRectangleId,geometry:s}])}}close(){const e=this.currentRectangleId;if(e){const t=gs(this.store.getGeometryCopy(e));t&&this.store.updateGeometry([{id:e,geometry:t}]),this.store.updateProperty([{id:e,property:D.CURRENTLY_DRAWING,value:void 0}])}this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),e!==void 0&&this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))if(this.clickCount===0){this.center=[e.lng,e.lat];const[t]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[D.CURRENTLY_DRAWING]:!0}}]);this.currentRectangleId=t,this.clickCount++,this.setDrawing()}else this.updateRectangle(e,q.Finish),this.close()}onMouseMove(e){this.updateRectangle(e,q.Provisional)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),e!==void 0&&this.store.delete([e])}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=Le),t}validateFeature(e){return this.validateModeFeature(e,t=>ps(t,this.coordinatePrecision))}afterFeatureUpdated(e){this.currentRectangleId===e.id&&(this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted())}}function Wt(n,e){const t=n,i=e,s=de(t[1]),o=de(i[1]);let r=de(i[0]-t[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);const a=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),d=(be(Math.atan2(r,a))+360)%360;return d>180?-(360-d):d}function ys(n,e,t){let i=e;e<0&&(i=-Math.abs(i));const s=i/ds,o=n[0]*Math.PI/180,r=de(n[1]),a=de(t),d=s*Math.cos(a);let h=r+d;Math.abs(h)>Math.PI/2&&(h=h>0?Math.PI-h:-Math.PI-h);const c=Math.log(Math.tan(h/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),u=Math.abs(c)>1e-11?d/c:Math.cos(r),p=[(180*(o+s*Math.sin(a)/u)/Math.PI+540)%360-180,180*h/Math.PI];return p[0]+=p[0]-n[0]>180?-360:n[0]-p[0]>180?360:0,p}function qr(n,e,t,i,s){const o=i(n[0],n[1]),r=i(e[0],e[1]),{lng:a,lat:d}=s((o.x+r.x)/2,(o.y+r.y)/2);return[ie(a,t),ie(d,t)]}function Jr(n,e,t){const i=ys(n,1e3*me(n,e)/2,Wt(n,e));return[ie(i[0],t),ie(i[1],t)]}function zn({featureCoords:n,precision:e,unproject:t,project:i,projection:s}){const o=[];for(let r=0;r<n.length-1;r++){let a;if(s==="web-mercator")a=qr(n[r],n[r+1],e,i,t);else{if(s!=="globe")throw new Error("Invalid projection");a=Jr(n[r],n[r+1],e)}o.push(a)}return o}class Qr extends ce{constructor(e,t,i){super(e),this.config=void 0,this.selectionPointBehavior=void 0,this.coordinatePointBehavior=void 0,this._midPoints=[],this.config=e,this.selectionPointBehavior=t,this.coordinatePointBehavior=i}get ids(){return this._midPoints.concat()}set ids(e){}insert(e,t,i){const s=this.store.getGeometryCopy(t),{midPointFeatureId:o,midPointSegment:r}=this.store.getPropertiesCopy(t),a=this.store.getGeometryCopy(o),d=a.type==="Polygon"?a.coordinates[0]:a.coordinates;d.splice(r+1,0,s.coordinates),a.coordinates=a.type==="Polygon"?[d]:d,this.store.updateGeometry([{id:o,geometry:a}]),this.store.getPropertiesCopy(e)[D.COORDINATE_POINT_IDS]&&this.coordinatePointBehavior.createOrUpdate(e),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(d,o,i),this.selectionPointBehavior.create(d,a.type,o)}create(e,t,i){if(!this.store.has(t))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(s,o,r,a,d,h){return zn({featureCoords:s,precision:r,project:a,unproject:d,projection:h}).map((c,u)=>({geometry:{type:"Point",coordinates:c},properties:o(u)}))}(e,s=>({mode:this.mode,[le.MID_POINT]:!0,midPointSegment:s,midPointFeatureId:t}),i,this.config.project,this.config.unproject,this.projection))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(e){if(this._midPoints.length!==0)return zn({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((t,i)=>({id:this._midPoints[i],geometry:{type:"Point",coordinates:t}}))}}class ea extends ce{constructor(e){super(e),this._selectionPoints=[]}get ids(){return this._selectionPoints.concat()}set ids(e){}create(e,t,i){this._selectionPoints=this.store.create(function(s,o,r){const a=[],d=o==="Polygon"?s.length-1:s.length;for(let h=0;h<d;h++)a.push({geometry:{type:"Point",coordinates:s[h]},properties:r(h)});return a}(e,t,s=>({mode:this.mode,index:s,[le.SELECTION_POINT]:!0,[le.SELECTION_POINT_FEATURE_ID]:i})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(e){if(this._selectionPoints.length!==0)return this._selectionPoints.map((t,i)=>({id:t,geometry:{type:"Point",coordinates:e[i]}}))}getOneUpdated(e,t){if(this._selectionPoints[e]!==void 0)return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:t}}}}function Cs(n,e){let t=!1;for(let r=0,a=e.length;r<a;r++){const d=e[r];for(let h=0,c=d.length,u=c-1;h<c;u=h++)(s=d[h])[1]>(i=n)[1]!=(o=d[u])[1]>i[1]&&i[0]<(o[0]-s[0])*(i[1]-s[1])/(o[1]-s[1])+s[0]&&(t=!t)}var i,s,o;return t}const Gt=(n,e,t)=>{const i=o=>o*o,s=(o,r)=>i(o.x-r.x)+i(o.y-r.y);return Math.sqrt(((o,r,a)=>{const d=s(r,a);if(d===0)return s(o,r);let h=((o.x-r.x)*(a.x-r.x)+(o.y-r.y)*(a.y-r.y))/d;return h=Math.max(0,Math.min(1,h)),s(o,{x:r.x+h*(a.x-r.x),y:r.y+h*(a.y-r.y)})})(n,e,t))};class ta extends ce{constructor(e,t,i){super(e),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=e,this.createClickBoundingBox=t,this.pixelDistance=i}find(e,t){let i,s,o,r,a=1/0,d=1/0,h=1/0;const c=this.createClickBoundingBox.create(e),u=this.store.search(c);for(let p=0;p<u.length;p++){const f=u[p],g=f.geometry;if(g.type==="Point"){if(f.properties.selectionPoint||f.properties.coordinatePoint||!t&&f.properties[le.MID_POINT])continue;const m=this.pixelDistance.measure(e,g.coordinates);f.properties[le.MID_POINT]&&m<this.pointerDistance&&m<h?(h=m,o=f):!f.properties[le.MID_POINT]&&m<this.pointerDistance&&m<a&&(a=m,i=f)}else if(g.type==="LineString"){if(i)continue;for(let m=0;m<g.coordinates.length-1;m++){const C=g.coordinates[m],E=g.coordinates[m+1],P=Gt({x:e.containerX,y:e.containerY},this.project(C[0],C[1]),this.project(E[0],E[1]));P<this.pointerDistance&&P<d&&(d=P,s=f)}}else if(g.type==="Polygon"){if(i||s)continue;Cs([e.lng,e.lat],g.coordinates)&&(r=f)}}return{clickedFeature:i||s||r,clickedMidPoint:o}}}class ia extends ce{constructor(e,t,i,s,o){super(e),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=e,this.featuresAtCursorEvent=t,this.selectionPoints=i,this.midPoints=s,this.coordinatePoints=o}startDragging(e,t){this.draggedFeatureId=t,this.dragPosition=[e.lng,e.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return this.draggedFeatureId!==null}canDrag(e,t){const{clickedFeature:i}=this.featuresAtCursorEvent.find(e,!0);return!(!i||i.id!==t)}drag(e,t){if(!this.draggedFeatureId)return;const i=this.store.getGeometryCopy(this.draggedFeatureId),s=[e.lng,e.lat];if(i.type==="Polygon"||i.type==="LineString"){let o,r;if(i.type==="Polygon"?(o=i.coordinates[0],r=o.length-1):(o=i.coordinates,r=o.length),!this.dragPosition)return!1;for(let c=0;c<r;c++){const u=o[c];let p,f;if(this.config.projection==="web-mercator"){const g=se(this.dragPosition[0],this.dragPosition[1]),m=se(s[0],s[1]),C=se(u[0],u[1]),E={x:g.x-m.x,y:g.y-m.y},P=C.x-E.x,S=C.y-E.y,{lng:y,lat:v}=Ie(P,S);p=y,f=v}else{const g=[this.dragPosition[0]-s[0],this.dragPosition[1]-s[1]];p=u[0]-g[0],f=u[1]-g[1]}if(p=ie(p,this.config.coordinatePrecision),f=ie(f,this.config.coordinatePrecision),p>180||p<-180||f>90||f<-90)return!1;o[c]=[p,f]}i.type==="Polygon"&&(o[o.length-1]=[o[0][0],o[0][1]]);const a=this.selectionPoints.getUpdated(o)||[],d=this.midPoints.getUpdated(o)||[],h=this.coordinatePoints.getUpdated(this.draggedFeatureId,o)||[];if(t&&!t({type:"Feature",id:this.draggedFeatureId,geometry:i,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:i},...a,...d,...h]),this.dragPosition=[e.lng,e.lat]}else i.type==="Point"&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:s}}]),this.dragPosition=[e.lng,e.lat])}}class na extends ce{constructor(e,t,i,s,o,r,a){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.coordinateSnapping=void 0,this.lineSnapping=void 0,this.draggedCoordinate={id:null,index:-1},this.config=e,this.pixelDistance=t,this.selectionPoints=i,this.midPoints=s,this.coordinatePoints=o,this.coordinateSnapping=r,this.lineSnapping=a}getClosestCoordinate(e,t){const i={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let s;if(t.type==="LineString")s=t.coordinates;else{if(t.type!=="Polygon")return i;s=t.coordinates[0]}for(let o=0;o<s.length;o++){const r=this.pixelDistance.measure(e,s[o]);if(r<this.pointerDistance&&r<i.dist){const a=t.type==="Polygon"&&(o===s.length-1||o===0);i.dist=r,i.index=a?0:o,i.isFirstOrLastPolygonCoord=a}}return i}getDraggableIndex(e,t){const i=this.store.getGeometryCopy(t),s=this.getClosestCoordinate(e,i);return s.index===-1?-1:s.index}snapCoordinate(e,t,i){let s=[e.lng,e.lat];const o=r=>!!(r.properties&&r.properties.mode===i.properties.mode&&r.id!==this.draggedCoordinate.id);if(t!=null&&t.toLine){let r;r=this.lineSnapping.getSnappable(e,o).coordinate,r&&(s=r)}if(t.toCoordinate){let r;r=this.coordinateSnapping.getSnappable(e,o).coordinate,r&&(s=r)}if(t!=null&&t.toCustom){let r;r=t.toCustom(e,{currentCoordinate:this.draggedCoordinate.index,currentId:i.id,getCurrentGeometrySnapshot:i.id?()=>this.store.getGeometryCopy(i.id):()=>null,project:this.project,unproject:this.unproject}),r&&(s=r)}return s}drag(e,t,i,s){const o=this.draggedCoordinate.id;if(o===null)return!1;const r=this.draggedCoordinate.index,a=this.store.getGeometryCopy(o),d=this.store.getPropertiesCopy(o),h=a.type==="LineString"?a.coordinates:a.coordinates[0],c=a.type==="Polygon"&&(r===h.length-1||r===0),u={type:"Feature",id:o,geometry:a,properties:d},p=this.snapCoordinate(e,s,u);if(e.lng>180||e.lng<-180||e.lat>90||e.lat<-90)return!1;if(c){const E=h.length-1;h[0]=p,h[E]=p}else h[r]=p;const f=this.selectionPoints.getOneUpdated(r,p),g=f?[f]:[],m=this.midPoints.getUpdated(h)||[],C=this.coordinatePoints.getUpdated(o,h)||[];return!(a.type!=="Point"&&!t&&cs({geometry:a})||i&&!i(u,{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}).valid||(this.store.updateGeometry([{id:o,geometry:a},...g,...m,...C]),0))}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}}function Vn(n){let e=0,t=0,i=0;return(n.geometry.type==="Polygon"?n.geometry.coordinates[0].slice(0,-1):n.geometry.coordinates).forEach(s=>{e+=s[0],t+=s[1],i++},!0),[e/i,t/i]}const Ps=(n,e)=>{if(e===0||e===360||e===-360)return n;const t=.017453292519943295*e,i=(n.geometry.type==="Polygon"?n.geometry.coordinates[0]:n.geometry.coordinates).map(([r,a])=>se(r,a)),s=i.reduce((r,a)=>({x:r.x+a.x,y:r.y+a.y}),{x:0,y:0});s.x/=i.length,s.y/=i.length;const o=i.map(r=>({x:s.x+(r.x-s.x)*Math.cos(t)-(r.y-s.y)*Math.sin(t),y:s.y+(r.x-s.x)*Math.sin(t)+(r.y-s.y)*Math.cos(t)})).map(({x:r,y:a})=>[Ie(r,a).lng,Ie(r,a).lat]);return n.geometry.type==="Polygon"?n.geometry.coordinates[0]=o:n.geometry.coordinates=o,n};function zt(n){const e=(n.geometry.type==="Polygon"?n.geometry.coordinates[0]:n.geometry.coordinates).map(t=>{const{x:i,y:s}=se(t[0],t[1]);return[i,s]});return n.geometry.type==="Polygon"?function(t){let i=0,s=0,o=0;const r=t.length;for(let a=0;a<r-1;a++){const[d,h]=t[a],[c,u]=t[a+1],p=d*u-c*h;i+=p,s+=(d+c)*p,o+=(h+u)*p}return i/=2,s/=6*i,o/=6*i,{x:s,y:o}}(e):function(t){const i=t.length;let s=0,o=0;for(let r=0;r<i;r++){const[a,d]=t[r];s+=a,o+=d}return{x:s/i,y:o/i}}(e)}class sa extends ce{constructor(e,t,i,s){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryCentroid=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.config=e,this.selectionPoints=t,this.midPoints=i,this.coordinatePoints=s}reset(){this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.selectedGeometryCentroid=void 0}rotate(e,t,i){this.selectedGeometry||(this.selectedGeometry=this.store.getGeometryCopy(t));const s=this.selectedGeometry;if(s.type!=="Polygon"&&s.type!=="LineString")return;const o=[e.lng,e.lat];let r;const a={type:"Feature",geometry:s,properties:{}};if(this.config.projection==="web-mercator"){this.selectedGeometryWebMercatorCentroid||(this.selectedGeometryWebMercatorCentroid=zt(a));const p=se(e.lng,e.lat);if(r=Fr(this.selectedGeometryWebMercatorCentroid,p),r===0)return;if(!this.lastBearing)return void(this.lastBearing=r);Ps(a,-(this.lastBearing-r))}else{if(this.config.projection!=="globe")throw new Error("Unsupported projection");if(this.selectedGeometryCentroid||(this.selectedGeometryCentroid=Vn({geometry:s})),r=Wt(this.selectedGeometryCentroid,o),!this.lastBearing)return void(this.lastBearing=r+180);(function(p,f){if(f===0||f===360||f===-360)return p;const g=Vn(p);(p.geometry.type==="Polygon"?p.geometry.coordinates[0]:p.geometry.coordinates).forEach(m=>{const C=Wt(g,m)+f,E=function(S,y){S[0]+=S[0]-y[0]>180?-360:y[0]-S[0]>180?360:0;const v=ds,b=y[1]*Math.PI/180,w=S[1]*Math.PI/180,k=w-b;let M=Math.abs(S[0]-y[0])*Math.PI/180;M>Math.PI&&(M-=2*Math.PI);const I=Math.log(Math.tan(w/2+Math.PI/4)/Math.tan(b/2+Math.PI/4)),O=Math.abs(I)>1e-11?k/I:Math.cos(b);return Math.sqrt(k*k+O*O*M*M)*v}(g,m),P=ys(g,E,C);m[0]=P[0],m[1]=P[1]})})(a,-(this.lastBearing-(r+180)))}const d=s.type==="Polygon"?s.coordinates[0]:s.coordinates;d.forEach(p=>{p[0]=ie(p[0],this.coordinatePrecision),p[1]=ie(p[1],this.coordinatePrecision)});const h=this.midPoints.getUpdated(d)||[],c=this.selectionPoints.getUpdated(d)||[],u=this.coordinatePoints.getUpdated(t,d)||[];if(i&&!i({id:t,type:"Feature",geometry:s,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}))return!1;this.store.updateGeometry([{id:t,geometry:s},...c,...h,...u]),this.projection==="web-mercator"?this.lastBearing=r:this.projection==="globe"&&(this.lastBearing=r+180)}}class oa extends ce{constructor(e,t){super(e),this.config=void 0,this.dragCoordinateResizeBehavior=void 0,this.config=e,this.dragCoordinateResizeBehavior=t}scale(e,t,i){if(!this.dragCoordinateResizeBehavior.isDragging()){const s=this.dragCoordinateResizeBehavior.getDraggableIndex(e,t);this.dragCoordinateResizeBehavior.startDragging(t,s)}this.dragCoordinateResizeBehavior.drag(e,"center-fixed",i)}reset(){this.dragCoordinateResizeBehavior.stopDragging()}}function Ls({coordinates:n,originX:e,originY:t,xScale:i,yScale:s}){i===1&&s===1||n.forEach(o=>{const{x:r,y:a}=se(o[0],o[1]),d=e+(r-e)*i,h=t+(a-t)*s,{lng:c,lat:u}=Ie(d,h);o[0]=c,o[1]=u})}class ra extends ce{constructor(e,t,i,s,o){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=e,this.pixelDistance=t,this.selectionPoints=i,this.midPoints=s,this.coordinatePoints=o}getClosestCoordinate(e,t){const i={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let s;if(t.type==="LineString")s=t.coordinates;else{if(t.type!=="Polygon")return i;s=t.coordinates[0]}for(let o=0;o<s.length;o++){const r=this.pixelDistance.measure(e,s[o]);if(r<this.pointerDistance&&r<i.dist){const a=t.type==="Polygon"&&(o===s.length-1||o===0);i.dist=r,i.index=a?0:o,i.isFirstOrLastPolygonCoord=a}}return i}isValidDragWebMercator(e,t,i){switch(e){case 0:if(t<=0||i>=0)return!1;break;case 1:if(i>=0)return!1;break;case 2:if(t>=0||i>=0)return!1;break;case 3:if(t>=0)return!1;break;case 4:if(t>=0||i<=0)return!1;break;case 5:if(i<=0)return!1;break;case 6:if(t<=0||i<=0)return!1;break;case 7:if(t<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||this.draggedCoordinate.index===-1)return null;const e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;const t=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(t),feature:e,updatedCoords:t,selectedCoordinate:t[this.draggedCoordinate.index]}}centerWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:i,boundingBox:s,updatedCoords:o,selectedCoordinate:r}=t,a=zt(i);if(!a)return null;const d=se(r[0],r[1]),{closestBBoxIndex:h}=this.getIndexesWebMercator(s,d),c=se(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:h,updatedCoords:o,webMercatorCursor:c,webMercatorSelected:d,webMercatorOrigin:a}),o}centerFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:i,boundingBox:s,updatedCoords:o,selectedCoordinate:r}=t,a=zt(i);if(!a)return null;const d=se(r[0],r[1]),{closestBBoxIndex:h}=this.getIndexesWebMercator(s,d),c=se(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:h,updatedCoords:o,webMercatorCursor:c,webMercatorSelected:d,webMercatorOrigin:a}),o}scaleFixedWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:i,webMercatorCursor:s,updatedCoords:o}){if(!this.isValidDragWebMercator(e,t.x-s.x,t.y-s.y))return null;let r=ge(t,s)/ge(t,i);return r<0&&(r=this.minimumScale),Ls({coordinates:o,originX:t.x,originY:t.y,xScale:r,yScale:r}),o}oppositeFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:i,updatedCoords:s,selectedCoordinate:o}=t,r=se(o[0],o[1]),{oppositeBboxIndex:a,closestBBoxIndex:d}=this.getIndexesWebMercator(i,r),h={x:i[a][0],y:i[a][1]},c=se(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:d,updatedCoords:s,webMercatorCursor:c,webMercatorSelected:r,webMercatorOrigin:h}),s}oppositeWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:i,updatedCoords:s,selectedCoordinate:o}=t,r=se(o[0],o[1]),{oppositeBboxIndex:a,closestBBoxIndex:d}=this.getIndexesWebMercator(i,r),h={x:i[a][0],y:i[a][1]},c=se(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:d,updatedCoords:s,webMercatorCursor:c,webMercatorSelected:r,webMercatorOrigin:h}),s}scaleWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:i,webMercatorCursor:s,updatedCoords:o}){const r=t.x-s.x,a=t.y-s.y;if(!this.isValidDragWebMercator(e,r,a))return null;let d=1;r!==0&&e!==1&&e!==5&&(d=1-(t.x-i.x-r)/r);let h=1;return a!==0&&e!==3&&e!==7&&(h=1-(t.y-i.y-a)/a),this.validateScale(d,h)?(d<0&&(d=this.minimumScale),h<0&&(h=this.minimumScale),this.performWebMercatorScale(o,t.x,t.y,d,h),o):null}getFeature(e){if(this.draggedCoordinate.id===null)return null;const t=this.store.getGeometryCopy(e);return t.type!=="Polygon"&&t.type!=="LineString"?null:{id:e,type:"Feature",geometry:t,properties:{}}}getNormalisedCoordinates(e){return e.type==="Polygon"?e.coordinates[0]:e.coordinates}validateScale(e,t){const i=!isNaN(e)&&t<Number.MAX_SAFE_INTEGER,s=!isNaN(t)&&t<Number.MAX_SAFE_INTEGER;return i&&s}performWebMercatorScale(e,t,i,s,o){e.forEach(r=>{const{x:a,y:d}=se(r[0],r[1]),h=t+(a-t)*s,c=i+(d-i)*o,{lng:u,lat:p}=Ie(h,c);r[0]=u,r[1]=p})}getBBoxWebMercator(e){const t=[1/0,1/0,-1/0,-1/0];(e=e.map(a=>{const{x:d,y:h}=se(a[0],a[1]);return[d,h]})).forEach(([a,d])=>{a<t[0]&&(t[0]=a),d<t[1]&&(t[1]=d),a>t[2]&&(t[2]=a),d>t[3]&&(t[3]=d)});const[i,s,o,r]=t;return[[i,r],[(i+o)/2,r],[o,r],[o,r+(s-r)/2],[o,s],[(i+o)/2,s],[i,s],[i,r+(s-r)/2]]}getIndexesWebMercator(e,t){let i,s=1/0;for(let o=0;o<e.length;o++){const r=ge({x:t.x,y:t.y},{x:e[o][0],y:e[o][1]});r<s&&(i=o,s=r)}if(i===void 0)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[i],closestBBoxIndex:i}}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(e,t){const i=this.store.getGeometryCopy(t),s=this.getClosestCoordinate(e,i);return s.index===-1?-1:s.index}drag(e,t,i){if(!this.draggedCoordinate.id)return!1;const s=this.getFeature(this.draggedCoordinate.id);if(!s)return!1;let o=null;if(t==="center"?o=this.centerWebMercatorDrag(e):t==="opposite"?o=this.oppositeWebMercatorDrag(e):t==="center-fixed"?o=this.centerFixedWebMercatorDrag(e):t==="opposite-fixed"&&(o=this.oppositeFixedWebMercatorDrag(e)),!o)return!1;for(let c=0;c<o.length;c++){const u=o[c];if(u[0]=ie(u[0],this.coordinatePrecision),u[1]=ie(u[1],this.coordinatePrecision),!Ot(u,this.coordinatePrecision))return!1}const r=this.midPoints.getUpdated(o)||[],a=this.selectionPoints.getUpdated(o)||[],d=this.coordinatePoints.getUpdated(s.id,o)||[],h={type:s.geometry.type,coordinates:s.geometry.type==="Polygon"?[o]:o};return!(i&&!i({id:this.draggedCoordinate.id,type:"Feature",geometry:h,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:h},...a,...r,...d]),0))}}const aa={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},$n={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};class Sa extends wr{constructor(e){super(e,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=aa,this.cursors=$n,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.coordinateSnap=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.coordinatePoints=void 0,this.lineSnap=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),this.cursors=e&&e.cursors?J({},this.cursors,e.cursors):$n,e?.keyEvents===null?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:e!=null&&e.keyEvents&&(this.keyEvents=J({},this.keyEvents,e.keyEvents)),e?.dragEventThrottle!==void 0&&(this.dragEventThrottle=e.dragEventThrottle),e?.allowManualDeselection!==void 0&&(this.allowManualDeselection=e.allowManualDeselection),e!=null&&e.flags){this.flags=J({},this.flags,e.flags),this.validations={};for(const t in this.flags){const i=this.flags[t].feature;i&&i.validation&&(this.validations[t]=i.validation)}}}selectFeature(e){this.select(e,!1)}setSelecting(){if(this._state!=="started")throw new Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(e){this.pixelDistance=new Ye(e),this.clickBoundingBox=new Ke(e),this.featuresAtMouseEvent=new ta(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new ea(e),this.coordinatePoints=new vs(e),this.midPoints=new Qr(e,this.selectionPoints,this.coordinatePoints),this.coordinateSnap=new St(e,this.pixelDistance,this.clickBoundingBox),this.lineSnap=new Xt(e,this.pixelDistance,this.clickBoundingBox),this.rotateFeature=new sa(e,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragFeature=new ia(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragCoordinate=new na(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints,this.coordinateSnap,this.lineSnap),this.dragCoordinateResizeFeature=new ra(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints),this.scaleFeature=new oa(e,this.dragCoordinateResizeFeature)}deselectFeature(){this.deselect()}deselect(){const e=this.selected.filter(t=>this.store.has(t)).map(t=>({id:t,property:le.SELECTED,value:!1}));this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(e){if(!this.selectionPoints.ids.length)return;let t,i=1/0;if(this.selectionPoints.ids.forEach(p=>{const f=this.store.getGeometryCopy(p),g=this.pixelDistance.measure(e,f.coordinates);g<this.pointerDistance&&g<i&&(i=g,t=this.store.getPropertiesCopy(p))}),!t)return;const s=t.selectionPointFeatureId,o=t.index,r=this.store.getPropertiesCopy(s),a=this.flags[r.mode],d=this.validations[r.mode];if(!(a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.deletable))return;const h=this.store.getGeometryCopy(s);let c;if(h.type==="Polygon"){if(c=h.coordinates[0],c.length<=4)return}else if(h.type==="LineString"&&(c=h.coordinates,c.length<=2))return;if(!c||(h.type!=="Polygon"||o!==0&&o!==c.length-1?c.splice(o,1):(c.shift(),c.pop(),c.push([c[0][0],c[0][1]])),d&&!d({id:s,type:"Feature",geometry:h,properties:r},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Commit}).valid))return;const u=[...this.midPoints.ids,...this.selectionPoints.ids];this.store.delete(u),this.store.updateGeometry([{id:s,geometry:h}]),r.coordinatePointIds&&this.coordinatePoints.createOrUpdate(s),this.selectionPoints.create(c,h.type,s),a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.midpoints&&this.midPoints.create(c,s,this.coordinatePrecision)}select(e,t=!0){if(this.selected[0]===e)return;const{mode:i}=this.store.getPropertiesCopy(e),s=this.flags[i];if(!s||!s.feature)return;const o=this.selected[0];if(o){if(o===e)return;this.deselect()}t&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:le.SELECTED,value:!0}]),this.onSelect(e);const{type:r,coordinates:a}=this.store.getGeometryCopy(e);if(r!=="LineString"&&r!=="Polygon")return;const d=r==="LineString"?a:a[0];d&&s&&s.feature.coordinates&&(this.selectionPoints.create(d,r,e),s.feature.coordinates.midpoints&&this.midPoints.create(d,e,this.coordinatePrecision))}onLeftClick(e){const{clickedFeature:t,clickedMidPoint:i}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&i)this.midPoints.insert(this.selected[0],i.id,this.coordinatePrecision);else if(t&&t.id)this.select(t.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(e){e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}canScale(e){return this.keyEvents.scale&&this.keyEvents.scale.every(t=>e.heldKeys.includes(t))}canRotate(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every(t=>e.heldKeys.includes(t))}preventDefaultKeyEvent(e){const t=this.canRotate(e),i=this.canScale(e);(t||i)&&e.preventDefault()}onKeyDown(e){this.preventDefaultKeyEvent(e)}onKeyUp(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;const t=this.selected[0];this.onDeselect(this.selected[0]),this.coordinatePoints.deletePointsByFeatureIds([t]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.selected.length)return;const i=this.store.getPropertiesCopy(this.selected[0]),s=this.flags[i.mode];if(!(s&&s.feature&&(s.feature.draggable||s.feature.coordinates&&s.feature.coordinates.draggable||s.feature.coordinates&&s.feature.coordinates.resizable||s.feature.coordinates&&typeof s.feature.coordinates.midpoints=="object"&&s.feature.coordinates.midpoints.draggable)))return;this.dragEventCount=0;const o=this.selected[0],r=this.dragCoordinate.getDraggableIndex(e,o);if(s&&s.feature&&s.feature.coordinates&&(s.feature.coordinates.draggable||s.feature.coordinates.resizable)&&r!==-1)return this.setCursor(this.cursors.dragStart),s.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(o,r):this.dragCoordinate.startDragging(o,r),void t(!1);if(s&&s.feature&&s.feature.coordinates&&typeof s.feature.coordinates.midpoints=="object"&&s.feature.coordinates.midpoints.draggable){const{clickedMidPoint:a}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&a){this.midPoints.insert(o,a.id,this.coordinatePrecision);const d=this.dragCoordinate.getDraggableIndex(e,o);return this.dragCoordinate.startDragging(o,d),void t(!1)}}return s&&s.feature&&s.feature.draggable&&this.dragFeature.canDrag(e,o)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,o),void t(!1)):void 0}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e))return;const i=this.selected[0];if(!i)return;const s=this.store.getPropertiesCopy(i),o=this.flags[s.mode],r=(o&&o.feature&&o.feature.selfIntersectable)===!0;if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;const a=this.validations[s.mode];if(o&&o.feature&&o.feature.rotateable&&this.canRotate(e))return t(!1),void this.rotateFeature.rotate(e,i,a);if(o&&o.feature&&o.feature.scaleable&&this.canScale(e))return t(!1),void this.scaleFeature.scale(e,i,a);if(this.dragCoordinateResizeFeature.isDragging()&&o.feature&&o.feature.coordinates&&o.feature.coordinates.resizable){if(this.projection==="globe")throw new Error("Globe is currently unsupported projection for resizable");return t(!1),void this.dragCoordinateResizeFeature.drag(e,o.feature.coordinates.resizable,a)}if(this.dragCoordinate.isDragging()){var d;const h=(d=o.feature)==null||(d=d.coordinates)==null?void 0:d.snappable;let c={toCoordinate:!1};return h===!0?c={toCoordinate:!0}:typeof h=="object"&&(c=h),void this.dragCoordinate.drag(e,r,a,c)}this.dragFeature.isDragging()?this.dragFeature.drag(e,a):t(!0)}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&(this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),t(!0))}onMouseMove(e){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let t=!1;this.midPoints.ids.forEach(o=>{if(t)return;const r=this.store.getGeometryCopy(o);this.pixelDistance.measure(e,r.coordinates)<this.pointerDistance&&(t=!0)});let i=!1;if(this.selectionPoints.ids.forEach(o=>{const r=this.store.getGeometryCopy(o);this.pixelDistance.measure(e,r.coordinates)<this.pointerDistance&&(t=!1,i=!0)}),t)return void this.setCursor(this.cursors.insertMidpoint);const{clickedFeature:s}=this.featuresAtMouseEvent.find(e,!0);this.setCursor(this.selected.length>0&&(s&&s.id===this.selected[0]||i)?this.cursors.pointerOver:"unset")}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode&&e.geometry.type==="Point"){if(e.properties.selectionPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,t.pointWidth,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),t.zIndex=30,t;if(e.properties.midPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),t.zIndex=50,t}else if(e.properties[le.SELECTED]){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,t.polygonFillColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,t.polygonOutlineWidth,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,t.polygonOutlineColor,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,t.polygonFillOpacity,e),t.zIndex=Le,t;if(e.geometry.type==="LineString")return t.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,t.lineStringWidth,e),t.zIndex=Le,t;if(e.geometry.type==="Point")return t.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,t.pointOutlineWidth,e),t.zIndex=Le,t}return t}afterFeatureUpdated(e){if(this.selected.length&&e.id===this.selected[0]){var t,i;const s=this.flags[e.properties.mode];if(s==null||(t=s.feature)==null||!t.coordinates)return;const o=e.geometry.type,r=e.id;let a;if(this.selectionPoints.delete(),this.midPoints.delete(),o==="Polygon")a=e.geometry.coordinates[0];else{if(o!=="LineString")return;a=e.geometry.coordinates}this.selectionPoints.create(a,o,r),s!=null&&(i=s.feature)!=null&&(i=i.coordinates)!=null&&i.midpoints&&this.midPoints.create(o==="Polygon"?e.geometry.coordinates[0]:e.geometry.coordinates,r,this.coordinatePrecision)}}}class la extends Ee{constructor(...e){super(...e),this.type=Fe.Static,this.mode="static"}start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}}function bs(n,e,t,i,s){for(;i>t;){if(i-t>600){const d=i-t+1,h=e-t+1,c=Math.log(d),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(d-u)/d)*(h-d/2<0?-1:1);bs(n,e,Math.max(t,Math.floor(e-h*u/d+p)),Math.min(i,Math.floor(e+(d-h)*u/d+p)),s)}const o=n[e];let r=t,a=i;for(Ge(n,t,e),s(n[i],o)>0&&Ge(n,t,i);r<a;){for(Ge(n,r,a),r++,a--;s(n[r],o)<0;)r++;for(;s(n[a],o)>0;)a--}s(n[t],o)===0?Ge(n,t,a):(a++,Ge(n,a,i)),a<=e&&(t=a+1),e<=a&&(i=a-1)}}function Ge(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}function Oe(n,e){ze(n,0,n.children.length,e,n)}function ze(n,e,t,i,s){s||(s=De([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let o=e;o<t;o++){const r=n.children[o];Ve(s,n.leaf?i(r):r)}return s}function Ve(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function da(n,e){return n.minX-e.minX}function ha(n,e){return n.minY-e.minY}function Rt(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function gt(n){return n.maxX-n.minX+(n.maxY-n.minY)}function ca(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),s=Math.min(n.maxX,e.maxX),o=Math.min(n.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,o-i)}function Nt(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function ft(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function De(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Zn(n,e,t,i,s){const o=[e,t];for(;o.length;){if((t=o.pop())-(e=o.pop())<=i)continue;const r=e+Math.ceil((t-e)/i/2)*i;bs(n,r,e,t,s),o.push(e,r,r,t)}}class ua{constructor(e){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}search(e){let t=this.data;const i=[];if(!ft(e,t))return i;const s=this.toBBox,o=[];for(;t;){for(let r=0;r<t.children.length;r++){const a=t.children[r],d=t.leaf?s(a):a;ft(e,d)&&(t.leaf?i.push(a):Nt(e,d)?this._all(a,i):o.push(a))}t=o.pop()}return i}collides(e){let t=this.data;if(ft(e,t)){const i=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],r=t.leaf?this.toBBox(o):o;if(ft(e,r)){if(t.leaf||Nt(e,r))return!0;i.push(o)}}t=i.pop()}}return!1}load(e){if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t}insert(e){this._insert(e,this.data.height-1)}clear(){this.data=De([])}remove(e){let t=this.data;const i=this.toBBox(e),s=[],o=[];let r,a,d=!1;for(;t||s.length;){if(t||(t=s.pop(),a=s[s.length-1],r=o.pop(),d=!0),t.leaf){const h=t.children.indexOf(e);h!==-1&&(t.children.splice(h,1),s.push(t),this._condense(s))}d||t.leaf||!Nt(t,i)?a?(r++,t=a.children[r],d=!1):t=null:(s.push(t),o.push(r),r=0,a=t,t=t.children[0])}}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,s){const o=i-t+1;let r,a=this._maxEntries;if(o<=a)return r=De(e.slice(t,i+1)),Oe(r,this.toBBox),r;s||(s=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,s-1))),r=De([]),r.leaf=!1,r.height=s;const d=Math.ceil(o/a),h=d*Math.ceil(Math.sqrt(a));Zn(e,t,i,h,this.compareMinX);for(let c=t;c<=i;c+=h){const u=Math.min(c+h-1,i);Zn(e,c,u,d,this.compareMinY);for(let p=c;p<=u;p+=d){const f=Math.min(p+d-1,u);r.children.push(this._build(e,p,f,s-1))}}return Oe(r,this.toBBox),r}_chooseSubtree(e,t,i,s){for(;s.push(t),!t.leaf&&s.length-1!==i;){let a,d=1/0,h=1/0;for(let c=0;c<t.children.length;c++){const u=t.children[c],p=Rt(u),f=(o=e,r=u,(Math.max(r.maxX,o.maxX)-Math.min(r.minX,o.minX))*(Math.max(r.maxY,o.maxY)-Math.min(r.minY,o.minY))-p);f<h?(h=f,d=p<d?p:d,a=u):f===h&&p<d&&(d=p,a=u)}t=a||t.children[0]}var o,r;return t}_insert(e,t,i){const s=i?e:this.toBBox(e),o=[],r=this._chooseSubtree(s,this.data,t,o);for(r.children.push(e),Ve(r,s);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(s,o,t)}_split(e,t){const i=e[t],s=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,s);const r=this._chooseSplitIndex(i,o,s),a=De(i.children.splice(r,i.children.length-r));a.height=i.height,a.leaf=i.leaf,Oe(i,this.toBBox),Oe(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=De([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Oe(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let s,o=1/0,r=1/0;for(let a=t;a<=i-t;a++){const d=ze(e,0,a,this.toBBox),h=ze(e,a,i,this.toBBox),c=ca(d,h),u=Rt(d)+Rt(h);c<o?(o=c,s=a,r=u<r?u:r):c===o&&u<r&&(r=u,s=a)}return s||i-t}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:da,o=e.leaf?this.compareMinY:ha;this._allDistMargin(e,t,i,s)<this._allDistMargin(e,t,i,o)&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const o=this.toBBox,r=ze(e,0,t,o),a=ze(e,i-t,i,o);let d=gt(r)+gt(a);for(let h=t;h<i-t;h++){const c=e.children[h];Ve(r,e.leaf?o(c):c),d+=gt(r)}for(let h=i-t-1;h>=t;h--){const c=e.children[h];Ve(a,e.leaf?o(c):c),d+=gt(a)}return d}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)Ve(t[s],e)}_condense(e){for(let t,i=e.length-1;i>=0;i--)e[i].children.length===0?i>0?(t=e[i-1].children,t.splice(t.indexOf(e[i]),1)):this.clear():Oe(e[i],this.toBBox)}}class pa{constructor(e){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new ua(e&&e.maxEntries?e.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}setMaps(e,t){this.idToNode.set(e.id,t),this.nodeToId.set(t,e.id)}toBBox(e){const t=[],i=[];let s;if(e.geometry.type==="Polygon")s=e.geometry.coordinates[0];else if(e.geometry.type==="LineString")s=e.geometry.coordinates;else{if(e.geometry.type!=="Point")throw new Error("Not a valid feature to turn into a bounding box");s=[e.geometry.coordinates]}for(let a=0;a<s.length;a++)i.push(s[a][1]),t.push(s[a][0]);const o=Math.min(...i),r=Math.max(...i);return{minX:Math.min(...t),minY:o,maxX:Math.max(...t),maxY:r}}insert(e){if(this.idToNode.get(String(e.id)))throw new Error("Feature already exists");const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}load(e){const t=[],i=new Set;e.forEach(s=>{const o=this.toBBox(s);if(this.setMaps(s,o),i.has(String(s.id)))throw new Error(`Duplicate feature ID found ${s.id}`);i.add(String(s.id)),t.push(o)}),this.tree.load(t)}update(e){this.remove(e.id);const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}remove(e){const t=this.idToNode.get(e);if(!t)throw new Error(`${e} not inserted into the spatial index`);this.tree.remove(t)}clear(){this.tree.clear()}search(e){return this.tree.search(this.toBBox(e)).map(t=>this.nodeToId.get(t))}collides(e){return this.tree.collides(this.toBBox(e))}}const ga={getId:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=16*Math.random()|0;return(n=="x"?e:3&e|8).toString(16)}),isValidId:n=>typeof n=="string"&&n.length===36};class fa{constructor(e){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new pa,this.tracked=!e||e.tracked!==!1,this.idStrategy=e&&e.idStrategy?e.idStrategy:ga}clone(e){return JSON.parse(JSON.stringify(e))}getId(){return this.idStrategy.getId()}has(e){return!!this.store[e]}load(e,t,i,s){if(e.length===0)return[];let o=this.clone(e);const r=[],a=[];o=o.filter(h=>{h.id==null&&(h.id=this.idStrategy.getId());const c=h.id;if(t){const u=t(h);if(!u.valid)return r.push({id:c,valid:!1,reason:u.reason}),!1}if(this.tracked){if(h.properties.createdAt){if(!Fn(h.properties.createdAt))return r.push({id:h.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else h.properties.createdAt=+new Date;if(h.properties.updatedAt){if(!Fn(h.properties.updatedAt))return r.push({id:h.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else h.properties.updatedAt=+new Date}return this.has(c)?(r.push({id:c,valid:!1,reason:`Feature already exists with this id: ${c}`}),!1):(this.store[c]=h,a.push(h),r.push({id:c,valid:!0}),!0)}),this.spatialIndex.load(o);const d=a.map(({id:h})=>h);return d.length>0&&(this._onChange(d,"create",s),i&&a.forEach(h=>{i(h)})),r}search(e,t){const i=this.spatialIndex.search(e).map(s=>this.store[s]);return this.clone(t?i.filter(t):i)}registerOnChange(e){this._onChange=(t,i,s)=>{e(t,i,s)}}getGeometryCopy(e){const t=this.store[e];if(!t)throw new Error(`No feature with this id (${e}), can not get geometry copy`);return this.clone(t.geometry)}getPropertiesCopy(e){const t=this.store[e];if(!t)throw new Error(`No feature with this id (${e}), can not get properties copy`);return this.clone(t.properties)}updateProperty(e,t){const i=[];e.forEach(({id:s,property:o,value:r})=>{const a=this.store[s];if(!a)throw new Error(`No feature with this (${s}), can not update geometry`);i.push(s),r===void 0?delete a.properties[o]:a.properties[o]=r,this.tracked&&(a.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update",t)}updateGeometry(e,t){const i=[];e.forEach(({id:s,geometry:o})=>{i.push(s);const r=this.store[s];if(!r)throw new Error(`No feature with this (${s}), can not update geometry`);r.geometry=this.clone(o),this.spatialIndex.update(r),this.tracked&&(r.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update",t)}create(e,t){const i=[];return e.forEach(({geometry:s,properties:o})=>{let r,a=J({},o);this.tracked&&(r=+new Date,o?(a.createdAt=typeof o.createdAt=="number"?o.createdAt:r,a.updatedAt=typeof o.updatedAt=="number"?o.updatedAt:r):a={createdAt:r,updatedAt:r});const d=this.getId(),h={id:d,type:"Feature",geometry:s,properties:a};this.store[d]=h,this.spatialIndex.insert(h),i.push(d)}),this._onChange&&this._onChange([...i],"create",t),i}delete(e,t){e.forEach(i=>{if(!this.store[i])throw new Error(`No feature with id ${i}, can not delete`);delete this.store[i],this.spatialIndex.remove(i)}),this._onChange&&this._onChange([...e],"delete",t)}copy(e){return this.clone(this.store[e])}copyAll(){return this.clone(Object.keys(this.store).map(e=>this.store[e]))}copyAllWhere(e){return this.clone(Object.keys(this.store).map(t=>this.store[t]).filter(t=>t.properties&&e(t.properties)))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}}class ke{constructor({name:e,callback:t,unregister:i,register:s}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=e,this.register=()=>{this.registered||(this.registered=!0,s(t))},this.unregister=()=>{this.register&&(this.registered=!1,i(t))},this.callback=t}}var ma={__proto__:null,TerraDrawBaseAdapter:class{constructor(n){this._nextKeyUpIsContextMenu=!1,this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance=typeof n.minPixelDragDistance=="number"?n.minPixelDragDistance:1,this._minPixelDragDistanceSelecting=typeof n.minPixelDragDistanceSelecting=="number"?n.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing=typeof n.minPixelDragDistanceDrawing=="number"?n.minPixelDragDistanceDrawing:8,this._coordinatePrecision=typeof n.coordinatePrecision=="number"?n.coordinatePrecision:9}getButton(n){return n.button===-1?"neither":n.button===0?"left":n.button===1?"middle":n.button===2?"right":"neither"}getMapElementXYPosition(n){const e=this.getMapEventElement(),{left:t,top:i}=e.getBoundingClientRect();return{containerX:n.clientX-t,containerY:n.clientY-i}}getDrawEventFromEvent(n,e=!1){const t=this.getLngLatFromEvent(n);if(!t)return null;const{lng:i,lat:s}=t,{containerX:o,containerY:r}=this.getMapElementXYPosition(n),a=this.getButton(n),d=Array.from(this._heldKeys);return{lng:ie(i,this._coordinatePrecision),lat:ie(s,this._coordinatePrecision),containerX:o,containerY:r,button:a,heldKeys:d,isContextMenu:e}}register(n){this._currentModeCallbacks=n,this._listeners=this.getAdapterListeners(),this._listeners.forEach(e=>{e.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new ke({name:"pointerdown",callback:n=>{if(!this._currentModeCallbacks||!n.isPrimary)return;const e=this.getDrawEventFromEvent(n);e&&(this._dragState="pre-dragging",this._lastDrawEvent=e)},register:n=>{this.getMapEventElement().addEventListener("pointerdown",n)},unregister:n=>{this.getMapEventElement().removeEventListener("pointerdown",n)}}),new ke({name:"pointermove",callback:n=>{if(!this._currentModeCallbacks||!n.isPrimary)return;n.preventDefault();const e=this.getDrawEventFromEvent(n);if(e)if(this._dragState==="not-dragging")this._currentModeCallbacks.onMouseMove(e),this._lastDrawEvent=e;else if(this._dragState==="pre-dragging"){if(!this._lastDrawEvent)return;const t={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},i={x:e.containerX,y:e.containerY},s=this._currentModeCallbacks.getState(),o=ge(t,i);let r=!1;if(r=s==="drawing"?o<this._minPixelDragDistanceDrawing:s==="selecting"?o<this._minPixelDragDistanceSelecting:o<this._minPixelDragDistance,r)return;this._nextKeyUpIsContextMenu=!1,this._dragState="dragging",this._currentModeCallbacks.onDragStart(e,a=>{this.setDraggability.bind(this)(a)})}else this._dragState==="dragging"&&this._currentModeCallbacks.onDrag(e,t=>{this.setDraggability.bind(this)(t)})},register:n=>{this.getMapEventElement().addEventListener("pointermove",n)},unregister:n=>{this.getMapEventElement().removeEventListener("pointermove",n)}}),new ke({name:"contextmenu",callback:n=>{this._currentModeCallbacks&&(n.preventDefault(),this._nextKeyUpIsContextMenu=!0)},register:n=>{this.getMapEventElement().addEventListener("contextmenu",n)},unregister:n=>{this.getMapEventElement().removeEventListener("contextmenu",n)}}),new ke({name:"pointerup",callback:n=>{if(!this._currentModeCallbacks||n.target!==this.getMapEventElement()||!n.isPrimary)return;const e=this.getDrawEventFromEvent(n);e&&(this._dragState==="dragging"?this._currentModeCallbacks.onDragEnd(e,t=>{this.setDraggability.bind(this)(t)}):this._dragState!=="not-dragging"&&this._dragState!=="pre-dragging"||(this._nextKeyUpIsContextMenu&&(e.isContextMenu=!0,this._nextKeyUpIsContextMenu=!1),this._currentModeCallbacks.onClick(e)),this._dragState="not-dragging",this.setDraggability(!0))},register:n=>{this.getMapEventElement().addEventListener("pointerup",n)},unregister:n=>{this.getMapEventElement().removeEventListener("pointerup",n)}}),new ke({name:"keyup",callback:n=>{this._currentModeCallbacks&&(this._heldKeys.delete(n.key),this._currentModeCallbacks.onKeyUp({key:n.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>n.preventDefault()}))},register:n=>{this.getMapEventElement().addEventListener("keyup",n)},unregister:n=>{this.getMapEventElement().removeEventListener("keyup",n)}}),new ke({name:"keydown",callback:n=>{this._currentModeCallbacks&&(this._heldKeys.add(n.key),this._currentModeCallbacks.onKeyDown({key:n.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>n.preventDefault()}))},register:n=>{this.getMapEventElement().addEventListener("keydown",n)},unregister:n=>{this.getMapEventElement().removeEventListener("keydown",n)}})]}unregister(){this._listeners.forEach(n=>{n.unregister()}),this.clear(),this._currentModeCallbacks=void 0}}};const va={cancel:"Escape",finish:"Enter"},ya={start:"crosshair",close:"pointer"};class Ia extends Ee{constructor(e){super(e,!0),this.mode="freehand-linestring",this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.minDistance=20,this.keyEvents=va,this.cursors=ya,this.preventNewFeature=!1,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.minDistance&&(this.minDistance=e.minDistance),e?.keyEvents===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=J({},this.keyEvents,e.keyEvents)),e!=null&&e.cursors&&(this.cursors=J({},this.cursors,e.cursors))}close(){if(this.currentId===void 0)return;this.currentId&&this.store.updateProperty([{id:this.currentId,property:D.CURRENTLY_DRAWING,value:void 0}]);const e=this.currentId;if(this.validate&&e){const t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid)return}this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.state==="drawing"&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){if(this.currentId===void 0||this.startingClick===!1)return void this.setCursor(this.cursors.start);const t=this.store.getGeometryCopy(this.currentId),i=t.coordinates.length-2,[s,o]=t.coordinates[i],{x:r,y:a}=this.project(s,o),d=ge({x:r,y:a},{x:e.containerX,y:e.containerY}),[h,c]=t.coordinates[t.coordinates.length-1],{x:u,y:p}=this.project(h,c),f=ge({x:u,y:p},{x:e.containerX,y:e.containerY});if(this.setCursor(f<this.pointerDistance?this.cursors.close:this.cursors.start),d<this.minDistance)return;const g={type:"LineString",coordinates:[...t.coordinates,[e.lng,e.lat]]};this.validate&&!this.validate({type:"Feature",id:this.currentId,geometry:g,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:g}]),this.closingPointId&&this.store.updateGeometry([{id:this.closingPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]))}onClick(e){if(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)){if(this.preventNewFeature)return;if(this.startingClick===!1){const[t,i]=this.store.create([{geometry:{type:"LineString",coordinates:[[e.lng,e.lat],[e.lng,e.lat]]},properties:{mode:this.mode,[D.CURRENTLY_DRAWING]:!0}},{geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:{mode:this.mode,[D.CLOSING_POINT]:!0}}]);return this.currentId=t,this.closingPointId=i,this.startingClick=!0,void(this.state!=="drawing"&&this.setDrawing())}this.close()}}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.startingClick===!0&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentId,t=this.closingPointId;this.closingPointId=void 0,this.currentId=void 0,this.startingClick=!1,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),t!==void 0&&this.store.delete([t])}catch{}}styleFeature(e){const t=J({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="LineString"&&e.properties.mode===this.mode?(t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=Le,t):(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode&&(t.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,e),t.zIndex=50),t)}validateFeature(e){return this.validateModeFeature(e,t=>ms(t,this.coordinatePrecision))}afterFeatureUpdated(e){this.currentId===e.id&&(this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0)}}function Vt(n){if(n===null||typeof n=="boolean"||typeof n=="string")return!0;if(n===void 0)return!1;if(typeof n=="number")return Number.isFinite(n);if(typeof n=="bigint"||typeof n=="symbol"||typeof n=="function"||n instanceof RegExp||n instanceof Map||n instanceof Set||n instanceof Date)return!1;if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const e=Object.getPrototypeOf(n);if(e!==Object.prototype&&e!==null)return!1}if(ArrayBuffer.isView(n)&&!(n instanceof DataView))return!1;if(Array.isArray(n)){for(const e of n)if(!Vt(e))return!1}return typeof n=="object"&&Object.keys(n).every(e=>typeof e=="string"&&Vt(n[e]))}class Oa{constructor(e){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e.adapter,this._mode=new la;const t=new Set,i=e.modes.reduce((c,u)=>{if(t.has(u.mode))throw new Error(`There is already a ${u.mode} mode provided`);return t.add(u.mode),c[u.mode]=u,c},{}),s=Object.keys(i);if(s.length===0)throw new Error("No modes provided");s.forEach(c=>{if(i[c].type===Fe.Select){if(this._instanceSelectMode)throw new Error("only one type of select mode can be provided");this._instanceSelectMode=c}}),this._modes=J({},i,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new fa({tracked:!!e.tracked,idStrategy:e.idStrategy?e.idStrategy:void 0});const o=c=>{const u=[],p=this._store.copyAll().filter(f=>!c.includes(f.id)||(u.push(f),!1));return{changed:u,unchanged:p}},r=(c,u)=>{this._enabled&&this._eventListeners.finish.forEach(p=>{p(c,u)})},a=(c,u,p)=>{if(!this._enabled)return;this._eventListeners.change.forEach(m=>{m(c,u,p)});const{changed:f,unchanged:g}=o(c);u==="create"?this._adapter.render({created:f,deletedIds:[],unchanged:g,updated:[]},this.getModeStyles()):u==="update"?this._adapter.render({created:[],deletedIds:[],unchanged:g,updated:f},this.getModeStyles()):u==="delete"?this._adapter.render({created:[],deletedIds:c,unchanged:g,updated:[]},this.getModeStyles()):u==="styling"&&this._adapter.render({created:[],deletedIds:[],unchanged:g,updated:[]},this.getModeStyles())},d=c=>{if(!this._enabled)return;this._eventListeners.select.forEach(f=>{f(c)});const{changed:u,unchanged:p}=o([c]);this._adapter.render({created:[],deletedIds:[],unchanged:p,updated:u},this.getModeStyles())},h=c=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(f=>{f()});const{changed:u,unchanged:p}=o([c]);u&&this._adapter.render({created:[],deletedIds:[],unchanged:p,updated:u},this.getModeStyles())};Object.keys(this._modes).forEach(c=>{this._modes[c].register({mode:c,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:a,onSelect:d,onDeselect:h,onFinish:r,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}checkEnabled(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}getModeStyles(){const e={};return Object.keys(this._modes).forEach(t=>{e[t]=i=>this._instanceSelectMode&&i.properties[le.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(i):this._modes[t].styleFeature.bind(this._modes[t])(i)}),e}featuresAtLocation({lng:e,lat:t},i){const s=i&&i.pointerDistance!==void 0?i.pointerDistance:30,o=!i||i.ignoreSelectFeatures===void 0||i.ignoreSelectFeatures,r=!(!i||i.ignoreCoordinatePoints===void 0)&&i.ignoreCoordinatePoints,a=!(!i||i.ignoreCurrentlyDrawing===void 0)&&i.ignoreCurrentlyDrawing,d=!(!i||i.ignoreClosingPoints===void 0)&&i.ignoreClosingPoints,h=this._adapter.unproject.bind(this._adapter),c=this._adapter.project.bind(this._adapter),u=c(e,t),p=fs({unproject:h,point:u,pointerDistance:s});return this._store.search(p).filter(f=>{if(o&&(f.properties[le.MID_POINT]||f.properties[le.SELECTION_POINT])||r&&f.properties[D.COORDINATE_POINT]||d&&f.properties[D.CLOSING_POINT]||a&&f.properties[D.CURRENTLY_DRAWING])return!1;if(f.geometry.type==="Point"){const g=f.geometry.coordinates,m=c(g[0],g[1]);return ge(u,m)<s}if(f.geometry.type==="LineString"){const g=f.geometry.coordinates;for(let m=0;m<g.length-1;m++){const C=g[m],E=g[m+1];if(Gt(u,c(C[0],C[1]),c(E[0],E[1]))<s)return!0}return!1}if(Cs([e,t],f.geometry.coordinates))return!0;if(i!=null&&i.includePolygonsWithinPointerDistance){const g=f.geometry.coordinates;for(const m of g)for(let C=0;C<m.length-1;C++){const E=m[C],P=m[C+1],S=c(E[0],E[1]),y=c(P[0],P[1]);if(Gt(u,S,y)<s)return!0}}return!1}).map(f=>{if(i==null||!i.addClosestCoordinateInfoToProperties)return f;let g;if(f.geometry.type==="Polygon")g=f.geometry.coordinates[0],g.pop();else{if(f.geometry.type!=="LineString")return f;g=f.geometry.coordinates}let m,C=-1,E=1/0;for(let P=0;P<g.length;P++){const S=g[P],y=ge(c(S[0],S[1]),u);y<E&&(C=P,E=y,m=S)}return f.properties.closestCoordinateIndexToEvent=C,f.properties.closestCoordinatePixelDistanceToEvent=E,f.properties.closestCoordinateDistanceKmToEvent=me(m,[e,t]),f})}getSelectModeOrThrow(){const e=this.getSelectMode({switchToSelectMode:!0});if(!e)throw new Error("No select mode defined in instance");return e}getSelectMode({switchToSelectMode:e}){if(this.checkEnabled(),!this._instanceSelectMode)return null;const t=this.getMode();return e&&t!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}isGuidanceFeature(e){return!!(e.properties[le.MID_POINT]||e.properties[le.SELECTION_POINT]||e.properties[D.COORDINATE_POINT]||e.properties[D.SNAPPING_POINT])}setModeStyles(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].styles=t}updateModeOptions(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].updateOptions(t)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(e){if(this._store.has(e))return this._store.copy(e)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(e){throw new Error("Enabled is read only")}getMode(){return this._mode.mode}getModeState(){return this._mode.state}setMode(e){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}removeFeatures(e){this.checkEnabled();const t=[];e.forEach(i=>{if(!this._store.has(i))throw new Error(`No feature with id ${i}, can not delete`);const s=this._store.copy(i);s.properties[le.SELECTED]&&this.deselectFeature(i),s.properties[D.COORDINATE_POINT_IDS]&&t.push(...s.properties[D.COORDINATE_POINT_IDS])}),this._store.delete([...e,...t],{origin:"api"})}selectFeature(e){this.getSelectModeOrThrow().selectFeature(e)}deselectFeature(e){this.getSelectModeOrThrow().deselectFeature(e)}getFeatureId(){return this._store.getId()}hasFeature(e){return this._store.has(e)}checkIsReservedProperty(e){return![...Object.values(le),...Object.values(D)].includes(e)}updateFeatureProperties(e,t){if(!this._store.has(e))throw new Error(`No feature with id ${e} present in store`);const i=this._store.copy(e);if(this.isGuidanceFeature(i))throw new Error("Guidance features are not allowed to be updated directly.");const s=i.properties.mode;if(!this._modes[s])throw new Error(`No mode with name ${s} present in instance`);const o=Object.entries(t);o.forEach(([r,a])=>{if(!this.checkIsReservedProperty(r))throw new Error(`You are trying to update a reserved property name: ${r}. Please choose another name.`);if(a!==void 0&&!Vt(a))throw new Error(`Invalid JSON value provided for property ${r}`)}),this._store.updateProperty(o.map(([r,a])=>({id:i.id,property:r,value:a})),{origin:"api"})}updateFeatureGeometry(e,t){if(!this._store.has(e))throw new Error(`No feature with id ${e} present in store`);const i=this._store.copy(e);if(this.isGuidanceFeature(i))throw new Error("Guidance features are not allowed to be updated directly.");if(!(i&&t&&t.type&&t.coordinates))throw new Error("Invalid geometry provided");if(t.type!==i.geometry.type)throw new Error(`Geometry type mismatch: expected ${i.geometry.type}, got ${t.type}`);const s=i.properties.mode,o=this._modes[s];if(!o)throw new Error(`No mode with name ${s} present in instance`);const r=J({},i,{geometry:t}),a=o.validateFeature(r);if(!a.valid)throw new Error(`Feature validation failed: ${a.reason||"Unknown reason"}`);if(this._store.updateGeometry([{id:i.id,geometry:t}],{origin:"api"}),o.afterFeatureUpdated){o.afterFeatureUpdated(r);const d=r.properties[le.SELECTED],h=this.getSelectMode({switchToSelectMode:!1});h&&d&&h.afterFeatureUpdated(r)}}transformFeatureGeometry(e,t){if(!this._store.has(e))throw new Error(`No feature with id ${e} present in store`);let i=this._store.copy(e);if(this.isGuidanceFeature(i))throw new Error("Guidance features are not allowed to be updated directly.");const s=i.properties.mode,o=this._modes[s];if(!o)throw new Error(`No mode with name ${s} present in instance`);let r;if(i.geometry.type==="Polygon")r=i.geometry.coordinates[0];else{if(i.geometry.type!=="LineString")throw new Error(`Feature geometry type ${i.geometry.type} is not supported for transformation`);r=i.geometry.coordinates}if(t.projection!="web-mercator")throw new Error(`Projection ${t.projection} is not currently supported for transformation`);if(t.type==="scale"){const{x:a,y:d}=se(t.origin[0],t.origin[1]);Ls({coordinates:r,originX:a,originY:d,xScale:t.options.xScale||1,yScale:t.options.yScale||1})}else t.type==="rotate"&&(i=Ps(i,t.options.angle||0),r=i.geometry.type==="Polygon"?i.geometry.coordinates[0]:i.geometry.coordinates);if(r=r.map(a=>[ie(a[0],this._adapter.getCoordinatePrecision()),ie(a[1],this._adapter.getCoordinatePrecision())]),i.geometry.coordinates=i.geometry.type==="Polygon"?[r]:r,this._store.updateGeometry([{id:i.id,geometry:i.geometry}],{origin:"api"}),o.afterFeatureUpdated){o.afterFeatureUpdated(i);const a=i.properties[le.SELECTED],d=this.getSelectMode({switchToSelectMode:!1});d&&a&&d.afterFeatureUpdated(i)}}addFeatures(e){return this.checkEnabled(),e.length===0?[]:this._store.load(e,t=>{if(jn(t)){const i=t.properties.mode,s=this._modes[i];if(!s)return{id:t.id,valid:!1,reason:`${i} mode is not in the list of instantiated modes`};const o=s.validateFeature.bind(s)(t);return{id:t.id,valid:o.valid,reason:o.reason?o.reason:o.valid?void 0:"Feature is invalid"}}return{id:t.id,valid:!1,reason:"Mode property does not exist"}},t=>{if(jn(t)){const i=this._modes[t.properties.mode];i&&i.afterFeatureAdded&&i.afterFeatureAdded(t)}},{origin:"api"})}start(){this._enabled||(this._enabled=!0,this._adapter.register({onReady:()=>{this._eventListeners.ready.forEach(e=>{e()})},getState:()=>this._mode.state,onClick:e=>{this._mode.onClick(e)},onMouseMove:e=>{this._mode.onMouseMove(e)},onKeyDown:e=>{this._mode.onKeyDown(e)},onKeyUp:e=>{this._mode.onKeyUp(e)},onDragStart:(e,t)=>{this._mode.onDragStart(e,t)},onDrag:(e,t)=>{this._mode.onDrag(e,t)},onDragEnd:(e,t)=>{this._mode.onDragEnd(e,t)},onClear:()=>{this._mode.cleanUp(),this._store.clear()}}))}getFeaturesAtLngLat(e,t){const{lng:i,lat:s}=e;return this.featuresAtLocation({lng:i,lat:s},t)}getFeaturesAtPointerEvent(e,t){const i=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return i===null?[]:this.featuresAtLocation(i,t)}stop(){this._enabled&&(this._enabled=!1,this._adapter.unregister())}on(e,t){const i=this._eventListeners[e];i.includes(t)||i.push(t)}off(e,t){const i=this._eventListeners[e];i.includes(t)&&i.splice(i.indexOf(t),1)}}class ka extends ma.TerraDrawBaseAdapter{constructor(e){super(e),this._cursor=void 0,this._cursorStyleSheet=void 0,this._lib=void 0,this._map=void 0,this._overlay=void 0,this._clickEventListener=void 0,this._mouseMoveEventListener=void 0,this._readyCalled=!1,this.renderedFeatureIds=new Set,this._lib=e.lib,this._map=e.map,this._coordinatePrecision=typeof e.coordinatePrecision=="number"?e.coordinatePrecision:9}get _layers(){var e;return((e=this.renderedFeatureIds)==null?void 0:e.size)>0}circlePath(e,t,i){const s=2*i;return`M ${e} ${t} m -${i}, 0 a ${i},${i} 0 1,0 ${s},0 a ${i},${i} 0 1,0 -${s},0`}register(e){super.register(e),this._overlay=new this._lib.OverlayView,this._overlay.draw=function(){},this._overlay.onAdd=()=>{var t;(t=this._currentModeCallbacks)!=null&&t.onReady&&!this._readyCalled&&(this._currentModeCallbacks.onReady(),this._readyCalled=!0)},this._overlay.setMap(this._map),this._overlay.onRemove=()=>{},this._clickEventListener=this._map.data.addListener("click",t=>{const i=this._listeners.find(({name:s})=>s==="click");i&&i.callback(t)}),this._mouseMoveEventListener=this._map.data.addListener("mousemove",t=>{const i=this._listeners.find(({name:s})=>s==="mousemove");i&&i.callback(t)})}unregister(){var e,t;super.unregister(),(e=this._clickEventListener)==null||e.remove(),(t=this._mouseMoveEventListener)==null||t.remove(),this._overlay&&this._overlay.getMap()&&this._overlay.setMap(null),this._overlay=void 0,this._readyCalled=!1}getLngLatFromEvent(e){if(!this._overlay)throw new Error("cannot get overlay");const t=this._map.getBounds();if(!t)return null;const i=t.getNorthEast(),s=t.getSouthWest(),o=new this._lib.LatLngBounds(s,i),r=this._map.getDiv(),a=e.clientX-r.getBoundingClientRect().left,d=e.clientY-r.getBoundingClientRect().top,h=new this._lib.Point(a,d),c=this._overlay.getProjection();if(!c)return null;const u=c.fromContainerPixelToLatLng(h);return u&&o.contains(u)?{lng:u.lng(),lat:u.lat()}:null}getMapEventElement(){return this._map.getDiv().querySelector('div[style*="z-index: 3;"]')}project(e,t){if(!this._overlay)throw new Error("cannot get overlay");if(this._map.getBounds()===void 0)throw new Error("cannot get bounds");const i=this._overlay.getProjection();if(i===void 0)throw new Error("cannot get projection");const s=i.fromLatLngToContainerPixel(new this._lib.LatLng(t,e));if(s===null)throw new Error("cannot project coordinates");return{x:s.x,y:s.y}}unproject(e,t){if(!this._overlay)throw new Error("cannot get overlay");const i=this._overlay.getProjection();if(i===void 0)throw new Error("cannot get projection");const s=i.fromContainerPixelToLatLng(new this._lib.Point(e,t));if(s===null)throw new Error("cannot unproject coordinates");return{lng:s.lng(),lat:s.lat()}}setCursor(e){if(e!==this._cursor){if(this._cursorStyleSheet&&(this._cursorStyleSheet.remove(),this._cursorStyleSheet=void 0),e!=="unset"){const t=this._map.getDiv().querySelector(".gm-style > div");if(t){t.classList.add("terra-draw-google-maps");const i=document.createElement("style");i.innerHTML=`.terra-draw-google-maps { cursor: ${e} !important; }`,document.getElementsByTagName("head")[0].appendChild(i),this._cursorStyleSheet=i}}this._cursor=e}}setDoubleClickToZoom(e){this._map.setOptions(e?{disableDoubleClickZoom:!1}:{disableDoubleClickZoom:!0})}setDraggability(e){this._map.setOptions({draggable:e})}render(e,t){this._layers&&(e.deletedIds.forEach(s=>{const o=this._map.data.getFeatureById(s);o&&(this._map.data.remove(o),this.renderedFeatureIds.delete(s))}),e.updated.forEach(s=>{if(!s||!s.id)throw new Error("Feature is not valid");const o=this._map.data.getFeatureById(s.id);if(!o)throw new Error("Feature could not be found by Google Maps API");switch(o.forEachProperty((r,a)=>{o.setProperty(a,void 0)}),Object.keys(s.properties).forEach(r=>{o.setProperty(r,s.properties[r])}),s.geometry.type){case"Point":{const r=s.geometry.coordinates;o.setGeometry(new this._lib.Data.Point(new this._lib.LatLng(r[1],r[0])))}break;case"LineString":{const r=s.geometry.coordinates,a=[];for(let d=0;d<r.length;d++){const h=r[d],c=new this._lib.LatLng(h[1],h[0]);a.push(c)}o.setGeometry(new this._lib.Data.LineString(a))}break;case"Polygon":{const r=s.geometry.coordinates,a=[];for(let d=0;d<r.length;d++){const h=[];for(let c=0;c<r[d].length;c++){const u=new this._lib.LatLng(r[d][c][1],r[d][c][0]);h.push(u)}a.push(h)}o.setGeometry(new this._lib.Data.Polygon(a))}}}),e.created.forEach(s=>{this.renderedFeatureIds.add(s.id),this._map.data.addGeoJson(s)})),e.created.forEach(s=>{this.renderedFeatureIds.add(s.id)});const i={type:"FeatureCollection",features:[...e.created]};this._map.data.addGeoJson(i),this._map.data.setStyle(s=>{const o=s.getProperty("mode"),r=s.getGeometry();if(!r)throw new Error("Google Maps geometry not found");const a=r.getType(),d={},h=s.getId();s.forEachProperty((u,p)=>{d[p]=u});const c=t[o]({type:"Feature",id:h,geometry:{type:a,coordinates:[]},properties:d});switch(a){case"Point":return{clickable:!1,icon:{path:this.circlePath(0,0,c.pointWidth),fillColor:c.pointColor,fillOpacity:1,strokeColor:c.pointOutlineColor,strokeWeight:c.pointOutlineWidth,rotation:0,scale:1},zIndex:c.zIndex};case"LineString":return{strokeColor:c.lineStringColor,strokeWeight:c.lineStringWidth,zIndex:c.zIndex};case"Polygon":return{strokeColor:c.polygonOutlineColor,strokeWeight:c.polygonOutlineWidth,fillOpacity:c.polygonFillOpacity,fillColor:c.polygonFillColor,zIndex:c.zIndex}}throw Error("Unknown feature type")})}clearLayers(){this._layers&&(this._map.data.forEach(e=>{const t=e.getId();this.renderedFeatureIds.has(t)&&this._map.data.remove(e)}),this.renderedFeatureIds=new Set)}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())}getCoordinatePrecision(){return super.getCoordinatePrecision()}}export{oo as D,Ma as E,Pa as G,Oa as H,$o as I,ba as L,ao as M,Xo as P,Sa as a,wa as b,he as j,Ea as m,ka as t,La as u,xa as w,Ia as z};
