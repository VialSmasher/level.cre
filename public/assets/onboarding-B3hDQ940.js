import{j as e}from"./maps-BkP_85Bm.js";import{r as i}from"./react-BUvn9Qyq.js";import{c as X,g as $,s as J,P as T,j as Q,o as D,k as M,p as V,h as O,C as Z,r as ee,f as se,B as A,t as te,q as ae,e as q,U as re}from"./index-DIhazG7A.js";import{L as y,I as P}from"./label-1jjjNnWq.js";import{C as ne,b as oe,a as ce}from"./card-CVaT3zxn.js";import{u as ie}from"./index-NSkCLJ8O.js";import{c as le}from"./query-BAwt2wOP.js";import{A as de,b as me,a as ue}from"./alert-ClfNS6l5.js";import{B as he}from"./building-DRygTKhv.js";import{T as xe}from"./target-BbIdDTai.js";import"./supabase-LVwxr6rx.js";import"./charts-Ciu5p52_.js";const pe=X("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var R="Checkbox",[fe]=$(R),[be,B]=fe(R);function Ce(o){const{__scopeCheckbox:l,checked:d,children:n,defaultChecked:m,disabled:a,form:p,name:r,onCheckedChange:c,required:f,value:j="on",internal_do_not_use_render:h}=o,[C,N]=Q({prop:d,defaultProp:m??!1,onChange:c,caller:R}),[k,g]=i.useState(null),[S,u]=i.useState(null),x=i.useRef(!1),w=k?!!p||!!k.closest("form"):!0,E={checked:C,disabled:a,setChecked:N,control:k,setControl:g,name:r,form:p,value:j,hasConsumerStoppedPropagationRef:x,required:f,defaultChecked:v(m)?!1:m,isFormControl:w,bubbleInput:S,setBubbleInput:u};return e.jsx(be,{scope:l,...E,children:je(h)?h(E):n})}var W="CheckboxTrigger",H=i.forwardRef(({__scopeCheckbox:o,onKeyDown:l,onClick:d,...n},m)=>{const{control:a,value:p,disabled:r,checked:c,required:f,setControl:j,setChecked:h,hasConsumerStoppedPropagationRef:C,isFormControl:N,bubbleInput:k}=B(W,o),g=D(m,j),S=i.useRef(c);return i.useEffect(()=>{const u=a?.form;if(u){const x=()=>h(S.current);return u.addEventListener("reset",x),()=>u.removeEventListener("reset",x)}},[a,h]),e.jsx(T.button,{type:"button",role:"checkbox","aria-checked":v(c)?"mixed":c,"aria-required":f,"data-state":G(c),"data-disabled":r?"":void 0,disabled:r,value:p,...n,ref:g,onKeyDown:M(l,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:M(d,u=>{h(x=>v(x)?!0:!x),k&&N&&(C.current=u.isPropagationStopped(),C.current||u.stopPropagation())})})});H.displayName=W;var F=i.forwardRef((o,l)=>{const{__scopeCheckbox:d,name:n,checked:m,defaultChecked:a,required:p,disabled:r,value:c,onCheckedChange:f,form:j,...h}=o;return e.jsx(Ce,{__scopeCheckbox:d,checked:m,defaultChecked:a,disabled:r,required:p,onCheckedChange:f,name:n,form:j,value:c,internal_do_not_use_render:({isFormControl:C})=>e.jsxs(e.Fragment,{children:[e.jsx(H,{...h,ref:l,__scopeCheckbox:d}),C&&e.jsx(Y,{__scopeCheckbox:d})]})})});F.displayName=R;var U="CheckboxIndicator",z=i.forwardRef((o,l)=>{const{__scopeCheckbox:d,forceMount:n,...m}=o,a=B(U,d);return e.jsx(J,{present:n||v(a.checked)||a.checked===!0,children:e.jsx(T.span,{"data-state":G(a.checked),"data-disabled":a.disabled?"":void 0,...m,ref:l,style:{pointerEvents:"none",...o.style}})})});z.displayName=U;var K="CheckboxBubbleInput",Y=i.forwardRef(({__scopeCheckbox:o,...l},d)=>{const{control:n,hasConsumerStoppedPropagationRef:m,checked:a,defaultChecked:p,required:r,disabled:c,name:f,value:j,form:h,bubbleInput:C,setBubbleInput:N}=B(K,o),k=D(d,N),g=ie(a),S=V(n);i.useEffect(()=>{const x=C;if(!x)return;const w=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(w,"checked").set,t=!m.current;if(g!==a&&s){const b=new Event("click",{bubbles:t});x.indeterminate=v(a),s.call(x,v(a)?!1:a),x.dispatchEvent(b)}},[C,g,a,m]);const u=i.useRef(v(a)?!1:a);return e.jsx(T.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??u.current,required:r,disabled:c,name:f,value:j,form:h,...l,tabIndex:-1,ref:k,style:{...l.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Y.displayName=K;function je(o){return typeof o=="function"}function v(o){return o==="indeterminate"}function G(o){return v(o)?"indeterminate":o?"checked":"unchecked"}const L=i.forwardRef(({className:o,...l},d)=>e.jsx(F,{ref:d,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",o),...l,children:e.jsx(z,{className:O("flex items-center justify-center text-current"),children:e.jsx(Z,{className:"h-4 w-4"})})}));L.displayName=F.displayName;function Ae(){const[,o]=ee(),{user:l,setNeedsOnboarding:d}=se(),[n,m]=i.useState(1),[a,p]=i.useState(null),[r,c]=i.useState({name:l?.user_metadata?.full_name||"",company:"",email:l?.email||"",marketCity:"Edmonton",submarkets:["NW","NE","SW","SE"],assetClasses:[]}),[f,j]=i.useState(""),h=le({mutationFn:async s=>{try{return(await q("POST","/api/profile",s)).json()}catch(t){const b=String(t?.message||"").toLowerCase();if(b.includes("409")||b.includes("duplicate")||b.includes("exists"))return(await q("PATCH","/api/profile",s)).json();throw t}},onSuccess:s=>{try{ae.setQueryData(["/api/profile"],s)}catch{}d(!1),o("/app")},onError:s=>{const t=String(s?.message||"Unknown error");let b="We could not save your profile. Please try again.";try{const I=t.indexOf("{");if(I!==-1){const _=JSON.parse(t.slice(I));_?.message&&(b=_.message)}}catch{}p(b)}}),C=()=>{a&&p(null),n<3?m(n+1):h.mutate(r)},N=()=>{a&&p(null),n>1&&m(n-1)},k=s=>{c(t=>({...t,submarkets:t.submarkets.includes(s)?t.submarkets.filter(b=>b!==s):[...t.submarkets,s]}))},g=()=>{f&&!r.submarkets.includes(f)&&(c(s=>({...s,submarkets:[...s.submarkets,f]})),j(""))},S=s=>{c(t=>({...t,assetClasses:t.assetClasses.includes(s)?t.assetClasses.filter(b=>b!==s):[...t.assetClasses,s]}))},u=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(re,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Tell us about yourself"}),e.jsx("p",{className:"text-gray-600",children:"Let's get your profile set up"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"name",children:"Full Name"}),e.jsx(P,{id:"name",value:r.name,onChange:s=>c(t=>({...t,name:s.target.value})),placeholder:"Your full name"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"company",children:"Company"}),e.jsx(P,{id:"company",value:r.company,onChange:s=>c(t=>({...t,company:s.target.value})),placeholder:"Your company name"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"email",children:"Email"}),e.jsx(P,{id:"email",value:r.email,onChange:s=>c(t=>({...t,email:s.target.value})),placeholder:"your.email@company.com",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"marketCity",children:"Market City"}),e.jsx(P,{id:"marketCity",value:r.marketCity,onChange:s=>c(t=>({...t,marketCity:s.target.value})),placeholder:"Edmonton"})]})]})]}),x=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(he,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Choose your submarkets"}),e.jsx("p",{className:"text-gray-600",children:"Select areas you want to focus on"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["NW","NE","SW","SE","Downtown","Airport","Industrial"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:s,checked:r.submarkets.includes(s),onCheckedChange:()=>k(s)}),e.jsx(y,{htmlFor:s,className:"text-sm font-medium",children:s})]},s))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(P,{value:f,onChange:s=>j(s.target.value),placeholder:"Add custom submarket",onKeyPress:s=>s.key==="Enter"&&g()}),e.jsx(A,{onClick:g,variant:"outline",children:"Add"})]}),r.submarkets.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(y,{className:"text-sm font-medium",children:"Selected submarkets:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.submarkets.map(s=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:s},s))})]})]})]}),w=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(xe,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Asset Classes"}),e.jsx("p",{className:"text-gray-600",children:"What type of properties do you work with?"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(y,{className:"text-base font-medium",children:"Select Asset Classes (optional)"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-3",children:["industrial","investment","retail","office"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:s,checked:r.assetClasses.includes(s),onCheckedChange:()=>S(s)}),e.jsx(y,{htmlFor:s,className:"text-sm font-medium capitalize",children:s})]},s))}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"You can skip this and set it up later"})]})})]}),E=()=>{switch(n){case 1:return r.name&&r.company&&r.marketCity;case 2:return r.submarkets.length>0;case 3:return!0;default:return!1}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs(ne,{className:"w-full max-w-md",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex space-x-2",children:[1,2,3].map(s=>e.jsx("div",{className:`w-3 h-3 rounded-full ${s<=n?"bg-blue-600":"bg-gray-200"}`},s))}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Step ",n," of 3"]})]})}),e.jsxs(ce,{children:[a&&e.jsx("div",{className:"mb-4",children:e.jsxs(de,{variant:"destructive",children:[e.jsx(me,{children:"There was a problem"}),e.jsx(ue,{children:a})]})}),n===1&&u(),n===2&&x(),n===3&&w(),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsxs(A,{onClick:N,variant:"outline",disabled:n===1,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(A,{onClick:C,disabled:!E()||h.isPending,className:"ml-auto",children:n===3?h.isPending?"Creating...":"Complete Setup":e.jsxs(e.Fragment,{children:["Next",e.jsx(te,{className:"h-4 w-4 ml-2"})]})})]})]})]})})}export{Ae as default};
