import{j as e}from"./maps-BkP_85Bm.js";import{r as f}from"./react-BUvn9Qyq.js";import{c as I,r as P,u as T,a as E,b as $,B as p,d as M,D as y,v as N,w as C,x as n,e as u}from"./index-DIhazG7A.js";import{b as q,u as D,c as v}from"./query-BAwt2wOP.js";import{C as g,b as j,c as w,a as k}from"./card-CVaT3zxn.js";import{D as z,b as F,c as R,d as K}from"./dialog-BERENffF.js";import{L as O,I as Q}from"./label-1jjjNnWq.js";import{P as A}from"./plus-BEBk_LKq.js";import{S}from"./share-2-B3qhJonk.js";import{T as b}from"./trash-2-Cz6C_y_-.js";import"./supabase-LVwxr6rx.js";import"./charts-Ciu5p52_.js";const L=I("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const W=I("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function B({open:m,onOpenChange:a}){const{toast:c}=T(),[,x]=P(),[o,l]=f.useState(""),d=v({mutationFn:async()=>{const i={title:o.trim()},r=await u("POST","/api/listings",i);if(!(r.headers.get("content-type")||"").includes("application/json"))throw await r.text(),new Error("API did not return JSON for create. Ensure the backend is running and that you're authenticated or in Demo Mode.");return r.json()},onSuccess:i=>{a(!1),l(""),c({title:"Workspace created",description:"Opening workspace..."});try{localStorage.setItem("lastWorkspaceId",i.id),localStorage.setItem("lastWorkspacesLocation",`/app/workspaces/${i.id}`),localStorage.setItem("lastListingsLocation",`/app/listings/${i.id}`)}catch{}x(`/app/workspaces/${i.id}`)},onError:async i=>{const r=i?.message||"Failed to create workspace";c({title:"Could not create workspace",description:r,variant:"destructive"})}}),h=!!o.trim();return e.jsx(z,{open:m,onOpenChange:a,children:e.jsxs(F,{className:"max-w-lg",children:[e.jsx(R,{children:e.jsx(K,{children:"Create Workspace"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Workspace Name"}),e.jsx(Q,{value:o,onChange:i=>l(i.target.value),placeholder:"e.g., NW Distributors"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(p,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(p,{onClick:()=>d.mutate(),disabled:!h||d.isPending,children:d.isPending?"Creating...":"Create Workspace"})]})]})]})})}function ae(){const[,m]=P(),{toast:a}=T(),c=q(),[x,o]=f.useState(!1),{data:l=[],isLoading:d}=D({queryKey:["/api/listings"]}),{data:h=[],isLoading:i}=D({queryKey:["/api/listings","shared"],queryFn:async()=>{const s=await u("GET","/api/listings?scope=shared");return(s.headers.get("content-type")||"").includes("application/json")?s.json():[]}});f.useEffect(()=>{try{localStorage.setItem("lastWorkspacesLocation","/app/workspaces"),localStorage.setItem("lastListingsLocation","/app/listings")}catch{}},[]),v({mutationFn:async s=>(await u("POST",`/api/listings/${s}/archive`,{}),{ok:!0}),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/listings"],refetchType:"active"}),a({title:"Workspace archived"})},onError:s=>{a({title:"Could not archive workspace",description:s?.message||"Unknown error",variant:"destructive"})}});const r=v({mutationFn:async s=>(await u("DELETE",`/api/listings/${s}`),{ok:!0}),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/listings"],refetchType:"active"}),a({title:"Workspace deleted"})},onError:s=>{a({title:"Could not delete workspace",description:s?.message||"Unknown error",variant:"destructive"})}});return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Workspaces"}),e.jsxs(E,{children:[e.jsx($,{asChild:!0,children:e.jsx(p,{size:"icon",onClick:()=>o(!0),"aria-label":"Create Workspace",children:e.jsx(A,{className:"h-4 w-4"})})}),e.jsx(M,{children:e.jsx("p",{children:"Create Workspace"})})]})]}),d?e.jsx("div",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[l.length===0&&e.jsxs(g,{className:"col-span-full",children:[e.jsx(j,{children:e.jsx(w,{children:"No workspaces yet"})}),e.jsx(k,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create your first workspace to start scoping prospects."})})]}),l.map(s=>e.jsxs(g,{className:"group relative cursor-pointer transition-shadow hover:shadow-md hover:border-blue-300",onClick:()=>{try{localStorage.setItem("lastWorkspaceId",s.id),localStorage.setItem("lastWorkspacesLocation",`/app/workspaces/${s.id}`),localStorage.setItem("lastListingsLocation",`/app/listings/${s.id}`)}catch{}m(`/app/workspaces/${s.id}`)},children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx(w,{className:"text-lg leading-tight truncate",children:s.title||s.address}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(s.createdAt||Date.now()).toLocaleDateString()}),e.jsxs(y,{children:[e.jsx(N,{asChild:!0,children:e.jsx(p,{size:"icon",variant:"ghost",className:"h-8 w-8 opacity-0 transition-opacity group-hover:opacity-100",onClick:t=>{t.preventDefault(),t.stopPropagation()},"aria-label":"Workspace actions",children:e.jsx(L,{className:"h-4 w-4"})})}),e.jsxs(C,{align:"end",className:"w-44",children:[e.jsxs(n,{onClick:t=>{t.preventDefault(),t.stopPropagation(),a({title:"Rename",description:"Coming soon."})},children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," Rename"]}),e.jsxs(n,{onClick:t=>{t.preventDefault(),t.stopPropagation(),a({title:"Share",description:"Coming soon."})},children:[e.jsx(S,{className:"mr-2 h-4 w-4"})," Share"]}),e.jsxs(n,{className:"text-red-600 focus:text-red-700",onClick:t=>{t.preventDefault(),t.stopPropagation(),confirm("Delete this workspace? This cannot be undone.")&&r.mutate(s.id)},disabled:r.isPending,children:[e.jsx(b,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})]})]})}),e.jsx(k,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Prospects:"})," ",s.prospectCount]})})]},s.id))]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Shared"}),i?e.jsx("div",{children:"Loading..."}):h.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No shared workspaces yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(s=>e.jsxs(g,{className:"group relative cursor-pointer transition-shadow hover:shadow-md hover:border-blue-300",onClick:()=>{try{localStorage.setItem("lastWorkspaceId",s.id),localStorage.setItem("lastWorkspacesLocation",`/app/workspaces/${s.id}`),localStorage.setItem("lastListingsLocation",`/app/listings/${s.id}`)}catch{}m(`/app/workspaces/${s.id}`)},children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx(w,{className:"text-lg leading-tight truncate",children:s.title||s.address}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(s.createdAt||Date.now()).toLocaleDateString()}),e.jsxs(y,{children:[e.jsx(N,{asChild:!0,children:e.jsx(p,{size:"icon",variant:"ghost",className:"h-8 w-8 opacity-0 transition-opacity group-hover:opacity-100",onClick:t=>{t.preventDefault(),t.stopPropagation()},"aria-label":"Workspace actions",children:e.jsx(L,{className:"h-4 w-4"})})}),e.jsxs(C,{align:"end",className:"w-44",children:[e.jsxs(n,{onClick:t=>{t.preventDefault(),t.stopPropagation(),a({title:"Rename",description:"Coming soon."})},children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," Rename"]}),e.jsxs(n,{onClick:t=>{t.preventDefault(),t.stopPropagation(),a({title:"Share",description:"Coming soon."})},children:[e.jsx(S,{className:"mr-2 h-4 w-4"})," Share"]}),e.jsxs(n,{className:"text-red-600 focus:text-red-700",onClick:t=>{t.preventDefault(),t.stopPropagation(),a({title:"Delete",description:"Coming soon."})},children:[e.jsx(b,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})]})]})}),e.jsx(k,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prospects: ",s.prospectCount??0]})})]},s.id))})]})]}),e.jsx(B,{open:x,onOpenChange:o})]})}export{ae as default};
